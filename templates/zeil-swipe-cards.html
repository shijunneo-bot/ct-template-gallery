<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "ZEIL",
        tagline: "Jobs, Smarter",
        purple: "#7C3AED",
        purpleDark: "#5B21B6",
        purpleDeep: "#3B0764",
        purpleLight: "#EDE9FE",
        purpleMid: "#A78BFA",
        white: "#FFFFFF",
        black: "#0F0A1A",
        green: "#10B981",
        greenLight: "#D1FAE5",
        red: "#F43F5E",
        redLight: "#FFE4E6",
        grey: "#94A3B8",
      },

      backgrounds: {
        main:   "linear-gradient(170deg, #0F0A1A 0%, #1A1035 35%, #0F0A1A 100%)",
        result: "linear-gradient(170deg, #1A0F2E 0%, #2D1B4E 35%, #1A0F2E 100%)",
      },

      enableConfettiOnComplete: true,

      // üÉè Preference cards ‚Äî each one is a binary choice
      cards: [
        {
          id: "remote",
          emoji: "üè†",
          title: "Remote Work",
          subtitle: "Work from anywhere in Aotearoa",
          image: null,  // Could be a URL ‚Äî falls back to emoji
          leftLabel: "Office for me",
          rightLabel: "Yes please!",
        },
        {
          id: "startup",
          emoji: "üöÄ",
          title: "Startup Energy",
          subtitle: "Fast-paced, wear-many-hats culture",
          image: null,
          leftLabel: "Prefer corporate",
          rightLabel: "Love it!",
        },
        {
          id: "salary_transparency",
          emoji: "üí∞",
          title: "Salary Shown Upfront",
          subtitle: "No surprises ‚Äî know the pay before you apply",
          image: null,
          leftLabel: "Not a dealbreaker",
          rightLabel: "Must have!",
        },
        {
          id: "pet_friendly",
          emoji: "üêï",
          title: "Pet-Friendly Workplace",
          subtitle: "Bring your fur baby to work",
          image: null,
          leftLabel: "Not fussed",
          rightLabel: "Dream perk!",
        },
        {
          id: "four_day_week",
          emoji: "üìÖ",
          title: "4-Day Work Week",
          subtitle: "Same output, one less day",
          image: null,
          leftLabel: "Don't mind 5",
          rightLabel: "Sign me up!",
        },
        {
          id: "learning_budget",
          emoji: "üìö",
          title: "Learning & Development Budget",
          subtitle: "Company-funded courses, conferences, certs",
          image: null,
          leftLabel: "Nice to have",
          rightLabel: "Non-negotiable!",
        },
      ],

      // üéØ Result based on preferences
      result: {
        title: "We've got your vibe!",
        subtitle: "Your preferences are locked in. We'll start matching you with roles that actually fit.",
        ctaText: "See My Matches",
        ctaUrl: "https://www.zeil.com/",
      },

      events: {
        swipeStarted:    "Swipe_Pref_Started",
        cardSwiped:      "Swipe_Pref_Card",
        swipeCompleted:  "Swipe_Pref_Completed",
        swipeCtaClicked: "Swipe_Pref_CTA",
        swipeDismissed:  "Swipe_Pref_Dismissed",
      },
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ZEIL ‚Äî What's Your Vibe?</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap');

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      font-family: 'DM Sans', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      background: #0F0A1A;
      touch-action: pan-y;
    }

    .modal {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 20px;
      position: relative; overflow: hidden;
      background: linear-gradient(170deg, #0F0A1A 0%, #1A1035 35%, #0F0A1A 100%);
    }

    .modal::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 30% 25%, rgba(124,58,237,0.08) 0%, transparent 50%),
        radial-gradient(circle at 70% 75%, rgba(124,58,237,0.05) 0%, transparent 50%);
      pointer-events: none; z-index: 0;
    }

    .dismiss-btn {
      position: absolute; top: 14px; right: 14px;
      width: 30px; height: 30px; border-radius: 50%;
      background: rgba(255,255,255,0.08); border: none;
      color: rgba(255,255,255,0.5); font-size: 14px;
      cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
    }

    /* =============================================
       SCREENS
       ============================================= */
    .screen {
      display: none; width: 100%; max-width: 360px;
      position: relative; z-index: 1;
    }
    .screen.active {
      display: flex; flex-direction: column;
      align-items: center; text-align: center;
    }
    .screen-enter {
      animation: screenIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes screenIn {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* =============================================
       HEADER (during swipe)
       ============================================= */
    .swipe-header {
      width: 100%; margin-bottom: 16px;
      display: flex; align-items: center; justify-content: space-between;
    }

    .brand-mark {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 18px; font-weight: 700;
      color: #7C3AED;
      letter-spacing: -0.5px;
    }

    .card-counter {
      font-size: 12px; font-weight: 600;
      color: rgba(255,255,255,0.4);
    }

    /* Progress dots */
    .progress-dots {
      display: flex; gap: 5px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    .dot.done { background: #7C3AED; }
    .dot.current {
      background: #A78BFA;
      width: 24px; border-radius: 4px;
    }

    /* =============================================
       CARD STACK
       ============================================= */
    .card-stack {
      position: relative;
      width: 100%;
      height: 380px;
      margin-bottom: 20px;
    }

    .swipe-card {
      position: absolute;
      width: 100%; height: 100%;
      border-radius: 20px;
      background: linear-gradient(145deg, #2A2045 0%, #1F1838 50%, #19132E 100%);
      border: 1.5px solid rgba(124,58,237,0.25);
      overflow: hidden;
      cursor: grab;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
      transition: box-shadow 0.3s ease;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 32px 24px;
      text-align: center;
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    .swipe-card:active { cursor: grabbing; }

    /* Depth stacking for cards behind */
    .swipe-card.behind-1 {
      transform: scale(0.95) translateY(12px);
      opacity: 0.5;
      pointer-events: none;
      filter: brightness(0.7);
    }
    .swipe-card.behind-2 {
      transform: scale(0.9) translateY(24px);
      opacity: 0.25;
      pointer-events: none;
      filter: brightness(0.5);
    }

    /* Card content */
    .card-emoji {
      font-size: 64px;
      margin-bottom: 20px;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
    }

    .card-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 24px; font-weight: 700;
      color: #FFFFFF;
      line-height: 1.2;
      margin-bottom: 8px;
    }

    .card-subtitle {
      font-size: 14px; font-weight: 400;
      color: rgba(255,255,255,0.65);
      line-height: 1.5;
      max-width: 260px;
    }

    /* Directional overlays */
    .overlay-right, .overlay-left {
      position: absolute; top: 20px;
      padding: 8px 16px; border-radius: 10px;
      font-size: 14px; font-weight: 700;
      letter-spacing: 0.5px;
      opacity: 0;
      transition: opacity 0.15s ease;
      pointer-events: none;
      z-index: 10;
    }
    .overlay-right {
      right: 20px;
      background: rgba(16,185,129,0.15);
      border: 2px solid #10B981;
      color: #10B981;
      transform: rotate(12deg);
    }
    .overlay-left {
      left: 20px;
      background: rgba(244,63,94,0.15);
      border: 2px solid #F43F5E;
      color: #F43F5E;
      transform: rotate(-12deg);
    }

    /* =============================================
       SWIPE HINT BUTTONS
       ============================================= */
    .hint-row {
      display: flex; gap: 16px;
      align-items: center; justify-content: center;
    }

    .hint-btn {
      width: 56px; height: 56px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .hint-btn:active { transform: scale(0.9); }

    .hint-pass {
      background: rgba(244,63,94,0.1);
      border: 2px solid rgba(244,63,94,0.3);
      color: #F43F5E;
    }
    .hint-pass:hover { background: rgba(244,63,94,0.2); }

    .hint-like {
      background: rgba(16,185,129,0.1);
      border: 2px solid rgba(16,185,129,0.3);
      color: #10B981;
    }
    .hint-like:hover { background: rgba(16,185,129,0.2); }

    .hint-label {
      font-size: 10px; font-weight: 600;
      color: rgba(255,255,255,0.25);
      max-width: 60px; text-align: center;
      margin-top: 4px;
    }

    .hint-group {
      display: flex; flex-direction: column; align-items: center;
    }

    /* =============================================
       COVER SCREEN
       ============================================= */
    .cover-icon {
      font-size: 48px; margin-bottom: 16px;
    }
    .cover-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 24px; font-weight: 700;
      color: #FFFFFF;
      line-height: 1.2; margin-bottom: 8px;
    }
    .cover-title span { color: #A78BFA; }
    .cover-sub {
      font-size: 13px; color: rgba(255,255,255,0.45);
      line-height: 1.5; margin-bottom: 24px;
      max-width: 280px;
    }

    .swipe-demo {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 28px;
    }
    .demo-item {
      display: flex; flex-direction: column;
      align-items: center; gap: 4px;
    }
    .demo-icon {
      width: 44px; height: 44px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .demo-icon.left {
      background: rgba(244,63,94,0.1);
      border: 1px solid rgba(244,63,94,0.25);
    }
    .demo-icon.right {
      background: rgba(16,185,129,0.1);
      border: 1px solid rgba(16,185,129,0.25);
    }
    .demo-label {
      font-size: 10px; font-weight: 600;
      color: rgba(255,255,255,0.35);
    }
    .demo-or {
      font-size: 11px; font-weight: 600;
      color: rgba(255,255,255,0.2);
    }

    /* =============================================
       RESULT SCREEN
       ============================================= */
    .result-icon {
      font-size: 56px; margin-bottom: 16px;
      animation: pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes pop {
      from { transform: scale(0); }
      to   { transform: scale(1); }
    }

    .result-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 22px; font-weight: 700;
      color: #FFFFFF; margin-bottom: 6px;
    }
    .result-sub {
      font-size: 13px; color: rgba(255,255,255,0.45);
      line-height: 1.5; margin-bottom: 20px;
      max-width: 280px;
    }

    /* Preference chips */
    .pref-chips {
      display: flex; flex-wrap: wrap;
      gap: 8px; justify-content: center;
      margin-bottom: 24px;
      max-width: 320px;
    }
    .pref-chip {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 7px 14px; border-radius: 100px;
      font-size: 12px; font-weight: 600;
      animation: chipIn 0.3s ease forwards;
      opacity: 0;
    }
    .pref-chip.liked {
      background: rgba(16,185,129,0.12);
      border: 1px solid rgba(16,185,129,0.3);
      color: #6EE7B7;
    }
    .pref-chip.passed {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.35);
    }
    @keyframes chipIn {
      from { opacity: 0; transform: scale(0.8); }
      to   { opacity: 1; transform: scale(1); }
    }

    /* =============================================
       BUTTONS
       ============================================= */
    .cta-btn {
      width: 100%; padding: 15px 24px;
      border-radius: 14px; border: none;
      font-family: inherit;
      font-size: 15px; font-weight: 700;
      cursor: pointer;
      transition: all 0.25s ease;
      -webkit-tap-highlight-color: transparent;
      position: relative; overflow: hidden;
    }

    .cta-purple {
      background: #7C3AED; color: #FFFFFF;
      box-shadow: 0 4px 20px rgba(124,58,237,0.35);
    }
    .cta-purple:hover {
      background: #5B21B6;
      box-shadow: 0 6px 25px rgba(124,58,237,0.45);
    }
    .cta-purple:active { transform: scale(0.98); }
    .cta-purple::after {
      content: '';
      position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shimmer 3s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(25deg); }
      100% { transform: translateX(100%) rotate(25deg); }
    }

    #confettiCanvas {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 999;
    }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="modal" id="modal">
    <button class="dismiss-btn" id="dismissBtn" onclick="dismiss()">‚úï</button>

    <!-- =============================================
         SCREEN: COVER
         ============================================= -->
    <div class="screen active screen-enter" id="screenCover">
      <div class="cover-icon">üëã</div>
      <div class="cover-title">
        What's your <span>work vibe</span>?
      </div>
      <div class="cover-sub">
        Swipe through 6 cards to help us match you with roles you'll actually love.
      </div>

      <div class="swipe-demo">
        <div class="demo-item">
          <div class="demo-icon left">üëà</div>
          <span class="demo-label">Swipe left<br/>to pass</span>
        </div>
        <span class="demo-or">or</span>
        <div class="demo-item">
          <div class="demo-icon right">üëâ</div>
          <span class="demo-label">Swipe right<br/>if you like it</span>
        </div>
      </div>

      <button class="cta-btn cta-purple" onclick="startSwipe()">
        Let's Go!
      </button>
    </div>

    <!-- =============================================
         SCREEN: SWIPE
         ============================================= -->
    <div class="screen" id="screenSwipe">
      <div class="swipe-header">
        <span class="brand-mark">ZEIL</span>
        <span class="card-counter" id="cardCounter">1 / 6</span>
      </div>

      <div class="progress-dots" id="progressDots"></div>

      <div class="card-stack" id="cardStack"></div>

      <div class="hint-row">
        <div class="hint-group">
          <button class="hint-btn hint-pass" onclick="buttonSwipe('left')">‚úó</button>
          <span class="hint-label">Pass</span>
        </div>
        <div class="hint-group">
          <button class="hint-btn hint-like" onclick="buttonSwipe('right')">‚ô•</button>
          <span class="hint-label">Like</span>
        </div>
      </div>
    </div>

    <!-- =============================================
         SCREEN: RESULT
         ============================================= -->
    <div class="screen" id="screenResult">
      <div class="result-icon">üéØ</div>
      <div class="result-title" id="resultTitle">We've got your vibe!</div>
      <div class="result-sub" id="resultSub">
        Your preferences are locked in. We'll match you with roles that fit.
      </div>

      <div class="pref-chips" id="prefChips"></div>

      <button class="cta-btn cta-purple" onclick="ctaClick()">
        See My Matches
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script>
    // =============================================
    // STATE
    // =============================================
    const cards = CONFIG.cards;
    const totalCards = cards.length;
    let currentIndex = 0;
    let preferences = [];
    let isDragging = false;
    let startX = 0, startY = 0, currentX = 0;
    let activeCard = null;

    const SWIPE_THRESHOLD = 80; // px to trigger swipe
    const MAX_ROTATION = 18;    // degrees

    if (!CONFIG.includeDismissButton) {
      document.getElementById('dismissBtn').classList.add('hidden');
    }

    // =============================================
    // START
    // =============================================
    window.startSwipe = function () {
      pushEvent(CONFIG.events.swipeStarted, { Total_Cards: totalCards });
      showScreen('screenSwipe');
      buildDots();
      renderStack();
    };

    // =============================================
    // PROGRESS DOTS
    // =============================================
    function buildDots() {
      const container = document.getElementById('progressDots');
      container.innerHTML = '';
      for (let i = 0; i < totalCards; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot' + (i === 0 ? ' current' : '');
        container.appendChild(dot);
      }
    }

    function updateDots() {
      const dots = document.querySelectorAll('.dot');
      dots.forEach((d, i) => {
        d.className = 'dot';
        if (i < currentIndex) d.classList.add('done');
        if (i === currentIndex) d.classList.add('current');
      });
    }

    // =============================================
    // RENDER CARD STACK
    // =============================================
    function renderStack() {
      const stack = document.getElementById('cardStack');
      stack.innerHTML = '';

      // Show up to 3 cards
      for (let i = Math.min(currentIndex + 2, totalCards - 1); i >= currentIndex; i--) {
        const card = cards[i];
        const el = document.createElement('div');
        el.className = 'swipe-card';
        el.dataset.index = i;

        const offset = i - currentIndex;
        if (offset === 1) el.classList.add('behind-1');
        if (offset === 2) el.classList.add('behind-2');

        el.innerHTML = `
          <div class="overlay-left">${card.leftLabel}</div>
          <div class="overlay-right">${card.rightLabel}</div>
          <div class="card-emoji">${card.emoji}</div>
          <div class="card-title">${card.title}</div>
          <div class="card-subtitle">${card.subtitle}</div>
        `;

        stack.appendChild(el);

        // Attach touch events only to top card
        if (offset === 0) {
          attachDragEvents(el);
          activeCard = el;
        }
      }

      document.getElementById('cardCounter').textContent =
        `${currentIndex + 1} / ${totalCards}`;
    }

    // =============================================
    // DRAG / SWIPE LOGIC
    // =============================================
    function attachDragEvents(el) {
      el.addEventListener('pointerdown', onPointerDown, { passive: false });
    }

    function onPointerDown(e) {
      if (e.target.closest('.hint-btn')) return;
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      currentX = 0;

      activeCard.style.transition = 'none';

      document.addEventListener('pointermove', onPointerMove, { passive: false });
      document.addEventListener('pointerup', onPointerUp);
    }

    function onPointerMove(e) {
      if (!isDragging) return;
      e.preventDefault();

      currentX = e.clientX - startX;
      const rotation = (currentX / window.innerWidth) * MAX_ROTATION;
      const opacity = Math.min(Math.abs(currentX) / SWIPE_THRESHOLD, 1);

      activeCard.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;

      // Show directional overlay
      const overlayR = activeCard.querySelector('.overlay-right');
      const overlayL = activeCard.querySelector('.overlay-left');

      if (currentX > 20) {
        overlayR.style.opacity = opacity;
        overlayL.style.opacity = 0;
        activeCard.style.borderColor = `rgba(16,185,129,${opacity * 0.4})`;
      } else if (currentX < -20) {
        overlayL.style.opacity = opacity;
        overlayR.style.opacity = 0;
        activeCard.style.borderColor = `rgba(244,63,94,${opacity * 0.4})`;
      } else {
        overlayR.style.opacity = 0;
        overlayL.style.opacity = 0;
        activeCard.style.borderColor = 'rgba(124,58,237,0.25)';
      }
    }

    function onPointerUp() {
      if (!isDragging) return;
      isDragging = false;

      document.removeEventListener('pointermove', onPointerMove);
      document.removeEventListener('pointerup', onPointerUp);

      if (Math.abs(currentX) >= SWIPE_THRESHOLD) {
        const direction = currentX > 0 ? 'right' : 'left';
        flyOff(direction);
      } else {
        // Snap back
        activeCard.style.transition = 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.3s ease';
        activeCard.style.transform = 'translateX(0) rotate(0deg)';
        activeCard.style.borderColor = 'rgba(124,58,237,0.25)';
        activeCard.querySelector('.overlay-right').style.opacity = 0;
        activeCard.querySelector('.overlay-left').style.opacity = 0;
      }
    }

    // =============================================
    // FLY OFF & RECORD
    // =============================================
    function flyOff(direction) {
      const flyX = direction === 'right' ? window.innerWidth + 100 : -(window.innerWidth + 100);
      const flyRotation = direction === 'right' ? 30 : -30;

      activeCard.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease';
      activeCard.style.transform = `translateX(${flyX}px) rotate(${flyRotation}deg)`;
      activeCard.style.opacity = '0';

      // Record preference
      const card = cards[currentIndex];
      const liked = direction === 'right';

      preferences.push({ id: card.id, title: card.title, liked });

      pushEvent(CONFIG.events.cardSwiped, {
        Card_Index: currentIndex + 1,
        Card_ID: card.id,
        Card_Title: card.title,
        Direction: direction,
        Liked: liked,
      });

      // Advance
      setTimeout(() => {
        currentIndex++;

        if (currentIndex >= totalCards) {
          showResult();
        } else {
          updateDots();
          renderStack();
        }
      }, 350);
    }

    // Button-triggered swipe
    window.buttonSwipe = function (direction) {
      if (!activeCard || currentIndex >= totalCards) return;

      const flyX = direction === 'right' ? window.innerWidth + 100 : -(window.innerWidth + 100);
      const overlay = direction === 'right'
        ? activeCard.querySelector('.overlay-right')
        : activeCard.querySelector('.overlay-left');

      overlay.style.opacity = '1';

      setTimeout(() => flyOff(direction), 150);
    };

    // =============================================
    // RESULT
    // =============================================
    function showResult() {
      const m = document.getElementById('modal');
      m.style.background = CONFIG.backgrounds.result;
      showScreen('screenResult');

      document.getElementById('resultTitle').textContent = CONFIG.result.title;
      document.getElementById('resultSub').textContent = CONFIG.result.subtitle;

      // Build preference chips
      const container = document.getElementById('prefChips');
      container.innerHTML = '';

      preferences.forEach((p, i) => {
        const chip = document.createElement('span');
        chip.className = 'pref-chip ' + (p.liked ? 'liked' : 'passed');
        const icon = p.liked ? '‚úì' : '‚Äî';
        chip.innerHTML = `${icon} ${p.title}`;
        chip.style.animationDelay = `${i * 0.08}s`;
        container.appendChild(chip);
      });

      // Build profile update payload
      const profileProps = {};
      preferences.forEach(p => {
        profileProps['Pref_' + p.id] = p.liked;
      });
      pushProfile(profileProps);

      pushEvent(CONFIG.events.swipeCompleted, {
        Total_Liked: preferences.filter(p => p.liked).length,
        Total_Passed: preferences.filter(p => !p.liked).length,
        Preferences: JSON.stringify(preferences),
      });

      if (CONFIG.enableConfettiOnComplete) {
        setTimeout(() => fireConfetti(), 400);
      }
    }

    // =============================================
    // ACTIONS
    // =============================================
    window.ctaClick = function () {
      pushEvent(CONFIG.events.swipeCtaClicked, {
        Liked: preferences.filter(p => p.liked).map(p => p.id),
      });
      if (CONFIG.result.ctaUrl) window.location.href = CONFIG.result.ctaUrl;
    };

    window.dismiss = function () {
      pushEvent(CONFIG.events.swipeDismissed, {
        Cards_Swiped: currentIndex,
        Total_Cards: totalCards,
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.dismissInAppNotification) {
          CleverTap.dismissInAppNotification(); return;
        }
      } catch (e) {}
      window.location.href = 'wzrk://exit';
    };

    // =============================================
    // UTILITIES
    // =============================================
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active', 'screen-enter'));
      const el = document.getElementById(id);
      el.classList.add('active', 'screen-enter');
    }

    function pushEvent(name, props) {
      const payload = props || {};
      payload.Timestamp = new Date().toISOString();
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(payload));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, payload);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ type: 'event', name, props: payload }));
      } catch (e) { console.log('[CT]', name, payload); }
    }

    function pushProfile(props) {
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.profile)
          CleverTap.profile.push({ Site: props });
        if (typeof clevertap !== 'undefined' && clevertap.profile)
          clevertap.profile.push({ Site: props });
      } catch (e) { console.log('[CT Profile]', props); }
    }

    function fireConfetti() {
      if (typeof confetti === 'undefined') return;
      const c = confetti.create(document.getElementById('confettiCanvas'), { resize: true, useWorker: true });
      c({ particleCount: 60, spread: 90, origin: { y: 0.45 }, colors: ['#7C3AED', '#A78BFA', '#10B981', '#FFD700', '#FFF'], ticks: 150 });
      setTimeout(() => c({ particleCount: 40, spread: 120, origin: { y: 0.5 }, colors: ['#7C3AED', '#FFD700'], ticks: 120 }), 250);
    }
  </script>
</body>
</html>
