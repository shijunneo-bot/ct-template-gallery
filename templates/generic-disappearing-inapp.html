<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Disappearing InApp</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:transparent;--card:#171B24;
    --border:rgba(255,255,255,0.08);
    --orange:#F97316;--orange-dark:#EA580C;--orange-glow:rgba(249,115,22,0.15);
    --text:#EAEAEA;--muted:rgba(255,255,255,0.45);
  }
  body{
    font-family:'DM Sans',sans-serif;background:var(--bg);
    color:var(--text);max-width:390px;margin:0 auto;
    min-height:100vh;display:flex;flex-direction:column;
    justify-content:flex-end;padding:16px;
    overflow:hidden;
  }

  .popup{
    width:100%;background:var(--card);
    border:1px solid var(--border);border-radius:18px;
    overflow:hidden;position:relative;
    animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
    box-shadow:0 20px 60px rgba(0,0,0,0.5);
  }
  @keyframes popIn{0%{opacity:0;transform:translateY(40px) scale(0.95)}100%{opacity:1;transform:translateY(0) scale(1)}}
  @keyframes popOut{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(40px)}}

  /* Timer bar */
  .timer-bar{
    height:3px;background:rgba(255,255,255,0.06);
    position:relative;overflow:hidden;
  }
  .timer-fill{
    position:absolute;top:0;right:0;height:100%;
    background:var(--orange);width:100%;
    /* Duration set by JS */
  }

  /* Content */
  .popup-content{
    display:flex;align-items:center;gap:14px;
    padding:16px 18px;
  }
  .popup-icon{
    width:48px;height:48px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    font-size:24px;flex-shrink:0;
    background:var(--orange-glow);
  }
  .popup-body{flex:1;min-width:0}
  .popup-tag{
    display:inline-block;font-size:9px;font-weight:600;
    letter-spacing:1px;text-transform:uppercase;
    color:var(--orange);margin-bottom:4px;
  }
  .popup-title{
    font-size:14px;font-weight:700;color:#fff;
    margin-bottom:2px;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .popup-desc{font-size:12px;color:var(--muted);line-height:1.4}

  /* CTA area */
  .popup-cta{
    padding:0 18px 16px;display:flex;gap:8px;
  }
  .btn-act{
    flex:1;padding:12px;border:none;border-radius:12px;
    background:var(--orange);color:#fff;
    font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;
    cursor:pointer;transition:all 0.2s;
  }
  .btn-act:active{transform:scale(0.96);background:var(--orange-dark)}
  .btn-dismiss-small{
    padding:12px 16px;border:none;border-radius:12px;
    background:rgba(255,255,255,0.06);color:var(--muted);
    font-family:'DM Sans',sans-serif;font-size:12px;font-weight:500;
    cursor:pointer;flex-shrink:0;
  }

  /* Swipe hint */
  .swipe-hint{
    text-align:center;padding:6px;
    font-size:10px;color:rgba(255,255,255,0.2);
  }
</style>
</head>
<body>

<script>
  const CONFIG = {
    // Auto-dismiss duration in seconds
    autoDismissSeconds: 5,

    // Show dismiss button or purely auto-dismiss
    showDismissButton: true,

    content: {
      tag: "Flash deal",
      icon: "âš¡",
      title: "50% off Premium â€” next 2 hours only",
      desc: "Upgrade now before this offer disappears",
      ctaText: "Claim Offer",
      ctaUrl: "app://upgrade?promo=FLASH50",
      dismissText: "Skip",
    },

    tracking: {
      eventPrefix: "DisappearingInApp",
    },
  };
</script>

<div class="popup" id="popup">
  <div class="timer-bar">
    <div class="timer-fill" id="timerFill"></div>
  </div>

  <div class="popup-content">
    <div class="popup-icon" id="popIcon"></div>
    <div class="popup-body">
      <div class="popup-tag" id="popTag"></div>
      <div class="popup-title" id="popTitle"></div>
      <div class="popup-desc" id="popDesc"></div>
    </div>
  </div>

  <div class="popup-cta">
    <button class="btn-act" id="btnAct" onclick="ctaClick()"></button>
    <button class="btn-dismiss-small" id="btnDis" onclick="dismissNow()" style="display:none"></button>
  </div>

  <div class="swipe-hint">Auto-closes in <span id="countdown"></span>s</div>
</div>

<script>
  const { autoDismissSeconds, showDismissButton, content, tracking } = CONFIG;

  document.getElementById('popIcon').textContent = content.icon;
  document.getElementById('popTag').textContent = content.tag;
  document.getElementById('popTitle').textContent = content.title;
  document.getElementById('popDesc').textContent = content.desc;
  document.getElementById('btnAct').textContent = content.ctaText;

  if (showDismissButton) {
    const btn = document.getElementById('btnDis');
    btn.style.display = 'block';
    btn.textContent = content.dismissText;
  }

  // Timer bar animation
  const fill = document.getElementById('timerFill');
  fill.style.transition = 'width ' + autoDismissSeconds + 's linear';
  requestAnimationFrame(function() {
    requestAnimationFrame(function() {
      fill.style.width = '0%';
    });
  });

  // Countdown text
  let remaining = autoDismissSeconds;
  document.getElementById('countdown').textContent = remaining;
  const cdInterval = setInterval(function() {
    remaining--;
    document.getElementById('countdown').textContent = Math.max(0, remaining);
    if (remaining <= 0) {
      clearInterval(cdInterval);
      autoDismiss();
    }
  }, 1000);

  trackEvent(tracking.eventPrefix + '_Viewed', {
    content: content.title,
    duration: autoDismissSeconds
  });

  function ctaClick() {
    clearInterval(cdInterval);
    trackEvent(tracking.eventPrefix + '_CTA_Clicked', { content: content.title });
    if (content.ctaUrl) window.location.href = content.ctaUrl;
    try { window.location.href = 'wzrk://exit'; } catch(e) {}
  }

  function dismissNow() {
    clearInterval(cdInterval);
    trackEvent(tracking.eventPrefix + '_Dismissed_Manual');
    fadeAndExit();
  }

  function autoDismiss() {
    trackEvent(tracking.eventPrefix + '_AutoDismissed', {
      content: content.title,
      duration: autoDismissSeconds
    });
    fadeAndExit();
  }

  function fadeAndExit() {
    const popup = document.getElementById('popup');
    popup.style.animation = 'popOut 0.4s ease forwards';
    setTimeout(function() {
      try { window.location.href = 'wzrk://exit'; } catch(e) {}
    }, 400);
  }

  // Pause timer on touch (resume on release)
  let paused = false;
  document.getElementById('popup').addEventListener('touchstart', function() {
    if (!paused) {
      paused = true;
      fill.style.animationPlayState = 'paused';
      fill.style.transitionProperty = 'none';
    }
  });
  document.getElementById('popup').addEventListener('touchend', function() {
    if (paused) {
      paused = false;
      const currentWidth = fill.getBoundingClientRect().width;
      const totalWidth = fill.parentElement.getBoundingClientRect().width;
      const remainPercent = (currentWidth / totalWidth) * 100;
      const remainTime = (remainPercent / 100) * autoDismissSeconds;
      fill.style.transition = 'width ' + remainTime + 's linear';
      fill.style.width = '0%';
    }
  });

  function trackEvent(name, props) {
    console.log('CT Event:', name, props || {});
    if (window.CleverTap) window.CleverTap.pushEvent(name, props || {});
    if (window.clevertap) window.clevertap.event.push(name, props || {});
    try { window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ event: name, properties: props || {} })); } catch(e) {}
  }
</script>
</body>
</html>
