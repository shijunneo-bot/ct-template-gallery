<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "Pizza Hut",
        tagline: "No One OutPizzas the Hut",
        red: "#EE3A43",
        redDark: "#C90014",
        redDeep: "#8B0000",
        black: "#1A1A1A",
        warmBrown: "#3D2B1F",
        cardboard: "#D4A96A",
        cardboardLight: "#E8CFA0",
        cardboardDark: "#A67C4A",
        cheese: "#FFD700",
        cheeseLight: "#FFF3C4",
        white: "#FFFFFF",
        green: "#2D8B46",
      },

      backgrounds: {
        main: "linear-gradient(170deg, #1A0A0A 0%, #2D1010 35%, #1A0A0A 100%)",
      },

      enableConfettiOnReveal: true,

      // üìÖ Campaign dates ‚Äî adjust per campaign
      campaign: {
        startDate: "2026-02-16",    // Day 1
        title: "7 Days of Pizza Deals!",
        subtitle: "Open a box each day to reveal your slice of savings. Don't miss a day!",
      },

      // üçï Daily rewards ‚Äî each "door" is a pizza box
      // Emojis represent the pizza slice / reward visual
      days: [
        { emoji: "üçï", reward: "Free Garlic Bread",           code: "GARLIC7",    value: "worth RM8.90",   tier: "common" },
        { emoji: "ü•§", reward: "Free Pepsi 1.5L",             code: "PEPSI7",     value: "worth RM6.90",   tier: "common" },
        { emoji: "üçï", reward: "50% Off Any Regular Pizza",   code: "HALF7",      value: "up to RM20 off", tier: "rare" },
        { emoji: "üçó", reward: "Free Wingstreet 6pcs",        code: "WINGS7",     value: "worth RM15.90",  tier: "common" },
        { emoji: "üßÄ", reward: "Free Cheese Upgrade",         code: "CHEESE7",    value: "on any pizza",   tier: "common" },
        { emoji: "üçï", reward: "Buy 1 Free 1 Large Pizza",    code: "BOGO7",      value: "save up to RM40", tier: "epic" },
        { emoji: "üèÜ", reward: "Free Large Pizza!",           code: "FREEPIZZA",  value: "any flavour",    tier: "legendary" },
      ],

      // üé® Tier glow colors
      tierColors: {
        common:    { glow: "rgba(255,215,0,0.3)",  border: "#FFD700",  label: "" },
        rare:      { glow: "rgba(59,130,246,0.4)", border: "#3B82F6",  label: "RARE" },
        epic:      { glow: "rgba(168,85,247,0.4)", border: "#A855F7",  label: "EPIC" },
        legendary: { glow: "rgba(238,58,67,0.5)",  border: "#EE3A43",  label: "LEGENDARY" },
      },

      cta: {
        text: "Order Now",
        url: "https://www.pizzahut.com.my/",
      },

      events: {
        calendarViewed:   "Advent_Calendar_Viewed",
        doorOpened:       "Advent_Door_Opened",
        rewardCopied:     "Advent_Reward_Copied",
        ctaClicked:       "Advent_CTA_Clicked",
        calendarDismissed: "Advent_Calendar_Dismissed",
      },
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pizza Hut ‚Äî 7 Days of Deals</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap');

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      font-family: 'Fredoka', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      background: #1A0A0A;
    }

    .modal {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center;
      padding: 16px 16px 20px;
      position: relative; overflow-y: auto; overflow-x: hidden;
      background: linear-gradient(170deg, #1A0A0A 0%, #2D1010 35%, #1A0A0A 100%);
      -webkit-overflow-scrolling: touch;
    }

    /* Warm ambient glow */
    .modal::before {
      content: '';
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 30% 20%, rgba(238,58,67,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(255,215,0,0.05) 0%, transparent 50%);
      pointer-events: none; z-index: 0;
    }

    /* Dismiss */
    .dismiss-btn {
      position: fixed; top: 12px; right: 12px;
      width: 30px; height: 30px; border-radius: 50%;
      background: rgba(0,0,0,0.5); border: none;
      color: rgba(255,255,255,0.6); font-size: 14px;
      cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
    }

    /* =============================================
       HEADER
       ============================================= */
    .header {
      position: relative; z-index: 1;
      text-align: center;
      margin-bottom: 16px;
      width: 100%; max-width: 380px;
    }

    .brand-badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(238,58,67,0.15);
      border: 1px solid rgba(238,58,67,0.25);
      border-radius: 100px; padding: 5px 14px;
      margin-bottom: 10px;
    }
    .brand-badge .dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: #EE3A43;
    }
    .brand-badge span {
      font-size: 11px; font-weight: 600;
      color: rgba(255,255,255,0.7);
      letter-spacing: 0.3px;
    }

    .header-title {
      font-size: 22px; font-weight: 700;
      color: #FFFFFF;
      line-height: 1.2; margin-bottom: 6px;
    }
    .header-title span { color: #EE3A43; }

    .header-sub {
      font-size: 12px; font-weight: 400;
      color: rgba(255,255,255,0.45);
      line-height: 1.4;
      max-width: 300px; margin: 0 auto;
    }

    /* Day indicator */
    .day-indicator {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,215,0,0.1);
      border: 1px solid rgba(255,215,0,0.2);
      border-radius: 8px; padding: 6px 12px;
      margin-top: 10px;
    }
    .day-indicator span {
      font-size: 11px; font-weight: 600;
      color: #FFD700;
    }

    /* =============================================
       PIZZA BOX GRID
       ============================================= */
    .box-grid {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      width: 100%; max-width: 380px;
      margin-bottom: 16px;
    }

    /* Last row center alignment for 7th box */
    .box-grid .pizza-box:nth-child(7) {
      grid-column: 2;
    }

    /* =============================================
       INDIVIDUAL PIZZA BOX (3D Flip)
       ============================================= */
    .pizza-box {
      perspective: 600px;
      aspect-ratio: 1;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .box-inner {
      position: relative;
      width: 100%; height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    .pizza-box.flipped .box-inner {
      transform: rotateY(180deg);
    }

    .box-front, .box-back {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: 14px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }

    /* ---- FRONT: Pizza Box Lid ---- */
    .box-front {
      /* Cardboard texture */
      background:
        linear-gradient(145deg, #C9935A 0%, #B8834A 50%, #A67339 100%);
      border: 2px solid rgba(0,0,0,0.15);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -2px 0 rgba(0,0,0,0.1),
        0 3px 10px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    /* Fold lines on box */
    .box-front::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        linear-gradient(45deg, transparent 48%, rgba(0,0,0,0.04) 49%, rgba(0,0,0,0.04) 51%, transparent 52%),
        linear-gradient(-45deg, transparent 48%, rgba(0,0,0,0.04) 49%, rgba(0,0,0,0.04) 51%, transparent 52%);
      pointer-events: none;
    }

    /* Red circle stamp on box */
    .box-stamp {
      width: 52px; height: 52px; border-radius: 50%;
      background: #EE3A43;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 8px rgba(238,58,67,0.4);
      position: relative;
    }
    .box-stamp .day-num {
      font-size: 22px; font-weight: 700;
      color: #FFFFFF;
    }
    .box-label {
      font-size: 9px; font-weight: 600;
      color: rgba(0,0,0,0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 4px;
    }

    /* ---- State: Locked ---- */
    .pizza-box.locked .box-front {
      background: linear-gradient(145deg, #8B7355 0%, #7A6348 50%, #6B553D 100%);
      opacity: 0.6;
    }
    .pizza-box.locked .box-stamp {
      background: #666;
      box-shadow: none;
    }
    .pizza-box.locked .box-stamp::after {
      content: 'üîí';
      position: absolute;
      font-size: 14px;
      top: -4px; right: -6px;
    }
    .pizza-box.locked { cursor: default; pointer-events: none; }

    /* ---- State: Today (pulsing) ---- */
    .pizza-box.today .box-front {
      background: linear-gradient(145deg, #D4A96A 0%, #C9935A 50%, #B8834A 100%);
      border-color: #EE3A43;
      animation: todayGlow 2s ease-in-out infinite;
    }
    @keyframes todayGlow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(238,58,67,0.3), inset 0 1px 0 rgba(255,255,255,0.15), 0 3px 10px rgba(0,0,0,0.3); }
      50% { box-shadow: 0 0 0 5px rgba(238,58,67,0), inset 0 1px 0 rgba(255,255,255,0.15), 0 6px 20px rgba(238,58,67,0.2); }
    }
    .pizza-box.today .box-label { color: #EE3A43; font-weight: 700; }

    /* ---- State: Missed ---- */
    .pizza-box.missed .box-front {
      background: linear-gradient(145deg, #5C4C3C 0%, #4D3F32 50%, #3D3228 100%);
      opacity: 0.45;
    }
    .pizza-box.missed .box-stamp { background: #555; }
    .pizza-box.missed .box-stamp::after {
      content: '‚úó';
      position: absolute;
      font-size: 12px; font-weight: 700; color: #EF4444;
      top: -4px; right: -4px;
      background: rgba(0,0,0,0.6);
      width: 16px; height: 16px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
    }
    .pizza-box.missed { cursor: default; pointer-events: none; }

    /* ---- State: Opened (already flipped) ---- */
    .pizza-box.opened { pointer-events: none; }

    /* ---- BACK: Pizza Slice Reveal ---- */
    .box-back {
      transform: rotateY(180deg);
      background: linear-gradient(145deg, #2A1A0A 0%, #1A0F05 100%);
      border: 2px solid rgba(255,215,0,0.2);
      padding: 8px;
      gap: 2px;
    }

    .reveal-emoji {
      font-size: 32px;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3));
      animation: sliceAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes sliceAppear {
      from { transform: scale(0) rotate(-30deg); }
      to   { transform: scale(1) rotate(0deg); }
    }

    .reveal-text {
      font-size: 10px; font-weight: 600;
      color: #FFD700;
      line-height: 1.3;
      text-align: center;
    }
    .reveal-value {
      font-size: 8px; font-weight: 500;
      color: rgba(255,255,255,0.4);
    }

    /* Tier glow on back */
    .box-back.tier-rare {
      border-color: rgba(59,130,246,0.4);
      box-shadow: 0 0 15px rgba(59,130,246,0.15);
    }
    .box-back.tier-epic {
      border-color: rgba(168,85,247,0.4);
      box-shadow: 0 0 15px rgba(168,85,247,0.15);
    }
    .box-back.tier-legendary {
      border-color: rgba(238,58,67,0.5);
      box-shadow: 0 0 20px rgba(238,58,67,0.2);
    }

    .tier-label {
      font-size: 7px; font-weight: 700;
      letter-spacing: 1px;
      padding: 2px 6px; border-radius: 4px;
      color: #fff;
    }
    .tier-label.rare { background: rgba(59,130,246,0.3); }
    .tier-label.epic { background: rgba(168,85,247,0.3); }
    .tier-label.legendary { background: rgba(238,58,67,0.4); }

    /* =============================================
       REWARD MODAL (overlay after tap)
       ============================================= */
    .reward-overlay {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 200;
      align-items: center; justify-content: center;
      padding: 24px;
    }
    .reward-overlay.show {
      display: flex;
      animation: overlayIn 0.3s ease forwards;
    }
    @keyframes overlayIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .reward-modal {
      width: 100%; max-width: 320px;
      background: linear-gradient(145deg, #2A1A0A 0%, #1F1208 100%);
      border: 1px solid rgba(255,215,0,0.2);
      border-radius: 20px;
      padding: 28px 24px;
      text-align: center;
      position: relative; overflow: hidden;
      animation: rewardPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes rewardPop {
      from { transform: scale(0.8); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    .reward-modal::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, #EE3A43 0%, #FFD700 100%);
    }

    .reward-day-tag {
      display: inline-block;
      font-size: 10px; font-weight: 700;
      color: #EE3A43;
      background: rgba(238,58,67,0.1);
      padding: 4px 10px; border-radius: 6px;
      margin-bottom: 12px;
      letter-spacing: 0.5px;
    }

    .reward-emoji-big {
      font-size: 64px; margin-bottom: 12px;
      animation: sliceAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .reward-title {
      font-size: 18px; font-weight: 700;
      color: #FFFFFF;
      line-height: 1.3; margin-bottom: 4px;
    }
    .reward-value {
      font-size: 12px; font-weight: 500;
      color: rgba(255,255,255,0.4);
      margin-bottom: 16px;
    }

    /* Promo code */
    .promo-box {
      display: flex; align-items: center;
      background: rgba(0,0,0,0.4);
      border: 1.5px dashed rgba(255,215,0,0.35);
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 16px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .promo-code {
      flex: 1;
      font-size: 18px; font-weight: 700;
      color: #FFD700;
      letter-spacing: 2px;
      font-family: 'Courier New', monospace;
      text-align: left;
    }
    .copy-btn {
      font-size: 10px; font-weight: 600;
      color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.08);
      border: none; border-radius: 6px;
      padding: 5px 10px; cursor: pointer;
      font-family: inherit;
    }
    .copy-btn.copied { color: #FFD700; background: rgba(255,215,0,0.15); }

    .reward-cta {
      width: 100%; padding: 14px;
      border-radius: 12px; border: none;
      background: #EE3A43; color: #fff;
      font-family: inherit;
      font-size: 15px; font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(238,58,67,0.3);
      -webkit-tap-highlight-color: transparent;
    }
    .reward-cta:active { transform: scale(0.97); }

    .reward-close {
      margin-top: 12px;
      background: none; border: none;
      color: rgba(255,255,255,0.35);
      font-family: inherit;
      font-size: 12px; font-weight: 500;
      cursor: pointer;
    }

    /* =============================================
       PROGRESS FOOTER
       ============================================= */
    .progress-footer {
      position: relative; z-index: 1;
      width: 100%; max-width: 380px;
      display: flex; align-items: center; gap: 10px;
    }
    .pf-bar-bg {
      flex: 1; height: 6px;
      background: rgba(255,255,255,0.08);
      border-radius: 100px; overflow: hidden;
    }
    .pf-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #EE3A43, #FFD700);
      border-radius: 100px;
      transition: width 0.8s ease;
    }
    .pf-text {
      font-size: 11px; font-weight: 600;
      color: rgba(255,255,255,0.4);
      white-space: nowrap;
    }

    /* Confetti */
    #confettiCanvas {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 999;
    }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="modal" id="modal">
    <button class="dismiss-btn" id="dismissBtn" onclick="dismiss()">‚úï</button>

    <!-- Header -->
    <div class="header">
      <div class="brand-badge">
        <div class="dot"></div>
        <span>Pizza Hut</span>
      </div>
      <div class="header-title">
        7 Days of <span>Pizza Deals</span>!
      </div>
      <div class="header-sub" id="headerSub">
        Open a box each day to reveal your slice of savings. Don't miss a day!
      </div>
      <div class="day-indicator" id="dayIndicator">
        <span id="dayText">üìÖ Day 1 of 7</span>
      </div>
    </div>

    <!-- Pizza Box Grid -->
    <div class="box-grid" id="boxGrid"></div>

    <!-- Progress Footer -->
    <div class="progress-footer">
      <div class="pf-bar-bg">
        <div class="pf-bar-fill" id="pfFill" style="width: 0%"></div>
      </div>
      <span class="pf-text" id="pfText">0/7 opened</span>
    </div>
  </div>

  <!-- Reward Overlay -->
  <div class="reward-overlay" id="rewardOverlay">
    <div class="reward-modal">
      <div class="reward-day-tag" id="rDayTag">DAY 1</div>
      <div class="reward-emoji-big" id="rEmoji">üçï</div>
      <div class="reward-title" id="rTitle">Free Garlic Bread</div>
      <div class="reward-value" id="rValue">worth RM8.90</div>
      <div class="promo-box" onclick="copyCode()">
        <span class="promo-code" id="rCode">GARLIC7</span>
        <button class="copy-btn" id="rCopyBtn">Copy</button>
      </div>
      <button class="reward-cta" onclick="orderNow()">Order Now</button>
      <button class="reward-close" onclick="closeReward()">Back to calendar</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script>
    // =============================================
    // STATE
    // =============================================
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const campaignStart = new Date(CONFIG.campaign.startDate + 'T00:00:00');
    const dayIndex = Math.floor((today - campaignStart) / (1000 * 60 * 60 * 24)); // 0-based
    const totalDays = CONFIG.days.length;

    // Track opened state (in production: CleverTap profile property)
    let openedDays = JSON.parse(localStorage.getItem('ph_advent_opened') || '[]');

    // Dismiss
    if (!CONFIG.includeDismissButton) {
      document.getElementById('dismissBtn').classList.add('hidden');
    }

    let currentRewardDay = -1;

    // =============================================
    // BUILD GRID
    // =============================================
    function buildGrid() {
      const grid = document.getElementById('boxGrid');
      grid.innerHTML = '';

      for (let i = 0; i < totalDays; i++) {
        const box = document.createElement('div');
        box.className = 'pizza-box';
        box.dataset.day = i;

        const dayData = CONFIG.days[i];
        const tierClass = dayData.tier !== 'common' ? `tier-${dayData.tier}` : '';
        const tierLabel = CONFIG.tierColors[dayData.tier]?.label || '';

        // Determine state
        const isOpened = openedDays.includes(i);
        const isToday = i === dayIndex;
        const isPast = i < dayIndex;
        const isFuture = i > dayIndex;

        if (isOpened) {
          box.classList.add('opened', 'flipped');
        } else if (isToday) {
          box.classList.add('today');
          box.onclick = () => openBox(i);
        } else if (isPast) {
          box.classList.add('missed');
        } else {
          box.classList.add('locked');
        }

        box.innerHTML = `
          <div class="box-inner">
            <div class="box-front">
              <div class="box-stamp">
                <span class="day-num">${i + 1}</span>
              </div>
              <span class="box-label">${isToday ? 'TAP TO OPEN' : 'Day ' + (i + 1)}</span>
            </div>
            <div class="box-back ${tierClass}">
              <span class="reveal-emoji">${dayData.emoji}</span>
              <span class="reveal-text">${dayData.reward}</span>
              <span class="reveal-value">${dayData.value}</span>
              ${tierLabel ? `<span class="tier-label ${dayData.tier}">${tierLabel}</span>` : ''}
            </div>
          </div>
        `;

        grid.appendChild(box);
      }

      updateProgress();
      updateDayIndicator();
    }

    // =============================================
    // OPEN BOX
    // =============================================
    function openBox(dayIdx) {
      if (openedDays.includes(dayIdx)) return;

      const box = document.querySelector(`.pizza-box[data-day="${dayIdx}"]`);
      if (!box) return;

      // Flip the box
      box.classList.add('flipped', 'opened');
      box.classList.remove('today');
      box.style.pointerEvents = 'none';

      // Save state
      openedDays.push(dayIdx);
      try { localStorage.setItem('ph_advent_opened', JSON.stringify(openedDays)); } catch(e) {}

      // Show reward modal after flip
      currentRewardDay = dayIdx;
      setTimeout(() => showRewardModal(dayIdx), 700);

      // Update progress
      updateProgress();

      // Fire event
      const dayData = CONFIG.days[dayIdx];
      pushEvent(CONFIG.events.doorOpened, {
        Day: dayIdx + 1,
        Reward: dayData.reward,
        Code: dayData.code,
        Tier: dayData.tier,
        Days_Opened: openedDays.length,
      });

      // Confetti for rare+ tiers
      if (CONFIG.enableConfettiOnReveal && dayData.tier !== 'common') {
        setTimeout(() => fireConfetti(dayData.tier), 800);
      }
    }

    // =============================================
    // REWARD MODAL
    // =============================================
    function showRewardModal(dayIdx) {
      const day = CONFIG.days[dayIdx];
      document.getElementById('rDayTag').textContent = `DAY ${dayIdx + 1}`;
      document.getElementById('rEmoji').textContent = day.emoji;
      document.getElementById('rTitle').textContent = day.reward;
      document.getElementById('rValue').textContent = day.value;
      document.getElementById('rCode').textContent = day.code;
      document.getElementById('rCopyBtn').textContent = 'Copy';
      document.getElementById('rCopyBtn').classList.remove('copied');

      document.getElementById('rewardOverlay').classList.add('show');
    }

    window.closeReward = function () {
      document.getElementById('rewardOverlay').classList.remove('show');
    };

    window.copyCode = function () {
      const code = CONFIG.days[currentRewardDay]?.code || '';
      const btn = document.getElementById('rCopyBtn');

      try {
        const ta = document.createElement('textarea');
        ta.value = code; ta.style.cssText = 'position:fixed;opacity:0';
        document.body.appendChild(ta); ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      } catch (e) {
        if (navigator.clipboard) navigator.clipboard.writeText(code).catch(() => {});
      }

      btn.textContent = 'Copied!';
      btn.classList.add('copied');

      pushEvent(CONFIG.events.rewardCopied, {
        Day: currentRewardDay + 1,
        Code: code,
      });

      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 3000);
    };

    window.orderNow = function () {
      pushEvent(CONFIG.events.ctaClicked, {
        Day: currentRewardDay + 1,
        Code: CONFIG.days[currentRewardDay]?.code,
      });
      if (CONFIG.cta.url) window.location.href = CONFIG.cta.url;
    };

    // =============================================
    // PROGRESS
    // =============================================
    function updateProgress() {
      const count = openedDays.length;
      const pct = (count / totalDays) * 100;
      document.getElementById('pfFill').style.width = pct + '%';
      document.getElementById('pfText').textContent = `${count}/${totalDays} opened`;
    }

    function updateDayIndicator() {
      const el = document.getElementById('dayText');
      if (dayIndex < 0) {
        el.textContent = 'üîú Campaign starts soon!';
      } else if (dayIndex >= totalDays) {
        el.textContent = '‚úÖ Campaign complete!';
      } else {
        el.textContent = `üìÖ Day ${dayIndex + 1} of ${totalDays}`;
      }
    }

    // =============================================
    // DISMISS
    // =============================================
    window.dismiss = function () {
      pushEvent(CONFIG.events.calendarDismissed, {
        Days_Opened: openedDays.length,
        Current_Day: dayIndex + 1,
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.dismissInAppNotification) {
          CleverTap.dismissInAppNotification(); return;
        }
      } catch (e) {}
      window.location.href = 'wzrk://exit';
    };

    // =============================================
    // CLEVERTAP
    // =============================================
    function pushEvent(name, props) {
      const payload = props || {};
      payload.Timestamp = new Date().toISOString();
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(payload));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, payload);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ type: 'event', name, props: payload }));
      } catch (e) { console.log('[CT]', name, payload); }
    }

    // =============================================
    // CONFETTI
    // =============================================
    function fireConfetti(tier) {
      if (typeof confetti === 'undefined') return;
      const c = confetti.create(document.getElementById('confettiCanvas'), { resize: true, useWorker: true });
      const colors = tier === 'legendary'
        ? ['#EE3A43', '#FFD700', '#FFF', '#FF6B6B']
        : tier === 'epic'
          ? ['#A855F7', '#C084FC', '#FFD700', '#FFF']
          : ['#3B82F6', '#60A5FA', '#FFD700', '#FFF'];

      c({ particleCount: 80, spread: 100, origin: { y: 0.4 }, colors, ticks: 160 });
      setTimeout(() => c({ particleCount: 50, spread: 130, origin: { y: 0.5 }, colors, ticks: 120 }), 300);
    }

    // =============================================
    // INIT
    // =============================================
    buildGrid();
    pushEvent(CONFIG.events.calendarViewed, {
      Campaign_Day: dayIndex + 1,
      Days_Opened: openedDays.length,
      Total_Days: totalDays,
    });
  </script>
</body>
</html>
