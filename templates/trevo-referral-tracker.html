<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Referral Tracker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --teal:#00BFA6;--teal-dark:#009E8B;--teal-glow:rgba(0,191,166,0.15);
    --purple:#7B61FF;--purple-glow:rgba(123,97,255,0.15);
    --gold:#FFB81C;--gold-glow:rgba(255,184,28,0.12);
    --dark:#0F1419;--card:#1A1F26;--card2:#222830;
    --border:rgba(255,255,255,0.06);
    --text:#FFFFFF;--muted:rgba(255,255,255,0.45);
  }
  body{
    font-family:'DM Sans',sans-serif;background:var(--dark);
    color:var(--text);max-width:390px;margin:0 auto;
    min-height:100vh;padding:0;overflow-x:hidden;
  }

  /* Dismiss */
  .dismiss{
    position:fixed;top:12px;right:12px;width:28px;height:28px;
    background:rgba(255,255,255,0.08);border:none;border-radius:50%;
    color:var(--muted);font-size:14px;cursor:pointer;z-index:10;
    display:flex;align-items:center;justify-content:center;
  }
  .dismiss:active{background:rgba(255,255,255,0.15)}

  /* Header */
  .header{padding:20px 20px 0;animation:fadeIn 0.4s ease both}
  .brand-row{display:flex;align-items:center;gap:10px;margin-bottom:20px}
  .brand-mark{
    width:34px;height:34px;background:var(--teal);border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    font-size:14px;font-weight:700;color:var(--dark);
  }
  .brand-label{font-size:12px;font-weight:500;color:var(--muted)}
  .header h1{font-size:22px;font-weight:700;line-height:1.3;margin-bottom:4px}
  .header h1 em{font-style:normal;color:var(--teal)}
  .header p{font-size:13px;color:var(--muted);line-height:1.5}

  /* Progress section */
  .progress-section{
    padding:20px;animation:fadeIn 0.5s ease 0.1s both;
  }
  .progress-track{
    display:flex;align-items:center;gap:0;
    margin-bottom:16px;position:relative;
  }
  .node{
    width:44px;height:44px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-size:16px;font-weight:700;position:relative;z-index:2;
    flex-shrink:0;transition:all 0.4s ease;
  }
  .node.done{background:var(--teal);color:var(--dark);box-shadow:0 0 16px var(--teal-glow)}
  .node.current{
    background:var(--card2);border:2px solid var(--teal);color:var(--teal);
    animation:pulseNode 2s ease infinite;
  }
  .node.locked{background:var(--card2);color:var(--muted);border:2px solid var(--border)}
  @keyframes pulseNode{0%,100%{box-shadow:0 0 0 0 var(--teal-glow)}50%{box-shadow:0 0 0 8px transparent}}
  .connector{flex:1;height:3px;background:var(--card2);position:relative;z-index:1}
  .connector.done{background:var(--teal)}
  .connector.active{
    background:linear-gradient(90deg,var(--teal),var(--card2));
  }

  .progress-labels{
    display:flex;justify-content:space-between;
    padding:0 4px;margin-bottom:6px;
  }
  .p-label{
    font-size:10px;color:var(--muted);text-align:center;
    width:44px;flex-shrink:0;
  }
  .p-label.active{color:var(--teal);font-weight:600}

  .progress-stat{
    text-align:center;padding:12px;
    background:var(--teal-glow);border-radius:12px;
    font-size:13px;color:var(--teal);font-weight:600;
  }
  .progress-stat span{font-size:22px;font-weight:700}

  /* Reward tiers */
  .tiers{padding:0 20px 16px;animation:fadeIn 0.5s ease 0.2s both}
  .tiers-title{font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:10px}
  .tier-card{
    display:flex;align-items:center;gap:12px;
    padding:14px;background:var(--card);border:1px solid var(--border);
    border-radius:14px;margin-bottom:8px;transition:all 0.3s;
  }
  .tier-card.unlocked{border-color:rgba(0,191,166,0.2);background:var(--teal-glow)}
  .tier-card.next{border-color:rgba(123,97,255,0.2)}
  .tier-icon{
    width:40px;height:40px;border-radius:10px;
    display:flex;align-items:center;justify-content:center;font-size:18px;
    flex-shrink:0;
  }
  .tier-card.unlocked .tier-icon{background:rgba(0,191,166,0.12)}
  .tier-card.next .tier-icon{background:rgba(123,97,255,0.12)}
  .tier-card.locked .tier-icon{background:rgba(255,255,255,0.04);filter:grayscale(0.8);opacity:0.5}
  .tier-body{flex:1;min-width:0}
  .tier-name{font-size:13px;font-weight:600}
  .tier-card.locked .tier-name{color:var(--muted)}
  .tier-desc{font-size:11px;color:var(--muted);margin-top:2px}
  .tier-badge{
    font-size:10px;font-weight:600;padding:4px 8px;border-radius:6px;
    flex-shrink:0;
  }
  .badge-unlocked{background:rgba(0,191,166,0.15);color:var(--teal)}
  .badge-next{background:rgba(123,97,255,0.15);color:var(--purple)}
  .badge-locked{background:rgba(255,255,255,0.04);color:var(--muted)}

  /* Referral code + share */
  .share-section{
    padding:0 20px 20px;animation:fadeIn 0.5s ease 0.3s both;
  }
  .code-card{
    background:var(--card);border:1px solid var(--border);
    border-radius:16px;padding:18px;text-align:center;
    margin-bottom:14px;
  }
  .code-label{
    font-size:10px;font-weight:600;letter-spacing:1.5px;
    text-transform:uppercase;color:var(--muted);margin-bottom:8px;
  }
  .code-row{display:flex;align-items:center;justify-content:center;gap:10px}
  .code-value{
    font-family:'DM Mono',monospace;font-size:22px;font-weight:500;
    letter-spacing:3px;color:var(--teal);
  }
  .copy-btn{
    width:36px;height:36px;border-radius:10px;
    background:var(--teal-glow);border:1px solid rgba(0,191,166,0.2);
    color:var(--teal);font-size:14px;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    transition:all 0.2s;
  }
  .copy-btn:active{transform:scale(0.9);background:var(--teal)}
  .copy-btn.copied{background:var(--teal);color:var(--dark)}

  .share-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .share-btn{
    display:flex;align-items:center;justify-content:center;gap:8px;
    padding:14px;border-radius:14px;border:none;
    font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;
    cursor:pointer;transition:all 0.2s;
  }
  .share-btn:active{transform:scale(0.96)}
  .share-wa{background:#25D366;color:#fff}
  .share-sms{background:var(--card);border:1px solid var(--border);color:var(--text)}
  .share-btn .s-icon{font-size:16px}

  /* CTA */
  .cta-area{padding:0 20px 24px;animation:fadeIn 0.5s ease 0.4s both}
  .btn-primary{
    width:100%;padding:16px;border:none;border-radius:14px;
    background:var(--teal);color:var(--dark);
    font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;
    cursor:pointer;transition:all 0.2s;
  }
  .btn-primary:active{transform:scale(0.97);background:var(--teal-dark)}

  @keyframes fadeIn{0%{opacity:0;transform:translateY(12px)}100%{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const CONFIG = {
    includeDismissButton: true,

    brand: {
      name: "TREVO",
      mark: "T",
    },

    referral: {
      // Current user's referral count
      count: 3,
      code: "TREVO-SJ2026",
      headline: "Share TREVO, <em>earn rewards</em>",
      subtext: "Every friend who completes their first trip earns you both credits",
    },

    tiers: [
      { friends: 1, reward: "RM10 ride credit", emoji: "ğŸ«", unlockText: "Unlocked" },
      { friends: 3, reward: "RM30 credit + priority pickup", emoji: "âš¡", unlockText: "Unlocked" },
      { friends: 5, reward: "Free weekend ride (up to RM80)", emoji: "ğŸš—", unlockText: "2 more" },
      { friends: 10, reward: "1 month Gold membership", emoji: "ğŸ‘‘", unlockText: "7 more" },
    ],

    share: {
      whatsappText: "Hey! Use my code TREVO-SJ2026 to get RM15 off your first TREVO ride ğŸš— Download here: https://trevo.app.link/ref",
      smsText: "Get RM15 off your first TREVO ride with my code: TREVO-SJ2026. Download: https://trevo.app.link/ref",
    },

    tracking: {
      eventPrefix: "Referral",
      ctaUrl: "trevo://referral",
    },
  };
</script>

<button class="dismiss" id="dismissBtn" onclick="dismiss()" style="display:none">âœ•</button>

<div class="header">
  <div class="brand-row">
    <div class="brand-mark" id="brandMark"></div>
    <div class="brand-label" id="brandLabel"></div>
  </div>
  <h1 id="headline"></h1>
  <p id="subtext"></p>
</div>

<!-- Progress nodes -->
<div class="progress-section">
  <div class="progress-track" id="progressTrack"></div>
  <div class="progress-labels" id="progressLabels"></div>
  <div class="progress-stat" id="progressStat"></div>
</div>

<!-- Reward tiers -->
<div class="tiers">
  <div class="tiers-title">Reward milestones</div>
  <div id="tierList"></div>
</div>

<!-- Referral code + share -->
<div class="share-section">
  <div class="code-card">
    <div class="code-label">Your referral code</div>
    <div class="code-row">
      <div class="code-value" id="codeValue"></div>
      <button class="copy-btn" id="copyBtn" onclick="copyCode()">ğŸ“‹</button>
    </div>
  </div>
  <div class="share-grid">
    <button class="share-btn share-wa" onclick="shareWhatsApp()">
      <span class="s-icon">ğŸ’¬</span> WhatsApp
    </button>
    <button class="share-btn share-sms" onclick="shareSMS()">
      <span class="s-icon">âœ‰ï¸</span> SMS
    </button>
  </div>
</div>

<!-- CTA -->
<div class="cta-area">
  <button class="btn-primary" onclick="ctaClick()">Invite Friends Now</button>
</div>

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INIT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const { brand, referral, tiers, share, tracking, includeDismissButton } = CONFIG;

  if (includeDismissButton) document.getElementById('dismissBtn').style.display = 'flex';
  document.getElementById('brandMark').textContent = brand.mark;
  document.getElementById('brandLabel').textContent = brand.name + ' Referrals';
  document.getElementById('headline').innerHTML = referral.headline;
  document.getElementById('subtext').textContent = referral.subtext;
  document.getElementById('codeValue').textContent = referral.code;

  // Build progress nodes
  const track = document.getElementById('progressTrack');
  const labels = document.getElementById('progressLabels');
  tiers.forEach(function(tier, i) {
    const isDone = referral.count >= tier.friends;
    const isCurrent = !isDone && (i === 0 || referral.count >= tiers[i-1].friends);

    if (i > 0) {
      const conn = document.createElement('div');
      conn.className = 'connector ' + (isDone ? 'done' : isCurrent ? 'active' : '');
      track.appendChild(conn);
    }

    const node = document.createElement('div');
    node.className = 'node ' + (isDone ? 'done' : isCurrent ? 'current' : 'locked');
    node.textContent = isDone ? 'âœ“' : tier.friends;
    node.style.animationDelay = (i * 0.1) + 's';
    track.appendChild(node);

    const label = document.createElement('div');
    label.className = 'p-label' + (isCurrent ? ' active' : '');
    label.textContent = tier.friends + (tier.friends === 1 ? ' friend' : ' friends');
    labels.appendChild(label);
  });

  // Progress stat
  const maxTier = tiers[tiers.length - 1].friends;
  const nextTier = tiers.find(function(t) { return referral.count < t.friends; });
  const statEl = document.getElementById('progressStat');
  if (nextTier) {
    const remaining = nextTier.friends - referral.count;
    statEl.innerHTML = '<span>' + remaining + '</span> more referral' +
      (remaining !== 1 ? 's' : '') + ' to unlock: ' + nextTier.reward;
  } else {
    statEl.innerHTML = 'ğŸ‰ All milestones unlocked! Keep sharing for bonus credits';
  }

  // Build tier cards
  const tierList = document.getElementById('tierList');
  tiers.forEach(function(tier) {
    const isDone = referral.count >= tier.friends;
    const isNext = !isDone && tier === nextTier;
    const status = isDone ? 'unlocked' : isNext ? 'next' : 'locked';

    const card = document.createElement('div');
    card.className = 'tier-card ' + status;
    card.innerHTML =
      '<div class="tier-icon">' + tier.emoji + '</div>' +
      '<div class="tier-body">' +
        '<div class="tier-name">' + tier.reward + '</div>' +
        '<div class="tier-desc">Invite ' + tier.friends + ' friend' + (tier.friends !== 1 ? 's' : '') + '</div>' +
      '</div>' +
      '<div class="tier-badge badge-' + status + '">' +
        (isDone ? 'âœ“ ' + tier.unlockText : tier.unlockText) +
      '</div>';
    tierList.appendChild(card);
  });

  trackEvent(tracking.eventPrefix + '_Viewed', {
    referral_count: referral.count,
    code: referral.code
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ACTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function copyCode() {
    const code = referral.code;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(code).then(onCopied).catch(fallbackCopy);
    } else { fallbackCopy(); }
  }
  function fallbackCopy() {
    const ta = document.createElement('textarea');
    ta.value = referral.code;
    ta.style.cssText = 'position:fixed;left:-9999px';
    document.body.appendChild(ta); ta.select();
    try { document.execCommand('copy'); } catch(e) {}
    document.body.removeChild(ta); onCopied();
  }
  function onCopied() {
    const btn = document.getElementById('copyBtn');
    btn.textContent = 'âœ“';
    btn.classList.add('copied');
    trackEvent(tracking.eventPrefix + '_Code_Copied', { code: referral.code });
    setTimeout(function() { btn.textContent = 'ğŸ“‹'; btn.classList.remove('copied'); }, 2000);
  }

  function shareWhatsApp() {
    trackEvent(tracking.eventPrefix + '_Share_WhatsApp', { code: referral.code });
    window.open('https://wa.me/?text=' + encodeURIComponent(share.whatsappText), '_blank');
  }
  function shareSMS() {
    trackEvent(tracking.eventPrefix + '_Share_SMS', { code: referral.code });
    window.open('sms:?body=' + encodeURIComponent(share.smsText), '_blank');
  }
  function ctaClick() {
    trackEvent(tracking.eventPrefix + '_CTA_Clicked', { code: referral.code });
    if (tracking.ctaUrl) window.location.href = tracking.ctaUrl;
  }
  function dismiss() {
    trackEvent(tracking.eventPrefix + '_Dismissed');
    try { window.location.href = 'wzrk://exit'; } catch(e) {}
  }

  function trackEvent(name, props) {
    console.log('CT Event:', name, props || {});
    if (window.CleverTap) window.CleverTap.pushEvent(name, props || {});
    if (window.clevertap) window.clevertap.event.push(name, props || {});
    try { window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ event: name, properties: props || {} })); } catch(e) {}
  }
</script>
</body>
</html>
