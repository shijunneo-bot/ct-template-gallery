<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "KttiPay",
        tagline: "Never Chase Your Crew Again",
        mint: "#34D399",
        mintDark: "#059669",
        mintDeep: "#064E3B",
        mintLight: "#D1FAE5",
        lime: "#A3E635",
        purple: "#8B5CF6",
        purpleLight: "#C4B5FD",
        dark: "#0A0E14",
        card: "#131820",
        cardLight: "#1C2432",
        white: "#FFFFFF",
        grey: "#64748B",
      },

      // ðŸ† Milestone data (passed from CleverTap profile or campaign vars)
      milestone: {
        type: "ktti_created",
        number: 10,
        label: "10 Ktties Created!",
        badgeTitle: "Ktti Commander",
        badgeEmoji: "ðŸ±",
        message: "You've just created your 10th Ktti! Your crew never has to stress about money again. That's legendary. ðŸŽ‰",
      },

      // ðŸ“Š User stats
      stats: {
        kttiesCreated: 10,
        friendsConnected: 23,
        totalSpent: 4820.50,     // AUD
        totalSaved: 312.40,      // in fees saved
        memberSince: "Sep 2025",
      },

      // ðŸŽ¯ Next milestone
      nextMilestone: {
        target: 25,
        label: "Ktti Legend",
        emoji: "ðŸ‘‘",
        remaining: 15,
      },

      // ðŸŽ¨ Badge tiers
      badge: {
        tier: "silver",  // bronze, silver, gold, platinum
        colors: {
          bronze:   { ring: "#CD7F32", glow: "rgba(205,127,50,0.3)" },
          silver:   { ring: "#94A3B8", glow: "rgba(148,163,184,0.3)" },
          gold:     { ring: "#FFD700", glow: "rgba(255,215,0,0.35)" },
          platinum: { ring: "#E2E8F0", glow: "rgba(226,232,240,0.35)" },
        },
      },

      cta: {
        text: "Start Your Next Ktti",
        url: "kttipay://create",
      },

      events: {
        milestoneViewed:  "Milestone_Viewed",
        milestoneShared:  "Milestone_Shared",
        milestoneCta:     "Milestone_CTA",
        milestoneDismissed: "Milestone_Dismissed",
      },
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>KttiPay â€” Milestone</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      background: #0A0E14;
    }

    .modal {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center;
      padding: 20px 16px 24px;
      position: relative; overflow-y: auto; overflow-x: hidden;
      background: linear-gradient(170deg, #0A0E14 0%, #0F1520 35%, #0A0E14 100%);
      -webkit-overflow-scrolling: touch;
    }

    .modal::before {
      content: '';
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 50% 20%, rgba(52,211,153,0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 80%, rgba(139,92,246,0.04) 0%, transparent 50%);
      pointer-events: none; z-index: 0;
    }

    .dismiss-btn {
      position: fixed; top: 12px; right: 12px;
      width: 30px; height: 30px; border-radius: 50%;
      background: rgba(255,255,255,0.06); border: none;
      color: rgba(255,255,255,0.4); font-size: 14px;
      cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
    }

    .content {
      position: relative; z-index: 1;
      width: 100%; max-width: 380px;
      display: flex; flex-direction: column;
      align-items: center; text-align: center;
    }

    /* =============================================
       BADGE
       ============================================= */
    .badge-container {
      position: relative;
      width: 140px; height: 140px;
      margin-bottom: 20px;
      animation: badgeEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes badgeEntrance {
      0% { transform: scale(0) rotate(-30deg); opacity: 0; }
      60% { transform: scale(1.1) rotate(5deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .badge-ring {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      border-radius: 50%;
      border: 4px solid;
      animation: ringPulse 2.5s ease-in-out infinite;
    }
    @keyframes ringPulse {
      0%, 100% { box-shadow: 0 0 0 0 var(--ring-glow); }
      50% { box-shadow: 0 0 0 8px transparent; }
    }

    .badge-inner {
      position: absolute; top: 8px; left: 8px;
      right: 8px; bottom: 8px;
      border-radius: 50%;
      background: linear-gradient(145deg, #1C2432 0%, #131820 100%);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      overflow: hidden;
    }

    /* Shimmer effect across badge */
    .badge-inner::after {
      content: '';
      position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255,255,255,0.04) 40%,
        rgba(255,255,255,0.08) 50%,
        rgba(255,255,255,0.04) 60%,
        transparent 100%
      );
      animation: shimmer 3s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(25deg); }
      100% { transform: translateX(100%) rotate(25deg); }
    }

    .badge-emoji {
      font-size: 40px; position: relative; z-index: 1;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
    }
    .badge-number {
      font-size: 14px; font-weight: 800;
      color: #34D399;
      letter-spacing: -0.5px;
      position: relative; z-index: 1;
      margin-top: 2px;
    }

    /* Tier ribbon */
    .tier-ribbon {
      position: absolute; bottom: 0; left: 50%;
      transform: translateX(-50%) translateY(40%);
      padding: 4px 14px; border-radius: 100px;
      font-size: 9px; font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #0A0E14;
      z-index: 2;
    }

    /* =============================================
       CELEBRATION TEXT
       ============================================= */
    .celebrate-label {
      font-size: 11px; font-weight: 700;
      color: #34D399;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 6px;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.4s forwards;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .celebrate-title {
      font-size: 24px; font-weight: 800;
      color: #FFFFFF;
      line-height: 1.2; margin-bottom: 6px;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.5s forwards;
    }

    .celebrate-badge-name {
      display: inline-block;
      font-size: 13px; font-weight: 700;
      color: #8B5CF6;
      background: rgba(139,92,246,0.1);
      border: 1px solid rgba(139,92,246,0.2);
      padding: 4px 14px; border-radius: 100px;
      margin-bottom: 12px;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.6s forwards;
    }

    .celebrate-msg {
      font-size: 13px; font-weight: 400;
      color: rgba(255,255,255,0.5);
      line-height: 1.6;
      max-width: 300px;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.7s forwards;
    }

    /* =============================================
       STATS ROW
       ============================================= */
    .stats-row {
      display: flex; gap: 6px;
      width: 100%;
      margin-bottom: 16px;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.8s forwards;
    }

    .stat-card {
      flex: 1;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 14px;
      padding: 12px 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 18px; font-weight: 800;
      color: #FFFFFF;
      line-height: 1;
    }
    .stat-value.highlight { color: #34D399; }
    .stat-label {
      font-size: 9px; font-weight: 600;
      color: rgba(255,255,255,0.3);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-top: 4px;
    }

    /* =============================================
       NEXT MILESTONE
       ============================================= */
    .next-milestone {
      width: 100%;
      background: rgba(139,92,246,0.06);
      border: 1px solid rgba(139,92,246,0.12);
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 18px;
      display: flex; align-items: center; gap: 12px;
      text-align: left;
      opacity: 0;
      animation: fadeUp 0.5s ease 0.9s forwards;
    }

    .nm-icon {
      width: 40px; height: 40px; border-radius: 10px;
      background: rgba(139,92,246,0.12);
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    .nm-info { flex: 1; }
    .nm-title {
      font-size: 12px; font-weight: 700;
      color: #C4B5FD;
    }
    .nm-sub {
      font-size: 11px; font-weight: 400;
      color: rgba(255,255,255,0.3);
    }
    .nm-progress {
      margin-top: 6px;
      height: 4px; border-radius: 100px;
      background: rgba(255,255,255,0.06);
      overflow: hidden;
    }
    .nm-bar {
      height: 100%; border-radius: 100px;
      background: linear-gradient(90deg, #8B5CF6, #C4B5FD);
      transition: width 1.2s ease;
    }

    /* =============================================
       BUTTONS
       ============================================= */
    .btn-row {
      display: flex; gap: 10px;
      width: 100%;
      opacity: 0;
      animation: fadeUp 0.5s ease 1.0s forwards;
    }

    .btn {
      flex: 1; padding: 14px;
      border-radius: 14px; border: none;
      font-family: inherit;
      font-size: 14px; font-weight: 700;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: all 0.2s ease;
    }
    .btn:active { transform: scale(0.97); }

    .btn-primary {
      background: #34D399; color: #0A0E14;
      box-shadow: 0 4px 15px rgba(52,211,153,0.25);
    }

    .btn-share {
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.6);
      border: 1px solid rgba(255,255,255,0.08);
      flex: 0.6;
    }

    /* =============================================
       SHAREABLE CARD (hidden, for screenshot/share)
       ============================================= */
    .share-card {
      display: none;
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(145deg, #131820 0%, #0A0E14 100%);
      border-top: 1px solid rgba(52,211,153,0.2);
      border-radius: 20px 20px 0 0;
      padding: 28px 24px 32px;
      text-align: center;
      z-index: 300;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .share-card.show {
      display: block;
      transform: translateY(0);
    }

    .share-backdrop {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 250;
    }
    .share-backdrop.show { display: block; }

    .sc-badge {
      font-size: 48px; margin-bottom: 8px;
    }
    .sc-title {
      font-size: 18px; font-weight: 800;
      color: #FFFFFF; margin-bottom: 2px;
    }
    .sc-subtitle {
      font-size: 12px; font-weight: 600;
      color: #34D399; margin-bottom: 16px;
    }
    .sc-stats {
      display: flex; justify-content: center; gap: 20px;
      margin-bottom: 18px;
    }
    .sc-stat {
      text-align: center;
    }
    .sc-stat-val {
      font-size: 20px; font-weight: 800;
      color: #FFFFFF;
    }
    .sc-stat-lbl {
      font-size: 9px; font-weight: 600;
      color: rgba(255,255,255,0.3);
      text-transform: uppercase;
    }

    .sc-watermark {
      font-size: 10px; font-weight: 600;
      color: rgba(255,255,255,0.15);
      margin-bottom: 16px;
    }

    .sc-actions {
      display: flex; gap: 10px;
    }
    .sc-btn {
      flex: 1; padding: 12px;
      border-radius: 12px; border: none;
      font-family: inherit;
      font-size: 13px; font-weight: 700;
      cursor: pointer;
    }
    .sc-btn-share {
      background: #34D399; color: #0A0E14;
    }
    .sc-btn-close {
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.5);
    }

    #confettiCanvas {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 999;
    }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="modal" id="modal">
    <button class="dismiss-btn" id="dismissBtn" onclick="dismiss()">âœ•</button>

    <div class="content">
      <!-- Badge -->
      <div class="badge-container" id="badgeContainer">
        <div class="badge-ring" id="badgeRing"></div>
        <div class="badge-inner">
          <span class="badge-emoji" id="badgeEmoji">ðŸ±</span>
          <span class="badge-number" id="badgeNumber">Ã—10</span>
        </div>
        <div class="tier-ribbon" id="tierRibbon">SILVER</div>
      </div>

      <!-- Text -->
      <div class="celebrate-label">MILESTONE UNLOCKED</div>
      <div class="celebrate-title" id="celebTitle">10 Ktties Created!</div>
      <div class="celebrate-badge-name" id="celebBadge">ðŸ… Ktti Commander</div>
      <div class="celebrate-msg" id="celebMsg"></div>

      <!-- Stats -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-value highlight" id="sKtties">0</div>
          <div class="stat-label">Ktties</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="sFriends">0</div>
          <div class="stat-label">Friends</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="sSpent">$0</div>
          <div class="stat-label">Group Spend</div>
        </div>
        <div class="stat-card">
          <div class="stat-value highlight" id="sSaved">$0</div>
          <div class="stat-label">Fees Saved</div>
        </div>
      </div>

      <!-- Next milestone -->
      <div class="next-milestone">
        <div class="nm-icon" id="nmIcon">ðŸ‘‘</div>
        <div class="nm-info">
          <div class="nm-title" id="nmTitle">Next: Ktti Legend (25 Ktties)</div>
          <div class="nm-sub" id="nmSub">15 more to unlock</div>
          <div class="nm-progress">
            <div class="nm-bar" id="nmBar" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="btn-row">
        <button class="btn btn-primary" onclick="ctaClick()">Start Your Next Ktti</button>
        <button class="btn btn-share" onclick="showShareCard()">Share ðŸ”—</button>
      </div>
    </div>
  </div>

  <!-- Share card bottom sheet -->
  <div class="share-backdrop" id="shareBackdrop" onclick="hideShareCard()"></div>
  <div class="share-card" id="shareCard">
    <div class="sc-badge" id="scBadge">ðŸ±</div>
    <div class="sc-title" id="scTitle">Ktti Commander</div>
    <div class="sc-subtitle">10 Ktties Created on KttiPay</div>
    <div class="sc-stats">
      <div class="sc-stat">
        <div class="sc-stat-val" id="scKtties">10</div>
        <div class="sc-stat-lbl">Ktties</div>
      </div>
      <div class="sc-stat">
        <div class="sc-stat-val" id="scFriends">23</div>
        <div class="sc-stat-lbl">Friends</div>
      </div>
      <div class="sc-stat">
        <div class="sc-stat-val" id="scSaved">$312</div>
        <div class="sc-stat-lbl">Fees Saved</div>
      </div>
    </div>
    <div class="sc-watermark">kttipay.com Â· Never Chase Your Crew Again ðŸ‘Š</div>
    <div class="sc-actions">
      <button class="sc-btn sc-btn-share" onclick="shareNow()">Share to Socials</button>
      <button class="sc-btn sc-btn-close" onclick="hideShareCard()">Close</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script>
    // =============================================
    // STATE
    // =============================================
    const ms = CONFIG.milestone;
    const stats = CONFIG.stats;
    const next = CONFIG.nextMilestone;
    const tierConfig = CONFIG.badge.colors[CONFIG.badge.tier] || CONFIG.badge.colors.silver;

    if (!CONFIG.includeDismissButton) {
      document.getElementById('dismissBtn').classList.add('hidden');
    }

    // =============================================
    // INIT
    // =============================================
    function init() {
      // Badge styling
      const ring = document.getElementById('badgeRing');
      ring.style.borderColor = tierConfig.ring;
      ring.style.setProperty('--ring-glow', tierConfig.glow);

      const ribbon = document.getElementById('tierRibbon');
      ribbon.style.background = tierConfig.ring;
      ribbon.textContent = CONFIG.badge.tier.toUpperCase();

      document.getElementById('badgeEmoji').textContent = ms.badgeEmoji;
      document.getElementById('badgeNumber').textContent = 'Ã—' + ms.number;

      // Celebration text
      document.getElementById('celebTitle').textContent = ms.label;
      document.getElementById('celebBadge').textContent = 'ðŸ… ' + ms.badgeTitle;
      document.getElementById('celebMsg').textContent = ms.message;

      // Animate stats
      setTimeout(() => {
        animateInt(document.getElementById('sKtties'), stats.kttiesCreated);
        animateInt(document.getElementById('sFriends'), stats.friendsConnected);
        animateDollar(document.getElementById('sSpent'), stats.totalSpent);
        animateDollar(document.getElementById('sSaved'), stats.totalSaved);
      }, 900);

      // Next milestone
      document.getElementById('nmIcon').textContent = next.emoji;
      document.getElementById('nmTitle').textContent = `Next: ${next.label} (${next.target} Ktties)`;
      document.getElementById('nmSub').textContent = `${next.remaining} more to unlock`;

      const pct = ((stats.kttiesCreated / next.target) * 100);
      setTimeout(() => {
        document.getElementById('nmBar').style.width = pct + '%';
      }, 1200);

      // Share card static
      document.getElementById('scBadge').textContent = ms.badgeEmoji;
      document.getElementById('scTitle').textContent = ms.badgeTitle;
      document.getElementById('scKtties').textContent = stats.kttiesCreated;
      document.getElementById('scFriends').textContent = stats.friendsConnected;
      document.getElementById('scSaved').textContent = '$' + Math.round(stats.totalSaved);

      // Confetti
      setTimeout(fireConfetti, 600);

      // Event
      pushEvent(CONFIG.events.milestoneViewed, {
        Milestone_Type: ms.type,
        Milestone_Number: ms.number,
        Badge: ms.badgeTitle,
        Tier: CONFIG.badge.tier,
      });
    }

    // =============================================
    // ANIMATED COUNTERS
    // =============================================
    function animateInt(el, target) {
      const start = performance.now();
      const dur = 800;
      function tick(now) {
        const p = Math.min((now - start) / dur, 1);
        const e = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.round(target * e);
        if (p < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function animateDollar(el, target) {
      const start = performance.now();
      const dur = 800;
      function tick(now) {
        const p = Math.min((now - start) / dur, 1);
        const e = 1 - Math.pow(1 - p, 3);
        const val = target * e;
        el.textContent = '$' + (val >= 1000 ? (val / 1000).toFixed(1) + 'K' : Math.round(val));
        if (p < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    // =============================================
    // CONFETTI
    // =============================================
    function fireConfetti() {
      if (typeof confetti === 'undefined') return;
      const c = confetti.create(document.getElementById('confettiCanvas'), { resize: true, useWorker: true });
      // Burst from center
      c({ particleCount: 60, spread: 80, origin: { y: 0.3 }, colors: ['#34D399', '#8B5CF6', '#FFD700', '#FFF', '#A3E635'], ticks: 140 });
      setTimeout(() => {
        c({ particleCount: 40, spread: 120, origin: { y: 0.4 }, colors: ['#34D399', '#8B5CF6', '#FFD700'], ticks: 100 });
      }, 300);
      // Side canons
      setTimeout(() => {
        c({ particleCount: 25, angle: 60, spread: 55, origin: { x: 0, y: 0.5 }, colors: ['#34D399', '#A3E635'] });
        c({ particleCount: 25, angle: 120, spread: 55, origin: { x: 1, y: 0.5 }, colors: ['#8B5CF6', '#C4B5FD'] });
      }, 500);
    }

    // =============================================
    // SHARE
    // =============================================
    window.showShareCard = function () {
      document.getElementById('shareBackdrop').classList.add('show');
      document.getElementById('shareCard').classList.add('show');
    };

    window.hideShareCard = function () {
      document.getElementById('shareCard').classList.remove('show');
      setTimeout(() => document.getElementById('shareBackdrop').classList.remove('show'), 300);
    };

    window.shareNow = function () {
      const text = `Just hit ${ms.number} Ktties on @KttiPay and unlocked "${ms.badgeTitle}" ðŸ…\n${stats.friendsConnected} friends connected Â· $${Math.round(stats.totalSaved)} in fees saved\nNever chase your crew for money again ðŸ‘Š\nkttipay.com`;

      pushEvent(CONFIG.events.milestoneShared, {
        Badge: ms.badgeTitle,
        Tier: CONFIG.badge.tier,
      });

      if (navigator.share) {
        navigator.share({ text }).catch(() => {});
      } else {
        try {
          const ta = document.createElement('textarea');
          ta.value = text; ta.style.cssText = 'position:fixed;opacity:0';
          document.body.appendChild(ta); ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        } catch (e) {}
      }

      hideShareCard();
    };

    // =============================================
    // ACTIONS
    // =============================================
    window.ctaClick = function () {
      pushEvent(CONFIG.events.milestoneCta, {
        Badge: ms.badgeTitle,
        Next_Target: next.target,
      });
      if (CONFIG.cta.url) window.location.href = CONFIG.cta.url;
    };

    window.dismiss = function () {
      pushEvent(CONFIG.events.milestoneDismissed, {
        Badge: ms.badgeTitle,
        Viewed: true,
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.dismissInAppNotification) {
          CleverTap.dismissInAppNotification(); return;
        }
      } catch (e) {}
      window.location.href = 'wzrk://exit';
    };

    // =============================================
    // CLEVERTAP
    // =============================================
    function pushEvent(name, props) {
      const payload = props || {};
      payload.Timestamp = new Date().toISOString();
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(payload));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, payload);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ type: 'event', name, props: payload }));
      } catch (e) { console.log('[CT]', name, payload); }
    }

    // =============================================
    init();
  </script>
</body>
</html>
