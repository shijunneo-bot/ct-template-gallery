<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "Hola Health",
        primary: "#3B82F6",
        primaryLight: "#93C5FD",
        accent: "#10B981",
        dark: "#0F172A",
        darkCard: "#1E293B",
        white: "#FFFFFF",
        warm: "#F8FAFC",
      },

      progress: {
        current: 72,
        target: 100,
        unit: "%",
        label: "Health Score",
        sublabel: "3 checks remaining",
      },

      milestones: [
        { threshold: 25,  label: "Getting started",  emoji: "ðŸŒ±" },
        { threshold: 50,  label: "Halfway there",     emoji: "ðŸ’ª" },
        { threshold: 75,  label: "Almost done",        emoji: "ðŸ”¥" },
        { threshold: 100, label: "Complete!",           emoji: "ðŸ†" },
      ],

      ring: {
        size: 200,
        strokeWidth: 14,
        backgroundColor: "rgba(255,255,255,0.06)",
        progressGradient: { start: "#3B82F6", end: "#10B981" },
        animationDuration: 1.8,
      },

      nextAction: {
        text: "Complete your eye check",
        emoji: "ðŸ‘ï¸",
        subtext: "+15 points",
      },

      cta: {
        text: "Book Now",
        url: "holahealth://book/eye-check",
      },

      events: {
        progressViewed:     "ProgressRing_Viewed",
        progressCTAClicked: "ProgressRing_CTA_Clicked",
        progressDismissed:  "ProgressRing_Dismissed",
      },
    };
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&display=swap">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #3B82F6;
      --primary-light: #93C5FD;
      --accent: #10B981;
      --dark: #0F172A;
      --dark-card: #1E293B;
      --text: #FFFFFF;
      --text-muted: rgba(255,255,255,0.5);
    }

    body {
      background: var(--dark);
      background-image: radial-gradient(ellipse at 50% 20%, rgba(59,130,246,0.06) 0%, transparent 50%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Sora', sans-serif;
      color: var(--text);
      padding: 32px 24px;
      overflow: hidden;
    }

    .dismiss {
      position: fixed; top: 12px; right: 12px;
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.4);
      font-size: 18px; cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
    }
    .dismiss:active { transform: scale(0.9); }

    .label-top {
      font-size: 11px; font-weight: 700;
      letter-spacing: 2px; text-transform: uppercase;
      color: var(--primary-light);
      margin-bottom: 24px;
      opacity: 0;
      animation: fadeIn 0.5s 0.2s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    /* Ring container */
    .ring-wrap {
      position: relative;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeIn 0.6s 0.3s ease forwards;
    }

    .ring-svg {
      transform: rotate(-90deg);
      filter: drop-shadow(0 0 20px rgba(59,130,246,0.15));
    }

    .ring-bg {
      fill: none;
      stroke-linecap: round;
    }
    .ring-progress {
      fill: none;
      stroke-linecap: round;
      transition: stroke-dashoffset ease-out;
    }

    /* Center text inside ring */
    .ring-center {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    .ring-value {
      font-size: 46px;
      font-weight: 800;
      line-height: 1;
      font-variant-numeric: tabular-nums;
    }
    .ring-unit {
      font-size: 22px;
      font-weight: 700;
      opacity: 0.6;
    }
    .ring-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Milestone reached */
    .milestone {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 18px;
      border-radius: 50px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      font-size: 13px; font-weight: 600;
      margin-bottom: 24px;
      opacity: 0; transform: translateY(8px);
    }
    .milestone.show { animation: fadeInUp 0.5s ease forwards; }
    .milestone-emoji { font-size: 18px; }

    /* Sublabel */
    .sublabel {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 24px;
      opacity: 0; transform: translateY(6px);
    }
    .sublabel.show { animation: fadeInUp 0.4s ease forwards; }

    /* Next action card */
    .next-action {
      width: 100%;
      max-width: 300px;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      border-radius: 18px;
      background: var(--dark-card);
      border: 1px solid rgba(255,255,255,0.06);
      margin-bottom: 20px;
      opacity: 0; transform: translateY(10px);
    }
    .next-action.show { animation: fadeInUp 0.5s ease forwards; }
    .na-emoji {
      font-size: 28px;
      width: 48px; height: 48px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(59,130,246,0.1);
      border-radius: 14px;
      flex-shrink: 0;
    }
    .na-info { flex: 1; }
    .na-label { font-size: 12px; color: var(--text-muted); margin-bottom: 2px; }
    .na-text { font-size: 14px; font-weight: 700; }
    .na-points {
      font-size: 12px; font-weight: 700;
      color: var(--accent);
      margin-top: 2px;
    }

    /* CTA */
    .cta {
      padding: 16px 40px;
      border-radius: 50px;
      border: none;
      font-family: 'Sora', sans-serif;
      font-size: 15px; font-weight: 700;
      cursor: pointer;
      color: var(--text);
      transition: transform 0.2s;
      opacity: 0; transform: translateY(8px);
      position: relative;
    }
    .cta.show { animation: fadeInUp 0.5s ease forwards; }
    .cta:active { transform: scale(0.96) translateY(0); }
    .cta::after {
      content: '';
      position: absolute; inset: -3px;
      border-radius: 53px;
      z-index: -1;
      opacity: 0.3;
      filter: blur(14px);
    }

    /* Milestone dots on ring */
    .milestone-dot {
      position: absolute;
      width: 10px; height: 10px;
      border-radius: 50%;
      border: 2px solid var(--dark);
      transform: translate(-50%, -50%);
      z-index: 2;
      transition: background 0.5s ease;
    }
    .milestone-dot.reached { box-shadow: 0 0 6px rgba(59,130,246,0.4); }
  </style>
</head>

<body>
  <div class="label-top" id="labelTop">HEALTH TRACKER</div>

  <div class="ring-wrap" id="ringWrap">
    <svg class="ring-svg" id="ringSvg"></svg>
    <div class="ring-center">
      <div class="ring-value"><span id="ringVal">0</span><span class="ring-unit" id="ringUnit"></span></div>
      <div class="ring-label" id="ringLabel"></div>
    </div>
  </div>

  <div class="milestone" id="milestoneTag"><span class="milestone-emoji" id="msEmoji"></span><span id="msText"></span></div>
  <div class="sublabel" id="sublabel"></div>

  <div class="next-action" id="nextAction">
    <div class="na-emoji" id="naEmoji"></div>
    <div class="na-info">
      <div class="na-label">Next step</div>
      <div class="na-text" id="naText"></div>
      <div class="na-points" id="naPoints"></div>
    </div>
  </div>

  <button class="cta" id="cta"></button>

  <script>
    // â”€â”€ Helpers â”€â”€
    function fireEvent(name, props) {
      try {
        if (window.CleverTap) window.CleverTap.pushEvent(name, props || {});
        else if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ event: name, properties: props || {} }));
        else if (window.clevertap) window.clevertap.event.push(name, props || {});
      } catch (e) { console.log("CT Event:", name, props); }
    }
    function dismiss() {
      fireEvent(CONFIG.events.progressDismissed);
      try { location.href = "wzrk://exit"; } catch (e) {}
    }

    (function init() {
      const root = document.documentElement;
      const c = CONFIG;
      root.style.setProperty("--primary", c.brand.primary);
      root.style.setProperty("--primary-light", c.brand.primaryLight);
      root.style.setProperty("--accent", c.brand.accent);
      root.style.setProperty("--dark", c.brand.dark);
      root.style.setProperty("--dark-card", c.brand.darkCard);

      // Dismiss
      if (c.includeDismissButton) {
        const btn = document.createElement("button");
        btn.className = "dismiss"; btn.innerHTML = "âœ•"; btn.onclick = dismiss;
        document.body.appendChild(btn);
      }

      // â”€â”€ Build SVG Ring â”€â”€
      const size = c.ring.size;
      const sw = c.ring.strokeWidth;
      const radius = (size - sw) / 2;
      const circumference = 2 * Math.PI * radius;
      const cx = size / 2;
      const cy = size / 2;

      const svg = document.getElementById("ringSvg");
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      svg.setAttribute("viewBox", `0 0 ${size} ${size}`);

      // Gradient definition
      const gradId = "ringGrad";
      svg.innerHTML = `
        <defs>
          <linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="${c.ring.progressGradient.start}" />
            <stop offset="100%" stop-color="${c.ring.progressGradient.end}" />
          </linearGradient>
        </defs>
        <circle class="ring-bg" cx="${cx}" cy="${cy}" r="${radius}"
                stroke="${c.ring.backgroundColor}" stroke-width="${sw}" />
        <circle class="ring-progress" id="ringProgress" cx="${cx}" cy="${cy}" r="${radius}"
                stroke="url(#${gradId})" stroke-width="${sw}"
                stroke-dasharray="${circumference}"
                stroke-dashoffset="${circumference}" />
      `;

      // Milestone dots on ring circumference
      const ringWrap = document.getElementById("ringWrap");
      c.milestones.forEach(ms => {
        const angle = ((ms.threshold / 100) * 360 - 90) * (Math.PI / 180);
        const dotX = cx + (radius) * Math.cos(angle);
        const dotY = cy + (radius) * Math.sin(angle);
        // Account for SVG rotation (-90deg) â€” dots need raw position
        const rawAngle = ((ms.threshold / 100) * 360 - 90) * (Math.PI / 180);
        const px = cx + radius * Math.cos(rawAngle);
        const py = cy + radius * Math.sin(rawAngle);

        const dot = document.createElement("div");
        dot.className = "milestone-dot";
        // Position relative to ring-wrap (ring-svg is rotated -90deg)
        const rotAngle = (ms.threshold / 100) * 360 - 90;
        const rad = rotAngle * (Math.PI / 180);
        const ringCenter = size / 2;
        const dx = ringCenter + radius * Math.cos(rad);
        const dy = ringCenter + radius * Math.sin(rad);
        dot.style.left = dx + "px";
        dot.style.top = dy + "px";
        dot.style.background = ms.threshold <= c.progress.current ? c.brand.primary : "rgba(255,255,255,0.15)";
        if (ms.threshold <= c.progress.current) dot.classList.add("reached");
        ringWrap.appendChild(dot);
      });

      // Labels
      document.getElementById("ringUnit").textContent = c.progress.unit;
      document.getElementById("ringLabel").textContent = c.progress.label;
      document.getElementById("sublabel").textContent = c.progress.sublabel;

      // Current milestone
      const currentMs = [...c.milestones].reverse().find(m => c.progress.current >= m.threshold) || c.milestones[0];
      document.getElementById("msEmoji").textContent = currentMs.emoji;
      document.getElementById("msText").textContent = currentMs.label;

      // Next action
      document.getElementById("naEmoji").textContent = c.nextAction.emoji;
      document.getElementById("naText").textContent = c.nextAction.text;
      document.getElementById("naPoints").textContent = c.nextAction.subtext;

      // CTA
      const ctaBtn = document.getElementById("cta");
      ctaBtn.textContent = c.cta.text;
      ctaBtn.style.background = `linear-gradient(135deg, ${c.brand.primary}, ${c.brand.accent})`;
      ctaBtn.onclick = () => {
        fireEvent(c.events.progressCTAClicked, { current_progress: c.progress.current, next_action: c.nextAction.text });
        if (c.cta.url) location.href = c.cta.url;
      };

      // â”€â”€ Animate â”€â”€
      const progressEl = document.getElementById("ringProgress");
      const targetOffset = circumference * (1 - c.progress.current / c.progress.target);

      // Ring draw animation
      progressEl.style.transitionDuration = c.ring.animationDuration + "s";
      setTimeout(() => {
        progressEl.style.strokeDashoffset = targetOffset;
      }, 600);

      // Counter animation
      const valEl = document.getElementById("ringVal");
      const dur = c.ring.animationDuration * 1000;
      const startTime = performance.now() + 600;
      function animateCounter(now) {
        const elapsed = now - startTime;
        if (elapsed < 0) { requestAnimationFrame(animateCounter); return; }
        const progress = Math.min(elapsed / dur, 1);
        // Ease-out cubic
        const eased = 1 - Math.pow(1 - progress, 3);
        valEl.textContent = Math.round(eased * c.progress.current);
        if (progress < 1) requestAnimationFrame(animateCounter);
      }
      requestAnimationFrame(animateCounter);

      // Staggered reveals
      const staggerEls = [
        { el: document.getElementById("milestoneTag"), delay: c.ring.animationDuration * 0.6 },
        { el: document.getElementById("sublabel"),     delay: c.ring.animationDuration * 0.7 },
        { el: document.getElementById("nextAction"),   delay: c.ring.animationDuration * 0.85 },
        { el: ctaBtn,                                   delay: c.ring.animationDuration * 1.0 },
      ];
      staggerEls.forEach(({ el, delay }) => {
        setTimeout(() => el.classList.add("show"), delay * 1000 + 600);
      });

      // Fire viewed
      const reachedMs = c.milestones.filter(m => c.progress.current >= m.threshold).map(m => m.label);
      fireEvent(c.events.progressViewed, {
        current_progress: c.progress.current,
        target: c.progress.target,
        milestones_reached: reachedMs.join(", "),
      });
    })();
  </script>
</body>

</html>
