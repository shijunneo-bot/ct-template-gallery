<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "Eatigo",
        primary: "#FF6B6B",
        primaryDark: "#E84545",
        secondary: "#0D9488",
        secondaryLight: "#5EEAD4",
        accent: "#FFE66D",
        white: "#FFFFFF",
        black: "#0F0F14",
      },

      card: {
        front: {
          headline: "Mystery Reward",
          subheadline: "Tap the card to reveal",
          emoji: "üéÅ",
          gradient: "linear-gradient(145deg, #FF6B6B 0%, #E84545 50%, #C43E3E 100%)",
        },
        back: {
          headline: "You Got It! üéâ",
          offerText: "20% off your next booking",
          code: "EATIGO20",
          validUntil: "28 Feb 2026",
          gradient: "linear-gradient(145deg, #0D9488 0%, #14B8A6 50%, #2DD4BF 100%)",
        },
      },

      animation: {
        flipDuration: 0.7,
        flipDirection: "horizontal", // "horizontal" (Y-axis) or "vertical" (X-axis)
      },

      cta: {
        text: "Book a Restaurant",
        url: "eatigo://restaurants",
      },

      events: {
        cardViewed:     "FlipCard_Viewed",
        cardFlipped:    "FlipCard_Flipped",
        codeCopied:     "FlipCard_Code_Copied",
        cardCTAClicked: "FlipCard_CTA_Clicked",
        cardDismissed:  "FlipCard_Dismissed",
      },
    };
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&display=swap">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --flip-dur: 0.7s;
      --bg: #0F0F14;
      --text: #FFFFFF;
      --text-muted: rgba(255,255,255,0.55);
    }

    body {
      background: var(--bg);
      background-image: radial-gradient(ellipse at 50% 40%, rgba(255,255,255,0.025) 0%, transparent 50%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Sora', sans-serif;
      padding: 24px;
      overflow: hidden;
    }

    /* Dismiss */
    .dismiss {
      position: fixed; top: 12px; right: 12px;
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.4);
      font-size: 18px; cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .dismiss:active { transform: scale(0.9); }

    /* Instruction */
    .instruction {
      color: var(--text-muted);
      font-size: 13px;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeIn 0.6s 0.3s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    /* Card container ‚Äî 3D perspective */
    .card-scene {
      perspective: 1000px;
      width: 280px;
      height: 380px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .card {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform var(--flip-dur) cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    .card.flipped-h { transform: rotateY(180deg); }
    .card.flipped-v { transform: rotateX(180deg); }

    /* Idle wobble ‚Äî suggests interactivity */
    .card:not(.flipped-h):not(.flipped-v) {
      animation: idleWobble 3s ease-in-out infinite;
    }
    @keyframes idleWobble {
      0%, 100% { transform: rotateY(0deg) rotateX(0deg); }
      25% { transform: rotateY(2deg) rotateX(-1deg); }
      75% { transform: rotateY(-2deg) rotateX(1deg); }
    }

    .face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px 24px;
      overflow: hidden;
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255,255,255,0.06) inset;
    }

    /* Front face */
    .front {
      z-index: 2;
    }
    .front::before {
      content: '';
      position: absolute;
      top: 0; left: 10%; right: 10%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    }
    .front-emoji {
      font-size: 72px;
      margin-bottom: 20px;
      animation: emojiFloat 2s ease-in-out infinite;
    }
    @keyframes emojiFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .front-headline {
      font-size: 24px;
      font-weight: 800;
      color: var(--text);
      margin-bottom: 8px;
    }
    .front-sub {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
    }

    /* Tap hint ring */
    .tap-ring {
      position: absolute;
      bottom: 32px;
      width: 48px; height: 48px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.25);
      display: flex; align-items: center; justify-content: center;
      animation: tapPulse 1.5s ease-in-out infinite;
    }
    .tap-ring::after {
      content: 'üëÜ';
      font-size: 20px;
    }
    @keyframes tapPulse {
      0%, 100% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    /* Back face */
    .back-h { transform: rotateY(180deg); }
    .back-v { transform: rotateX(180deg); }

    .back::before {
      content: '';
      position: absolute;
      top: 0; left: 10%; right: 10%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    }

    .back-headline {
      font-size: 26px;
      font-weight: 800;
      color: var(--text);
      margin-bottom: 16px;
    }
    .back-offer {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 20px;
      text-align: center;
      line-height: 1.4;
    }

    /* Coupon code */
    .code-box {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border-radius: 12px;
      border: 2px dashed rgba(255,255,255,0.3);
      background: rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }
    .code-box:active {
      transform: scale(0.97);
      border-color: rgba(255,255,255,0.5);
      background: rgba(0,0,0,0.3);
    }
    .code-text {
      font-size: 20px;
      font-weight: 800;
      color: var(--text);
      letter-spacing: 2px;
    }
    .code-copy {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.1);
      padding: 3px 8px;
      border-radius: 6px;
    }
    .code-box.copied .code-copy {
      background: rgba(16, 185, 129, 0.3);
      color: #10B981;
    }

    .valid-text {
      font-size: 12px;
      color: rgba(255,255,255,0.35);
      margin-top: 4px;
    }

    /* CTA ‚Äî appears after flip */
    .cta-wrap {
      margin-top: 24px;
      opacity: 0;
      transform: translateY(16px);
      pointer-events: none;
    }
    .cta-wrap.show {
      animation: fadeInUp 0.5s 0.3s ease forwards;
      pointer-events: auto;
    }
    .cta {
      padding: 16px 40px;
      border-radius: 50px;
      border: none;
      font-family: 'Sora', sans-serif;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      color: var(--bg);
      transition: transform 0.2s;
    }
    .cta:active { transform: scale(0.96); }

    /* Confetti */
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 50;
    }
    .confetti-piece {
      position: absolute;
      opacity: 0;
    }
    .confetti-piece.fire {
      animation: confettiFly var(--dur) var(--delay) ease-out forwards;
    }
    @keyframes confettiFly {
      0% { opacity: 1; transform: translate(0,0) rotate(0) scale(1); }
      100% { opacity: 0; transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) scale(0.2); }
    }
  </style>
</head>

<body>
  <div class="instruction">Tap the card to reveal your reward</div>

  <div class="card-scene" id="scene">
    <div class="card" id="card">
      <!-- Front -->
      <div class="face front" id="front">
        <div class="front-emoji" id="emoji"></div>
        <div class="front-headline" id="fHeadline"></div>
        <div class="front-sub" id="fSub"></div>
        <div class="tap-ring" id="tapRing"></div>
      </div>
      <!-- Back -->
      <div class="face back" id="back">
        <div class="back-headline" id="bHeadline"></div>
        <div class="back-offer" id="bOffer"></div>
        <div class="code-box" id="codeBox">
          <span class="code-text" id="codeText"></span>
          <span class="code-copy" id="codeCopy">TAP TO COPY</span>
        </div>
        <div class="valid-text" id="validText"></div>
      </div>
    </div>
  </div>

  <div class="cta-wrap" id="ctaWrap">
    <button class="cta" id="cta"></button>
  </div>

  <script>
    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    function fireEvent(name, props) {
      try {
        if (window.CleverTap) window.CleverTap.pushEvent(name, props || {});
        else if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ event: name, properties: props || {} }));
        else if (window.clevertap) window.clevertap.event.push(name, props || {});
      } catch (e) { console.log("CT Event:", name, props); }
    }
    function dismiss() {
      fireEvent(CONFIG.events.cardDismissed, { was_flipped: flipped });
      try { location.href = "wzrk://exit"; } catch (e) {}
    }

    let flipped = false;
    let flipStartTime = Date.now();

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    (function init() {
      const root = document.documentElement;
      root.style.setProperty("--flip-dur", CONFIG.animation.flipDuration + "s");

      // Dismiss
      if (CONFIG.includeDismissButton) {
        const btn = document.createElement("button");
        btn.className = "dismiss"; btn.innerHTML = "‚úï"; btn.onclick = dismiss;
        document.body.appendChild(btn);
      }

      // Front face
      const front = document.getElementById("front");
      front.style.background = CONFIG.card.front.gradient;
      document.getElementById("emoji").textContent = CONFIG.card.front.emoji;
      document.getElementById("fHeadline").textContent = CONFIG.card.front.headline;
      document.getElementById("fSub").textContent = CONFIG.card.front.subheadline;

      // Back face
      const back = document.getElementById("back");
      back.style.background = CONFIG.card.back.gradient;
      back.classList.add(CONFIG.animation.flipDirection === "vertical" ? "back-v" : "back-h");
      document.getElementById("bHeadline").textContent = CONFIG.card.back.headline;
      document.getElementById("bOffer").textContent = CONFIG.card.back.offerText;
      document.getElementById("codeText").textContent = CONFIG.card.back.code;
      document.getElementById("validText").textContent = CONFIG.card.back.validUntil
        ? `Valid until ${CONFIG.card.back.validUntil}`
        : "";

      // CTA
      const cta = document.getElementById("cta");
      cta.textContent = CONFIG.cta.text;
      cta.style.background = CONFIG.brand.secondary;
      cta.style.color = CONFIG.brand.white;
      cta.onclick = () => {
        fireEvent(CONFIG.events.cardCTAClicked, {
          offer: CONFIG.card.back.offerText,
          code: CONFIG.card.back.code,
        });
        if (CONFIG.cta.url) location.href = CONFIG.cta.url;
      };

      // Flip on tap
      document.getElementById("scene").addEventListener("click", doFlip);

      // Code copy
      document.getElementById("codeBox").addEventListener("click", (e) => {
        e.stopPropagation();
        copyCode();
      });

      // Record start time for time-to-flip metric
      flipStartTime = Date.now();

      // Fire viewed
      fireEvent(CONFIG.events.cardViewed);
    })();

    function doFlip() {
      if (flipped) return;
      flipped = true;

      const card = document.getElementById("card");
      const flipClass = CONFIG.animation.flipDirection === "vertical" ? "flipped-v" : "flipped-h";
      card.classList.add(flipClass);

      // Remove tap hint
      document.getElementById("tapRing").style.display = "none";
      document.querySelector(".instruction").style.opacity = "0";

      // Show CTA after flip completes
      setTimeout(() => {
        document.getElementById("ctaWrap").classList.add("show");
      }, CONFIG.animation.flipDuration * 1000);

      // Confetti
      setTimeout(() => fireConfetti(), CONFIG.animation.flipDuration * 500);

      // Haptic
      try { navigator.vibrate([40, 20, 60]); } catch (e) {}

      // Event
      fireEvent(CONFIG.events.cardFlipped, {
        time_to_flip_ms: Date.now() - flipStartTime,
      });
    }

    function copyCode() {
      const code = CONFIG.card.back.code;
      const box = document.getElementById("codeBox");
      const copyEl = document.getElementById("codeCopy");

      try {
        navigator.clipboard.writeText(code).then(() => {
          box.classList.add("copied");
          copyEl.textContent = "COPIED ‚úì";
          fireEvent(CONFIG.events.codeCopied, { code });
        });
      } catch (e) {
        // Fallback
        const ta = document.createElement("textarea");
        ta.value = code;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        box.classList.add("copied");
        copyEl.textContent = "COPIED ‚úì";
        fireEvent(CONFIG.events.codeCopied, { code });
      }
    }

    function fireConfetti() {
      const colors = [CONFIG.brand.primary, CONFIG.brand.secondary, CONFIG.brand.accent, "#FFFFFF", CONFIG.brand.secondaryLight];
      const container = document.createElement("div");
      container.className = "confetti";
      container.style.left = "50%";
      container.style.top = "45%";
      document.body.appendChild(container);

      for (let i = 0; i < 30; i++) {
        const p = document.createElement("div");
        p.className = "confetti-piece";
        const size = 5 + Math.random() * 7;
        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.background = colors[Math.floor(Math.random() * colors.length)];
        p.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
        p.style.left = "0";
        p.style.top = "0";
        p.style.setProperty("--tx", (Math.random() - 0.5) * 400 + "px");
        p.style.setProperty("--ty", (Math.random() - 0.6) * 500 + "px");
        p.style.setProperty("--rot", Math.random() * 720 + "deg");
        p.style.setProperty("--dur", (1.2 + Math.random() * 1.2) + "s");
        p.style.setProperty("--delay", Math.random() * 0.2 + "s");
        container.appendChild(p);
        requestAnimationFrame(() => p.classList.add("fire"));
      }
      setTimeout(() => container.remove(), 3500);
    }
  </script>
</body>

</html>
