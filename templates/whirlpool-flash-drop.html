<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "Whirlpool",
        tagline: "Sensing the difference",
        gold: "#EFB200",
        goldDark: "#C49400",
        goldDeep: "#8B6900",
        goldLight: "#FFF7D6",
        black: "#0A0A0A",
        card: "#141414",
        cardLight: "#1E1E1E",
        white: "#FFFFFF",
        red: "#EF4444",
        redDark: "#DC2626",
        green: "#10B981",
        grey: "#6B7280",
      },

      // üõç Product / Deal
      product: {
        name: "MegaChef Steam Oven",
        nameZh: "MegaChef Ëí∏ÁÑóÁàê",
        model: "W3MS450",
        image: "https://cdn.whirlpool.com.hk/media/catalog/product/cache/d73a5018306142840707bd616a4ef293/w/7/w7msblaus_new2.jpg",
        tagline: "58L Built-In ¬∑ 15 Heating Methods ¬∑ Made for HK Kitchens",
        featurePills: [
          { text: "6th SENSE", icon: "‚ö°" },
          { text: "15 Modes", icon: "üî•" },
          { text: "58L XL", icon: "üìê" },
          { text: "75min Steam", icon: "üí®" },
        ],
        originalPrice: 13990,
        flashPrice: 8990,
        currency: "HK$",
        savings: 5000,
        savingsPct: 36,
      },

      // ‚è± Countdown target (ISO timestamp)
      // Set to future time for pre-drop, past time for post-drop "Claim Now" state
      dropTime: null, // Will be calculated dynamically in init

      // üì¶ Stock
      stock: {
        total: 50,
        remaining: 23,
        lowThreshold: 10, // Bar turns red below this
        // Simulated depletion: every N seconds, decrement by 1 (for demo)
        simulateDepletion: true,
        depletionInterval: 45, // seconds between stock drops (demo only)
      },

      // üîî Remind Me push notification tie-in
      remindMe: {
        enabled: true,
        text: "Set a reminder",
        textZh: "Ë®≠ÂÆöÊèêÈÜí",
      },

      cta: {
        preDrop: { text: "Remind Me ¬∑ ÊèêÈÜíÊàë", url: null },
        postDrop: { text: "Claim Now ¬∑ Á´ãÂç≥Êê∂Ë≥º", url: "whirlpool://flash-deal/W3MS450" },
        soldOut: { text: "Sold Out ¬∑ Â∑≤ÂîÆÁΩÑ", url: null },
      },

      events: {
        dropViewed:    "Flash_Drop_Viewed",
        dropReminded:  "Flash_Drop_Reminded",
        dropClaimed:   "Flash_Drop_Claimed",
        dropExpired:   "Flash_Drop_Expired",
        dropDismissed: "Flash_Drop_Dismissed",
      },

      // üß™ Test: ?test=true&state=pre|live|low|soldout&countdown=120 (seconds)
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Whirlpool HK ‚Äî Flash Drop</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Noto+Sans+HK:wght@400;500;700&display=swap');

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      font-family: 'Inter', 'Noto Sans HK', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      background: #0A0A0A;
    }

    .modal {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center;
      padding: 14px 16px 20px;
      position: relative; overflow-y: auto; overflow-x: hidden;
      background: linear-gradient(175deg, #0A0A0A 0%, #111111 40%, #0A0A0A 100%);
      -webkit-overflow-scrolling: touch;
    }

    .modal::before {
      content: '';
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 50% 0%, rgba(239,178,0,0.06) 0%, transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(239,178,0,0.03) 0%, transparent 40%);
      pointer-events: none; z-index: 0;
    }

    .dismiss-btn {
      position: fixed; top: 12px; right: 12px;
      width: 30px; height: 30px; border-radius: 50%;
      background: rgba(255,255,255,0.06); border: none;
      color: rgba(255,255,255,0.4); font-size: 14px;
      cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
    }

    .content {
      position: relative; z-index: 1;
      width: 100%; max-width: 380px;
      display: flex; flex-direction: column;
      align-items: center;
    }

    /* =============================================
       FLASH TAG
       ============================================= */
    .flash-tag {
      display: inline-flex; align-items: center; gap: 5px;
      background: linear-gradient(135deg, #EFB200, #C49400);
      color: #0A0A0A;
      font-size: 10px; font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      padding: 5px 14px;
      border-radius: 100px;
      margin-bottom: 14px;
      animation: fadeIn 0.3s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to   { opacity: 1; transform: scale(1); }
    }
    .flash-tag .tag-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #EF4444;
      animation: blink 1.2s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* =============================================
       COUNTDOWN TIMER (SVG Arc)
       ============================================= */
    .timer-section {
      position: relative;
      width: 180px; height: 180px;
      margin-bottom: 16px;
      animation: fadeUp 0.4s ease 0.1s forwards;
      opacity: 0;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .timer-svg {
      width: 180px; height: 180px;
      transform: rotate(-90deg);
    }
    .timer-track {
      fill: none;
      stroke: rgba(255,255,255,0.04);
      stroke-width: 6;
    }
    .timer-arc {
      fill: none;
      stroke: url(#goldGrad);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
      filter: drop-shadow(0 0 6px rgba(239,178,0,0.4));
    }
    .timer-arc.urgent {
      stroke: #EF4444 !important;
      filter: drop-shadow(0 0 8px rgba(239,68,68,0.5));
    }

    .timer-inner {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    .timer-status {
      font-size: 8px; font-weight: 700;
      color: #EFB200;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 2px;
    }
    .timer-status.live { color: #EF4444; }
    .timer-digits {
      font-size: 28px; font-weight: 900;
      color: #FFFFFF;
      letter-spacing: -0.5px;
      line-height: 1;
      font-variant-numeric: tabular-nums;
    }
    .timer-colon {
      animation: colonBlink 1s step-start infinite;
    }
    @keyframes colonBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    .timer-label {
      font-size: 9px; font-weight: 500;
      color: rgba(255,255,255,0.25);
      margin-top: 2px;
    }

    /* =============================================
       PRODUCT CARD
       ============================================= */
    .product-card {
      width: 100%;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 18px;
      padding: 18px 16px;
      margin-bottom: 12px;
      opacity: 0;
      animation: fadeUp 0.4s ease 0.2s forwards;
    }

    .pc-top {
      display: flex; justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    .pc-info { flex: 1; }
    .pc-model {
      font-size: 9px; font-weight: 700;
      color: rgba(255,255,255,0.2);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 2px;
    }
    .pc-name {
      font-size: 18px; font-weight: 800;
      color: #FFFFFF;
      line-height: 1.2;
    }
    .pc-name-zh {
      font-size: 13px; font-weight: 500;
      color: rgba(255,255,255,0.3);
      font-family: 'Noto Sans HK', sans-serif;
    }
    .pc-tagline {
      font-size: 10px; font-weight: 500;
      color: #EFB200;
      margin-top: 4px;
      line-height: 1.3;
    }

    .pc-emoji {
      font-size: 44px;
      filter: grayscale(0.2);
    }

    /* Product image with steam clouds */
    .pc-img-wrap {
      position: relative;
      width: 110px; height: 110px;
      flex-shrink: 0;
      margin-right: -4px;
    }
    .pc-img {
      width: 110px; height: 110px;
      object-fit: contain;
      border-radius: 14px;
      position: relative;
      z-index: 2;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));
    }

    /* Steam / cloud billowing effect */
    .steam-cloud {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
      z-index: 3;
    }
    .steam-1 {
      width: 50px; height: 30px;
      top: -14px; left: 10px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.18) 0%, transparent 70%);
      animation: steamRise1 3s ease-out infinite;
    }
    .steam-2 {
      width: 35px; height: 25px;
      top: -10px; right: 15px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.14) 0%, transparent 70%);
      animation: steamRise2 3.5s ease-out infinite 0.8s;
    }
    .steam-3 {
      width: 45px; height: 28px;
      top: -8px; left: 30px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.12) 0%, transparent 70%);
      animation: steamRise3 4s ease-out infinite 1.6s;
    }
    .steam-4 {
      width: 30px; height: 20px;
      top: -6px; right: 25px;
      background: radial-gradient(ellipse, rgba(239,178,0,0.08) 0%, transparent 70%);
      animation: steamRise1 4.5s ease-out infinite 2.2s;
    }
    .steam-5 {
      width: 55px; height: 32px;
      top: -12px; left: 20px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.10) 0%, transparent 70%);
      animation: steamRise2 3.8s ease-out infinite 0.4s;
    }
    .steam-6 {
      width: 40px; height: 22px;
      top: -10px; left: 45px;
      background: radial-gradient(ellipse, rgba(239,178,0,0.06) 0%, transparent 70%);
      animation: steamRise3 3.2s ease-out infinite 1.2s;
    }

    @keyframes steamRise1 {
      0%   { transform: translateY(0) scaleX(0.7); opacity: 0; }
      15%  { opacity: 0.8; }
      50%  { opacity: 0.4; transform: translateY(-18px) scaleX(1.3); }
      100% { transform: translateY(-40px) scaleX(1.6); opacity: 0; }
    }
    @keyframes steamRise2 {
      0%   { transform: translate(0,0) scaleX(0.6); opacity: 0; }
      20%  { opacity: 0.7; }
      55%  { opacity: 0.3; transform: translate(5px,-20px) scaleX(1.4); }
      100% { transform: translate(8px,-45px) scaleX(1.8); opacity: 0; }
    }
    @keyframes steamRise3 {
      0%   { transform: translate(0,0) scaleX(0.8); opacity: 0; }
      18%  { opacity: 0.6; }
      60%  { opacity: 0.2; transform: translate(-4px,-15px) scaleX(1.2); }
      100% { transform: translate(-6px,-35px) scaleX(1.5); opacity: 0; }
    }

    /* Glow ring behind product */
    .pc-img-glow {
      position: absolute;
      top: 50%; left: 50%;
      width: 90px; height: 90px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background: radial-gradient(circle, rgba(239,178,0,0.15) 0%, transparent 70%);
      animation: imgGlow 3s ease-in-out infinite;
      z-index: 0;
    }
    @keyframes imgGlow {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
      50% { transform: translate(-50%, -50%) scale(1.15); opacity: 1; }
    }

    /* Feature pills */
    .pc-pills {
      display: flex; gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }
    .pc-pill {
      display: flex; align-items: center; gap: 3px;
      background: rgba(239,178,0,0.08);
      border: 1px solid rgba(239,178,0,0.15);
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 9px; font-weight: 700;
      color: #EFB200;
    }
    .pc-pill .pi { font-size: 10px; }

    /* Price */
    .pc-price-row {
      display: flex; align-items: baseline; gap: 10px;
    }
    .pc-flash-price {
      font-size: 28px; font-weight: 900;
      color: #FFFFFF;
    }
    .pc-flash-price .pc-curr {
      font-size: 16px; font-weight: 700;
      color: rgba(255,255,255,0.5);
    }
    .pc-original {
      font-size: 14px; font-weight: 600;
      color: rgba(255,255,255,0.2);
      text-decoration: line-through;
    }
    .pc-save-badge {
      display: inline-block;
      background: linear-gradient(135deg, #EFB200, #C49400);
      color: #0A0A0A;
      font-size: 10px; font-weight: 800;
      padding: 3px 8px;
      border-radius: 6px;
    }

    /* =============================================
       STOCK BAR
       ============================================= */
    .stock-section {
      width: 100%;
      margin-bottom: 14px;
      opacity: 0;
      animation: fadeUp 0.4s ease 0.3s forwards;
    }

    .stock-header {
      display: flex; justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .stock-text {
      font-size: 11px; font-weight: 700;
      color: rgba(255,255,255,0.5);
    }
    .stock-count {
      font-size: 13px; font-weight: 800;
    }
    .stock-count.normal { color: #EFB200; }
    .stock-count.low { color: #EF4444; }

    .stock-bar {
      height: 8px;
      background: rgba(255,255,255,0.06);
      border-radius: 100px;
      overflow: hidden;
      position: relative;
    }
    .stock-fill {
      height: 100%;
      border-radius: 100px;
      background: linear-gradient(90deg, #EFB200, #C49400);
      transition: width 0.8s ease;
    }
    .stock-fill.low {
      background: linear-gradient(90deg, #EF4444, #DC2626);
      box-shadow: 0 0 8px rgba(239,68,68,0.4);
    }
    .stock-fill.soldout {
      width: 0 !important;
    }

    .stock-note {
      font-size: 9px; font-weight: 500;
      color: rgba(255,255,255,0.15);
      margin-top: 4px;
      text-align: center;
    }

    /* Live depletion animation */
    .stock-pulse {
      display: none; /* shown on depletion event */
      font-size: 10px; font-weight: 700;
      color: #EF4444;
      text-align: center;
      margin-top: 4px;
      animation: stockPop 1.5s ease forwards;
    }
    @keyframes stockPop {
      0% { opacity: 0; transform: translateY(4px); }
      20% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-6px); }
    }

    /* =============================================
       CTA SECTION
       ============================================= */
    .cta-section {
      width: 100%;
      opacity: 0;
      animation: fadeUp 0.4s ease 0.4s forwards;
    }

    .btn-primary {
      width: 100%;
      padding: 15px;
      border-radius: 14px; border: none;
      font-family: inherit;
      font-size: 14px; font-weight: 700;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: all 0.2s ease;
    }
    .btn-primary:active { transform: scale(0.98); }

    .btn-primary.pre-drop {
      background: rgba(239,178,0,0.12);
      color: #EFB200;
      border: 1px solid rgba(239,178,0,0.25);
    }
    .btn-primary.live-drop {
      background: linear-gradient(135deg, #EFB200, #C49400);
      color: #0A0A0A;
      box-shadow: 0 4px 20px rgba(239,178,0,0.35);
      animation: ctaPulse 2s ease-in-out infinite;
    }
    @keyframes ctaPulse {
      0%, 100% { box-shadow: 0 4px 20px rgba(239,178,0,0.35); }
      50% { box-shadow: 0 6px 28px rgba(239,178,0,0.5); }
    }
    .btn-primary.sold-out {
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.2);
      cursor: not-allowed;
    }

    .footer-note {
      font-size: 9px; font-weight: 400;
      color: rgba(255,255,255,0.12);
      text-align: center;
      margin-top: 10px;
      line-height: 1.4;
    }

    /* =============================================
       TEST PANEL
       ============================================= */
    .test-panel {
      display: none;
      position: fixed; bottom: 10px; left: 10px; right: 10px;
      background: rgba(0,0,0,0.88);
      border-radius: 12px;
      padding: 8px 12px;
      z-index: 9999;
      font-size: 11px; color: #FFF;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    .test-panel.show { display: block; }
    .tp-title {
      font-size: 9px; color: #64748B; margin-bottom: 4px;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .tp-row { display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; }
    .tp-btn {
      padding: 5px 10px;
      background: rgba(255,255,255,0.08); border: none;
      color: #94A3B8; font-size: 9px;
      font-weight: 600; border-radius: 6px;
      cursor: pointer; font-family: inherit;
    }
    .tp-btn:active { background: rgba(255,255,255,0.15); color: #FFF; }
    .tp-btn.active { background: rgba(239,178,0,0.2); color: #EFB200; }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <!-- Test Panel -->
  <div class="test-panel" id="testPanel">
    <div class="tp-title">State Presets</div>
    <div class="tp-row">
      <button class="tp-btn" onclick="testState('pre')">Pre-Drop (2h away)</button>
      <button class="tp-btn" onclick="testState('soon')">Dropping Soon (5m)</button>
      <button class="tp-btn" onclick="testState('live')">LIVE (23 left)</button>
      <button class="tp-btn" onclick="testState('low')">Low Stock (4 left)</button>
      <button class="tp-btn" onclick="testState('soldout')">Sold Out</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <button class="dismiss-btn" id="dismissBtn" onclick="dismiss()">‚úï</button>

    <div class="content">
      <!-- Flash Tag -->
      <div class="flash-tag">
        <span class="tag-dot"></span>
        <span id="flashTagText">Flash Drop</span>
      </div>

      <!-- Countdown Timer -->
      <div class="timer-section">
        <svg class="timer-svg" viewBox="0 0 180 180">
          <defs>
            <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#EFB200" />
              <stop offset="100%" stop-color="#C49400" />
            </linearGradient>
          </defs>
          <circle class="timer-track" cx="90" cy="90" r="82" />
          <circle class="timer-arc" id="timerArc" cx="90" cy="90" r="82"
            stroke-dasharray="515.22" stroke-dashoffset="0" />
        </svg>
        <div class="timer-inner">
          <div class="timer-status" id="timerStatus">Dropping in</div>
          <div class="timer-digits" id="timerDigits">
            02<span class="timer-colon">:</span>00<span class="timer-colon">:</span>00
          </div>
          <div class="timer-label" id="timerLabel">hours ¬∑ mins ¬∑ secs</div>
        </div>
      </div>

      <!-- Product Card -->
      <div class="product-card">
        <div class="pc-top">
          <div class="pc-info">
            <div class="pc-model">Whirlpool ¬∑ W3MS450</div>
            <div class="pc-name">MegaChef Steam Oven</div>
            <div class="pc-name-zh">MegaChef Ëí∏ÁÑóÁàê</div>
            <div class="pc-tagline">58L Built-In ¬∑ 15 Heating Methods<br>Made for HK Kitchens üá≠üá∞</div>
          </div>
          <div class="pc-img-wrap">
            <div class="pc-img-glow"></div>
            <div class="steam-cloud steam-1"></div>
            <div class="steam-cloud steam-2"></div>
            <div class="steam-cloud steam-3"></div>
            <div class="steam-cloud steam-4"></div>
            <div class="steam-cloud steam-5"></div>
            <div class="steam-cloud steam-6"></div>
            <img class="pc-img"
              src="data:image/png;base64,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"
              alt="Whirlpool MegaChef W3MS450 Steam Oven"
            />
          </div>
        </div>

        <div class="pc-pills" id="featurePills"></div>

        <div class="pc-price-row">
          <div class="pc-flash-price">
            <span class="pc-curr" id="pCurr">HK$</span><span id="pFlash">8,990</span>
          </div>
          <div class="pc-original" id="pOriginal">HK$13,990</div>
          <div class="pc-save-badge" id="pSave">SAVE 36%</div>
        </div>
      </div>

      <!-- Stock Bar -->
      <div class="stock-section">
        <div class="stock-header">
          <span class="stock-text" id="stockText">Remaining ¬∑ Ââ©È§ò</span>
          <span class="stock-count normal" id="stockCount">23 of 50</span>
        </div>
        <div class="stock-bar">
          <div class="stock-fill" id="stockFill" style="width: 46%"></div>
        </div>
        <div class="stock-note" id="stockNote">Stock updates live ¬∑ Â∫´Â≠òÂØ¶ÊôÇÊõ¥Êñ∞</div>
        <div class="stock-pulse" id="stockPulse">Someone just claimed one! üî•</div>
      </div>

      <!-- CTA -->
      <div class="cta-section">
        <button class="btn-primary pre-drop" id="ctaBtn" onclick="ctaClick()">
          üîî Remind Me ¬∑ ÊèêÈÜíÊàë
        </button>
        <div class="footer-note">
          Whirlpool (Hong Kong) Limited ¬∑ Est. 1989<br>
          Flash pricing valid during countdown only. While stocks last.<br>
          ÈôêÊôÇÂÑ™ÊÉ†,ÂîÆÂÆåÂç≥Ê≠¢„ÄÇ
        </div>
      </div>
    </div>
  </div>

  <script>
    // =============================================
    // STATE
    // =============================================
    let currentState = 'pre'; // pre | live | soldout
    let dropTarget = null;
    let stockRemaining = CONFIG.stock.remaining;
    let stockTotal = CONFIG.stock.total;
    let timerInterval = null;
    let depletionInterval = null;
    const circumference = 2 * Math.PI * 82; // ~515.22

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('test') === 'true') {
      document.getElementById('testPanel').classList.add('show');
    }
    if (!CONFIG.includeDismissButton) {
      document.getElementById('dismissBtn').classList.add('hidden');
    }

    // =============================================
    // INIT
    // =============================================
    function init() {
      // Build feature pills
      const pillsContainer = document.getElementById('featurePills');
      CONFIG.product.featurePills.forEach(p => {
        const pill = document.createElement('div');
        pill.className = 'pc-pill';
        pill.innerHTML = `<span class="pi">${p.icon}</span> ${p.text}`;
        pillsContainer.appendChild(pill);
      });

      // Set drop time: 2 hours from now (default demo)
      const testState = urlParams.get('state');
      const testCountdown = urlParams.get('countdown');

      if (testState) {
        window.testState(testState);
        return;
      }

      if (testCountdown) {
        const secs = parseInt(testCountdown, 10);
        dropTarget = new Date(Date.now() + secs * 1000);
      } else {
        // Default: 2 hours from now
        dropTarget = new Date(Date.now() + 2 * 3600 * 1000);
      }

      startTimer();

      pushEvent(CONFIG.events.dropViewed, {
        Product: CONFIG.product.model,
        Flash_Price: CONFIG.product.flashPrice,
        Stock_Remaining: stockRemaining,
        State: 'pre',
      });
    }

    // =============================================
    // TIMER
    // =============================================
    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(tickTimer, 1000);
      tickTimer();
    }

    function tickTimer() {
      if (!dropTarget) return;
      const now = Date.now();
      const diff = dropTarget - now;

      if (diff <= 0) {
        // Drop is LIVE
        goLive();
        return;
      }

      const totalSecs = Math.floor(diff / 1000);
      const h = Math.floor(totalSecs / 3600);
      const m = Math.floor((totalSecs % 3600) / 60);
      const s = totalSecs % 60;

      const digits = document.getElementById('timerDigits');
      digits.innerHTML = pad(h) + '<span class="timer-colon">:</span>' + pad(m) + '<span class="timer-colon">:</span>' + pad(s);

      // Arc: full circle = total duration, deplete as time passes
      // For a 2h countdown, calculate progress
      const initialDiff = (dropTarget - (dropTarget - 2 * 3600 * 1000)); // total duration rough estimate
      const elapsed = Math.max(0, 1 - (diff / (2 * 3600 * 1000))); // normalize to 0-1
      const arcOffset = circumference * elapsed;
      const arc = document.getElementById('timerArc');
      arc.style.strokeDashoffset = arcOffset;

      // Urgent state (< 5 minutes)
      if (totalSecs < 300) {
        arc.classList.add('urgent');
        document.getElementById('timerStatus').textContent = 'Dropping soon!';
        document.getElementById('timerStatus').classList.add('live');
        document.getElementById('flashTagText').textContent = 'Dropping Soon';
      }

      // Label
      if (h > 0) {
        document.getElementById('timerLabel').textContent = 'hours ¬∑ mins ¬∑ secs';
      } else {
        document.getElementById('timerLabel').textContent = 'mins ¬∑ secs';
      }
    }

    function goLive() {
      if (timerInterval) clearInterval(timerInterval);
      currentState = 'live';

      // Timer shows LIVE
      document.getElementById('timerStatus').textContent = 'üî¥ LIVE NOW';
      document.getElementById('timerStatus').classList.add('live');
      document.getElementById('timerDigits').innerHTML = 'LIVE';
      document.getElementById('timerDigits').style.color = '#EF4444';
      document.getElementById('timerLabel').textContent = 'Claim before it\'s gone!';
      document.getElementById('flashTagText').textContent = 'LIVE NOW';

      // Arc full
      document.getElementById('timerArc').style.strokeDashoffset = circumference;

      // CTA morphs
      const btn = document.getElementById('ctaBtn');
      btn.className = 'btn-primary live-drop';
      btn.innerHTML = '‚ö° Claim Now ¬∑ Á´ãÂç≥Êê∂Ë≥º';

      // Start stock depletion simulation
      if (CONFIG.stock.simulateDepletion) {
        startDepletion();
      }

      pushEvent(CONFIG.events.dropViewed, {
        Product: CONFIG.product.model,
        State: 'live',
        Stock_Remaining: stockRemaining,
      });
    }

    // =============================================
    // STOCK DEPLETION
    // =============================================
    function startDepletion() {
      if (depletionInterval) clearInterval(depletionInterval);
      depletionInterval = setInterval(() => {
        if (stockRemaining > 0) {
          stockRemaining--;
          updateStockUI();

          // Show pulse notification
          const pulse = document.getElementById('stockPulse');
          pulse.style.display = 'block';
          pulse.style.animation = 'none';
          pulse.offsetHeight; // reflow
          pulse.style.animation = 'stockPop 1.5s ease forwards';

          if (stockRemaining === 0) {
            goSoldOut();
          }
        }
      }, CONFIG.stock.depletionInterval * 1000);
    }

    function updateStockUI() {
      const pct = (stockRemaining / stockTotal) * 100;
      const fill = document.getElementById('stockFill');
      const count = document.getElementById('stockCount');

      fill.style.width = pct + '%';
      count.textContent = stockRemaining + ' of ' + stockTotal;

      if (stockRemaining <= CONFIG.stock.lowThreshold) {
        fill.classList.add('low');
        count.className = 'stock-count low';
        document.getElementById('stockText').textContent = 'Almost gone! ¬∑ Âç≥Â∞áÂîÆÁΩÑ!';
      } else {
        fill.classList.remove('low');
        count.className = 'stock-count normal';
      }
    }

    function goSoldOut() {
      if (depletionInterval) clearInterval(depletionInterval);
      currentState = 'soldout';

      document.getElementById('stockCount').textContent = 'SOLD OUT ¬∑ Â∑≤ÂîÆÁΩÑ';
      document.getElementById('stockFill').classList.add('soldout');
      document.getElementById('stockNote').textContent = 'This drop is over. Stay tuned for the next one!';

      const btn = document.getElementById('ctaBtn');
      btn.className = 'btn-primary sold-out';
      btn.innerHTML = 'Sold Out ¬∑ Â∑≤ÂîÆÁΩÑ';
      btn.disabled = true;

      document.getElementById('flashTagText').textContent = 'SOLD OUT';

      pushEvent(CONFIG.events.dropExpired, {
        Product: CONFIG.product.model,
      });
    }

    // =============================================
    // HELPERS
    // =============================================
    function pad(n) {
      return String(n).padStart(2, '0');
    }

    // =============================================
    // ACTIONS
    // =============================================
    window.ctaClick = function () {
      if (currentState === 'soldout') return;

      if (currentState === 'pre') {
        // Remind Me
        pushEvent(CONFIG.events.dropReminded, {
          Product: CONFIG.product.model,
          Drop_Time: dropTarget ? dropTarget.toISOString() : null,
          Stock_At_Remind: stockRemaining,
        });

        const btn = document.getElementById('ctaBtn');
        btn.innerHTML = '‚úì Reminder Set! ¬∑ Â∑≤Ë®≠ÂÆöÊèêÈÜí';
        btn.style.borderColor = 'rgba(16,185,129,0.4)';
        btn.style.color = '#10B981';
        setTimeout(() => {
          btn.innerHTML = 'üîî Remind Me ¬∑ ÊèêÈÜíÊàë';
          btn.style.borderColor = '';
          btn.style.color = '';
        }, 2500);

      } else if (currentState === 'live') {
        // Claim Now
        pushEvent(CONFIG.events.dropClaimed, {
          Product: CONFIG.product.model,
          Flash_Price: CONFIG.product.flashPrice,
          Stock_At_Claim: stockRemaining,
        });
        if (CONFIG.cta.postDrop.url) {
          window.location.href = CONFIG.cta.postDrop.url;
        }
      }
    };

    window.dismiss = function () {
      pushEvent(CONFIG.events.dropDismissed, {
        State: currentState,
        Stock_Remaining: stockRemaining,
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.dismissInAppNotification) {
          CleverTap.dismissInAppNotification(); return;
        }
      } catch (e) {}
      window.location.href = 'wzrk://exit';
    };

    // =============================================
    // CLEVERTAP
    // =============================================
    function pushEvent(name, props) {
      const payload = props || {};
      payload.Timestamp = new Date().toISOString();
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(payload));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, payload);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ type: 'event', name, props: payload }));
      } catch (e) { console.log('[CT]', name, payload); }
    }

    // =============================================
    // üß™ TEST CONTROLS
    // =============================================
    window.testState = function (state) {
      // Reset
      if (timerInterval) clearInterval(timerInterval);
      if (depletionInterval) clearInterval(depletionInterval);

      switch (state) {
        case 'pre':
          currentState = 'pre';
          stockRemaining = 23;
          dropTarget = new Date(Date.now() + 2 * 3600 * 1000);
          document.getElementById('timerStatus').textContent = 'Dropping in';
          document.getElementById('timerStatus').classList.remove('live');
          document.getElementById('timerDigits').style.color = '#FFFFFF';
          document.getElementById('timerArc').classList.remove('urgent');
          document.getElementById('timerArc').style.strokeDashoffset = 0;
          document.getElementById('flashTagText').textContent = 'Flash Drop';
          document.getElementById('ctaBtn').className = 'btn-primary pre-drop';
          document.getElementById('ctaBtn').innerHTML = 'üîî Remind Me ¬∑ ÊèêÈÜíÊàë';
          document.getElementById('ctaBtn').disabled = false;
          updateStockUI();
          startTimer();
          break;

        case 'soon':
          currentState = 'pre';
          stockRemaining = 23;
          dropTarget = new Date(Date.now() + 5 * 60 * 1000);
          document.getElementById('timerDigits').style.color = '#FFFFFF';
          document.getElementById('ctaBtn').className = 'btn-primary pre-drop';
          document.getElementById('ctaBtn').innerHTML = 'üîî Remind Me ¬∑ ÊèêÈÜíÊàë';
          document.getElementById('ctaBtn').disabled = false;
          updateStockUI();
          startTimer();
          break;

        case 'live':
          stockRemaining = 23;
          updateStockUI();
          dropTarget = new Date(Date.now() - 1000);
          goLive();
          break;

        case 'low':
          stockRemaining = 4;
          updateStockUI();
          dropTarget = new Date(Date.now() - 1000);
          goLive();
          break;

        case 'soldout':
          stockRemaining = 0;
          updateStockUI();
          goLive();
          setTimeout(goSoldOut, 100);
          break;
      }
    };

    // =============================================
    init();
  </script>
</body>
</html>
