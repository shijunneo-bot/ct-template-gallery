<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>First Action Incentive</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#0B0D11;--card:#151820;--card2:#1C2030;
    --border:rgba(255,255,255,0.06);
    --violet:#8B5CF6;--violet-dark:#7C3AED;--violet-glow:rgba(139,92,246,0.15);
    --gold:#FBBF24;--gold-glow:rgba(251,191,36,0.12);
    --green:#34D399;--green-glow:rgba(52,211,153,0.12);
    --text:#EAEAEA;--muted:rgba(255,255,255,0.4);
  }
  body{
    font-family:'DM Sans',sans-serif;background:var(--bg);
    color:var(--text);max-width:390px;margin:0 auto;
    min-height:100vh;display:flex;flex-direction:column;
    align-items:center;justify-content:center;padding:20px;
    overflow:hidden;
  }

  .dismiss{
    position:absolute;top:12px;right:12px;width:28px;height:28px;
    background:rgba(255,255,255,0.08);border:none;border-radius:50%;
    color:var(--muted);font-size:14px;cursor:pointer;z-index:10;
    display:flex;align-items:center;justify-content:center;
  }

  /* Screen management */
  .screen{display:none;width:100%}
  .screen.active{display:flex;flex-direction:column;align-items:center}

  /* â”€â”€ SCREEN 1: The Offer â”€â”€ */
  .offer-card{
    width:100%;background:var(--card);border:1px solid var(--border);
    border-radius:20px;overflow:hidden;
    animation:cardIn 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  @keyframes cardIn{0%{opacity:0;transform:scale(0.88) translateY(24px)}100%{opacity:1;transform:scale(1) translateY(0)}}

  .offer-header{
    padding:28px 24px 20px;text-align:center;
    background:linear-gradient(180deg,var(--violet-glow),transparent);
  }
  .offer-badge{
    display:inline-flex;align-items:center;gap:6px;
    padding:6px 14px;border-radius:20px;
    background:var(--violet-glow);border:1px solid rgba(139,92,246,0.2);
    font-size:11px;font-weight:600;color:var(--violet);
    margin-bottom:16px;
  }
  .offer-icon{font-size:48px;margin-bottom:14px;display:block}
  .offer-title{font-size:22px;font-weight:800;line-height:1.25;color:#fff;margin-bottom:6px}
  .offer-title em{font-style:normal;color:var(--violet)}
  .offer-sub{font-size:13px;color:var(--muted);line-height:1.5}

  /* Mystery reward */
  .reward-preview{
    margin:0 20px 16px;padding:16px;
    background:var(--card2);border:1px solid var(--border);
    border-radius:14px;position:relative;overflow:hidden;
  }
  .rp-shimmer{
    position:absolute;top:0;left:-100%;width:100%;height:100%;
    background:linear-gradient(90deg,transparent,rgba(139,92,246,0.06),transparent);
    animation:shimmer 3s ease infinite;
  }
  @keyframes shimmer{0%{left:-100%}100%{left:100%}}
  .rp-inner{position:relative;display:flex;align-items:center;gap:14px}
  .rp-mystery{
    width:52px;height:52px;border-radius:14px;
    background:var(--violet-glow);border:1px solid rgba(139,92,246,0.15);
    display:flex;align-items:center;justify-content:center;
    font-size:24px;flex-shrink:0;
  }
  .rp-body{flex:1}
  .rp-label{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--violet);margin-bottom:2px}
  .rp-title{font-size:14px;font-weight:700;color:#fff}
  .rp-hint{font-size:11px;color:var(--muted);margin-top:2px}

  /* Steps to unlock */
  .steps-area{padding:0 20px 16px}
  .steps-title{font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:10px}
  .step-item{
    display:flex;align-items:center;gap:12px;
    padding:12px 14px;background:var(--card2);
    border:1px solid var(--border);border-radius:12px;
    margin-bottom:6px;transition:all 0.3s;
  }
  .step-item.done{border-color:rgba(52,211,153,0.2);background:var(--green-glow)}
  .step-check{
    width:28px;height:28px;border-radius:50%;
    border:2px solid var(--border);
    display:flex;align-items:center;justify-content:center;
    font-size:12px;font-weight:700;flex-shrink:0;
    transition:all 0.3s;color:var(--muted);
  }
  .step-item.done .step-check{
    background:var(--green);border-color:var(--green);color:#fff;
  }
  .step-item.current .step-check{
    border-color:var(--violet);color:var(--violet);
    animation:pulseStep 2s ease infinite;
  }
  @keyframes pulseStep{0%,100%{box-shadow:0 0 0 0 var(--violet-glow)}50%{box-shadow:0 0 0 6px transparent}}
  .step-text{flex:1;font-size:13px;font-weight:500}
  .step-item.done .step-text{color:var(--green)}
  .step-item.locked .step-text{color:var(--muted)}

  /* Progress bar */
  .progress-section{padding:0 20px 20px}
  .prog-bar-bg{
    height:8px;background:var(--card2);border-radius:4px;
    overflow:hidden;margin-bottom:6px;
  }
  .prog-bar-fill{
    height:100%;border-radius:4px;
    background:linear-gradient(90deg,var(--violet),var(--green));
    transition:width 0.6s cubic-bezier(0.34,1.56,0.64,1);
  }
  .prog-text{display:flex;justify-content:space-between;font-size:11px;color:var(--muted)}
  .prog-text .highlight{color:var(--violet);font-weight:600}

  /* CTA */
  .cta-area{padding:0 20px 24px;display:flex;flex-direction:column;gap:8px}
  .btn-primary{
    width:100%;padding:16px;border:none;border-radius:14px;
    background:var(--violet);color:#fff;font-family:'DM Sans',sans-serif;
    font-size:15px;font-weight:700;cursor:pointer;transition:all 0.2s;
  }
  .btn-primary:active{transform:scale(0.97);background:var(--violet-dark)}
  .btn-skip{
    width:100%;padding:10px;border:none;background:transparent;
    color:var(--muted);font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;
  }

  /* â”€â”€ SCREEN 2: Reward Unlocked â”€â”€ */
  .reward-screen{
    text-align:center;
    animation:rewardIn 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  @keyframes rewardIn{0%{opacity:0;transform:scale(0.7)}100%{opacity:1;transform:scale(1)}}

  .confetti-zone{position:fixed;inset:0;pointer-events:none;z-index:0}
  .reward-emoji{font-size:72px;margin-bottom:16px;animation:bounce 1s ease-in-out infinite;position:relative;z-index:1}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
  .reward-tag{
    display:inline-flex;padding:6px 14px;border-radius:20px;
    background:var(--gold-glow);border:1px solid rgba(251,191,36,0.2);
    font-size:11px;font-weight:600;color:var(--gold);margin-bottom:14px;
  }
  .reward-title{font-size:24px;font-weight:800;color:#fff;margin-bottom:8px}
  .reward-desc{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:24px;max-width:300px;margin-left:auto;margin-right:auto}
  .reward-code-box{
    display:inline-flex;align-items:center;gap:10px;
    padding:14px 20px;background:var(--card);
    border:2px dashed var(--gold);border-radius:14px;
    margin-bottom:20px;
  }
  .reward-code{font-size:20px;font-weight:800;letter-spacing:3px;color:var(--gold)}
  .reward-copy{
    width:32px;height:32px;border-radius:8px;border:none;
    background:var(--gold-glow);color:var(--gold);font-size:14px;
    cursor:pointer;display:flex;align-items:center;justify-content:center;
  }
  .reward-cta{
    width:100%;max-width:300px;padding:16px;border:none;border-radius:14px;
    background:var(--gold);color:#000;font-family:'DM Sans',sans-serif;
    font-size:15px;font-weight:700;cursor:pointer;margin-bottom:10px;
  }
  .reward-later{
    background:none;border:none;color:var(--muted);
    font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;padding:10px;
  }
</style>
</head>
<body>

<script>
  const CONFIG = {
    includeDismissButton: true,

    brand: { name: "AppName" },

    offer: {
      badge: "Welcome Offer",
      icon: "ðŸŽ¯",
      title: "Complete your first <em>action</em>, unlock a reward",
      subtitle: "New here? We've got something special waiting for you",
    },

    mysteryReward: {
      emoji: "ðŸŽ",
      label: "Your reward",
      title: "Mystery welcome gift",
      hint: "Complete all steps to reveal",
    },

    // Steps â€” mark as done: true for completed ones
    // Pull from CT profile in production
    steps: [
      { text: "Create your account", done: true },
      { text: "Browse your first 3 items", done: true },
      { text: "Add something to your cart", done: false },
      { text: "Complete your first purchase", done: false },
    ],

    reward: {
      emoji: "ðŸ†",
      tag: "Reward Unlocked!",
      title: "You earned RM25 off!",
      desc: "Use this code on any order above RM50. Valid for 7 days â€” don't let it expire!",
      code: "WELCOME25",
      ctaText: "Use My Reward Now",
      ctaUrl: "app://shop?promo=WELCOME25",
      laterText: "I'll use it later",
    },

    tracking: { eventPrefix: "FirstAction" },
  };
</script>

<button class="dismiss" id="dismissBtn" onclick="dismiss()" style="display:none">âœ•</button>

<!-- SCREEN 1: Offer -->
<div class="screen active" id="screenOffer">
  <div class="offer-card">
    <div class="offer-header">
      <div class="offer-badge" id="offerBadge"></div>
      <span class="offer-icon" id="offerIcon"></span>
      <div class="offer-title" id="offerTitle"></div>
      <div class="offer-sub" id="offerSub"></div>
    </div>

    <div class="reward-preview">
      <div class="rp-shimmer"></div>
      <div class="rp-inner">
        <div class="rp-mystery" id="rpEmoji"></div>
        <div class="rp-body">
          <div class="rp-label" id="rpLabel"></div>
          <div class="rp-title" id="rpTitle"></div>
          <div class="rp-hint" id="rpHint"></div>
        </div>
      </div>
    </div>

    <div class="steps-area">
      <div class="steps-title">Steps to unlock</div>
      <div id="stepList"></div>
    </div>

    <div class="progress-section">
      <div class="prog-bar-bg"><div class="prog-bar-fill" id="progFill"></div></div>
      <div class="prog-text"><span id="progText"></span><span class="highlight" id="progPercent"></span></div>
    </div>

    <div class="cta-area">
      <button class="btn-primary" id="btnAction" onclick="ctaAction()"></button>
      <button class="btn-skip" onclick="dismiss()">Maybe later</button>
    </div>
  </div>
</div>

<!-- SCREEN 2: Reward Revealed -->
<div class="screen" id="screenReward">
  <div class="confetti-zone" id="confetti"></div>
  <div class="reward-screen">
    <div class="reward-emoji" id="rwdEmoji"></div>
    <div class="reward-tag" id="rwdTag"></div>
    <div class="reward-title" id="rwdTitle"></div>
    <div class="reward-desc" id="rwdDesc"></div>
    <div class="reward-code-box">
      <span class="reward-code" id="rwdCode"></span>
      <button class="reward-copy" onclick="copyReward()">ðŸ“‹</button>
    </div>
    <br>
    <button class="reward-cta" id="rwdCta" onclick="redeemReward()"></button>
    <br>
    <button class="reward-later" onclick="dismiss()" id="rwdLater"></button>
  </div>
</div>

<script>
  const { brand, offer, mysteryReward, steps, reward, tracking, includeDismissButton } = CONFIG;

  if (includeDismissButton) document.getElementById('dismissBtn').style.display = 'flex';

  // Populate offer screen
  document.getElementById('offerBadge').textContent = 'âœ¨ ' + offer.badge;
  document.getElementById('offerIcon').textContent = offer.icon;
  document.getElementById('offerTitle').innerHTML = offer.title;
  document.getElementById('offerSub').textContent = offer.subtitle;
  document.getElementById('rpEmoji').textContent = mysteryReward.emoji;
  document.getElementById('rpLabel').textContent = mysteryReward.label;
  document.getElementById('rpTitle').textContent = mysteryReward.title;
  document.getElementById('rpHint').textContent = mysteryReward.hint;

  // Populate reward screen
  document.getElementById('rwdEmoji').textContent = reward.emoji;
  document.getElementById('rwdTag').textContent = reward.tag;
  document.getElementById('rwdTitle').textContent = reward.title;
  document.getElementById('rwdDesc').textContent = reward.desc;
  document.getElementById('rwdCode').textContent = reward.code;
  document.getElementById('rwdCta').textContent = reward.ctaText;
  document.getElementById('rwdLater').textContent = reward.laterText;

  // Build steps
  const doneCount = steps.filter(function(s){ return s.done; }).length;
  const allDone = doneCount === steps.length;
  const progress = Math.round((doneCount / steps.length) * 100);
  let foundCurrent = false;

  const stepList = document.getElementById('stepList');
  steps.forEach(function(s, i) {
    const div = document.createElement('div');
    let status = 'locked';
    if (s.done) { status = 'done'; }
    else if (!foundCurrent) { status = 'current'; foundCurrent = true; }
    div.className = 'step-item ' + status;
    div.innerHTML =
      '<div class="step-check">' + (s.done ? 'âœ“' : (i + 1)) + '</div>' +
      '<div class="step-text">' + s.text + '</div>';
    stepList.appendChild(div);
  });

  document.getElementById('progFill').style.width = progress + '%';
  document.getElementById('progText').textContent = doneCount + ' of ' + steps.length + ' completed';
  document.getElementById('progPercent').textContent = progress + '%';

  // CTA text based on next step
  const nextStep = steps.find(function(s){ return !s.done; });
  document.getElementById('btnAction').textContent = nextStep ? nextStep.text + ' â†’' : reward.ctaText;

  // If all done, show reward screen directly
  if (allDone) {
    document.getElementById('screenOffer').classList.remove('active');
    document.getElementById('screenReward').classList.add('active');
    spawnConfetti();
  }

  trackEvent(tracking.eventPrefix + '_Viewed', {
    steps_completed: doneCount,
    total_steps: steps.length,
    progress: progress
  });

  function ctaAction() {
    if (allDone) {
      document.getElementById('screenOffer').classList.remove('active');
      document.getElementById('screenReward').classList.add('active');
      spawnConfetti();
      trackEvent(tracking.eventPrefix + '_Reward_Revealed', { code: reward.code });
    } else {
      trackEvent(tracking.eventPrefix + '_NextStep_Clicked', {
        step: nextStep ? nextStep.text : '',
        progress: progress
      });
      if (reward.ctaUrl) window.location.href = reward.ctaUrl;
      try { window.location.href = 'wzrk://exit'; } catch(e) {}
    }
  }

  function copyReward() {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(reward.code).catch(function(){});
    } else {
      const ta = document.createElement('textarea');
      ta.value = reward.code; ta.style.cssText = 'position:fixed;left:-9999px';
      document.body.appendChild(ta); ta.select();
      try { document.execCommand('copy'); } catch(e) {}
      document.body.removeChild(ta);
    }
    trackEvent(tracking.eventPrefix + '_Code_Copied', { code: reward.code });
  }

  function redeemReward() {
    trackEvent(tracking.eventPrefix + '_Redeemed', { code: reward.code });
    if (reward.ctaUrl) window.location.href = reward.ctaUrl;
  }

  function spawnConfetti() {
    const colors = ['#8B5CF6','#FBBF24','#34D399','#F472B6','#3B82F6','#fff'];
    const zone = document.getElementById('confetti');
    for (let i = 0; i < 30; i++) {
      const c = document.createElement('div');
      c.style.cssText = 'position:absolute;width:' + (4 + Math.random()*6) + 'px;height:' +
        (4 + Math.random()*6) + 'px;border-radius:50%;background:' +
        colors[Math.floor(Math.random()*colors.length)] +
        ';left:' + Math.random()*100 + '%;animation:confFall ' +
        (2 + Math.random()) + 's ease-out ' + Math.random()*0.5 + 's forwards;opacity:0';
      zone.appendChild(c);
    }
    const style = document.createElement('style');
    style.textContent = '@keyframes confFall{0%{opacity:0;transform:translateY(-20vh) scale(0)}20%{opacity:1}100%{opacity:0;transform:translateY(100vh) scale(0.5) rotate(' + (Math.random()*360) + 'deg)}}';
    document.head.appendChild(style);
  }

  function dismiss() {
    trackEvent(tracking.eventPrefix + '_Dismissed', { progress: progress });
    try { window.location.href = 'wzrk://exit'; } catch(e) {}
  }

  function trackEvent(name, props) {
    console.log('CT Event:', name, props || {});
    if (window.CleverTap) window.CleverTap.pushEvent(name, props || {});
    if (window.clevertap) window.clevertap.event.push(name, props || {});
    try { window.webkit.messageHandlers.clevertap.postMessage(JSON.stringify({ event: name, properties: props || {} })); } catch(e) {}
  }
</script>
</body>
</html>
