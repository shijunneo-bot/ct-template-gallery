<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "Yes",
        tagline: "Uncap Yourself",
        purple: "#7C3AED",
        purpleDeep: "#4C1D95",
        magenta: "#EC4899",
        cyan: "#06B6D4",
        lime: "#84CC16",
        orange: "#F97316",
        surface: "#0E0520",
        card: "#160A2E",
        cardHover: "#1E0F3D",
      },

      items: [
        { id: "speed", emoji: "√¢≈°¬°", label: "Laju Gila Speed", desc: "5G Advanced uncapped speeds", color: "#06B6D4", bg: "rgba(6,182,212,0.1)" },
        { id: "price", emoji: "üí∏", label: "Harga Paling Jimat", desc: "Cheapest 5G in Malaysia", color: "#84CC16", bg: "rgba(132,204,22,0.1)" },
        { id: "data", emoji: "‚ôæÔ∏è", label: "Unlimited Data", desc: "No cap, no FUP, no throttle", color: "#7C3AED", bg: "rgba(124,58,237,0.1)" },
        { id: "hotspot", emoji: "üì°", label: "Hotspot Banyak", desc: "Share with all your devices", color: "#F97316", bg: "rgba(249,115,22,0.1)" },
        { id: "device", emoji: "üì±", label: "Free Phone Lah!", desc: "Free flagship 5G phone", color: "#EC4899", bg: "rgba(236,72,153,0.1)" },
      ],

      recommendations: {
        speed: { plan: "Infinite Ultra", price: "RM178/mth", line: "Uncapped 5G Advanced ¬∑ up to 1Gbps", emoji: "üöÄ", color: "#06B6D4" },
        price: { plan: "FT5G Prepaid", price: "RM38/mth", line: "Malaysia's cheapest 5G plan", emoji: "üéâ", color: "#84CC16" },
        data: { plan: "Infinite Premium", price: "RM118/mth", line: "True unlimited 4G + 5G ¬∑ zero FUP", emoji: "‚ôæÔ∏è", color: "#7C3AED" },
        hotspot: { plan: "Infinite Ultra", price: "RM178/mth", line: "100GB hotspot + unlimited data", emoji: "üì°", color: "#F97316" },
        device: { plan: "Infinite+ Contract", price: "RM99/mth", line: "Free Samsung Galaxy S24 included", emoji: "üì±", color: "#EC4899" },
      },

      testMode: new URLSearchParams(window.location.search).get("test") === "true",
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Yes 5G ‚Äì What Matters Most?</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&display=swap');

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:'Outfit',-apple-system,BlinkMacSystemFont,sans-serif;
      background:#0E0520;min-height:100vh;
      display:flex;justify-content:center;align-items:flex-start;
      padding:10px;-webkit-tap-highlight-color:transparent;
      overflow-x:hidden;
    }

    .modal{
      width:100%;max-width:380px;
      background:#0E0520;border-radius:24px;
      overflow:hidden;position:relative;
      box-shadow:0 24px 80px rgba(124,58,237,0.12);
      border:1px solid rgba(124,58,237,0.08);
    }

    /* Dismiss */
    .dismiss{position:absolute;top:12px;right:12px;width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,0.05);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,0.25);font-size:14px;z-index:30;transition:all 0.2s}
    .dismiss:active{background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.5)}

    /* ===== HEADER ===== */
    .head{text-align:center;padding:26px 24px 12px;position:relative}
    .head::before{
      content:'';position:absolute;inset:-60px -40px 0;
      background:
        radial-gradient(ellipse 250px 180px at 30% 10%,rgba(124,58,237,0.2),transparent 70%),
        radial-gradient(ellipse 200px 140px at 70% 30%,rgba(236,72,153,0.15),transparent 70%),
        radial-gradient(ellipse 180px 100px at 50% 100%,rgba(6,182,212,0.1),transparent 70%);
      pointer-events:none;z-index:0;
    }
    .head>*{position:relative;z-index:1}

    .yes-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 14px;border-radius:20px;
      background:rgba(124,58,237,0.12);border:1px solid rgba(124,58,237,0.15);
      font-size:11px;font-weight:700;color:#A78BFA;letter-spacing:0.4px;
      margin-bottom:10px;
    }
    .yes-5g{font-weight:900;background:linear-gradient(135deg,#7C3AED,#EC4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}

    .head-emoji{font-size:40px;margin-bottom:6px;display:block;animation:bob 3s ease-in-out infinite}
    @keyframes bob{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-4px) rotate(-3deg)}75%{transform:translateY(-2px) rotate(3deg)}}

    .head-title{font-size:21px;font-weight:900;color:#FFF;line-height:1.25;margin-bottom:4px}
    .grad{background:linear-gradient(135deg,#A78BFA,#EC4899,#06B6D4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .head-sub{font-size:12px;color:rgba(255,255,255,0.3);line-height:1.5}

    /* Instruction bar */
    .instr{
      display:flex;align-items:center;justify-content:center;gap:8px;
      margin:0 16px 10px;padding:8px 14px;
      background:rgba(124,58,237,0.05);
      border:1px dashed rgba(124,58,237,0.12);border-radius:12px;
      font-size:11px;font-weight:600;color:rgba(255,255,255,0.25);
      transition:opacity 0.4s;
    }
    .instr svg{animation:bounce 2s ease-in-out infinite;flex-shrink:0}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}

    /* ===== RANK LIST ===== */
    .rank-zone{
      position:relative;padding:0 16px 6px;
    }

    .rk{
      position:absolute;left:16px;right:16px;
      display:flex;align-items:center;gap:10px;
      padding:12px 10px 12px 12px;
      background:#160A2E;
      border:1px solid rgba(255,255,255,0.03);
      border-radius:16px;
      cursor:grab;touch-action:none;user-select:none;
      transition:top 0.3s cubic-bezier(0.25,0.46,0.45,0.94),
                box-shadow 0.3s ease,border-color 0.3s ease,
                transform 0.2s ease;
      z-index:1;
    }
    .rk:active{cursor:grabbing}
    .rk.dragging{
      z-index:100;
      transform:scale(1.04);
      box-shadow:0 16px 48px rgba(0,0,0,0.6),0 0 0 2px rgba(124,58,237,0.25);
      border-color:rgba(124,58,237,0.3);
      transition:box-shadow 0.15s ease,border-color 0.15s ease,transform 0.15s ease;
    }
    .rk.hint{animation:hintNudge 1.8s ease-in-out 1.5s 2}
    @keyframes hintNudge{0%,100%{transform:translateY(0)}20%{transform:translateY(-10px)}50%{transform:translateY(6px)}70%{transform:translateY(-3px)}}

    /* Badge */
    .badge{
      flex-shrink:0;width:26px;height:26px;border-radius:9px;
      display:flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:900;color:#FFF;
      transition:all 0.3s;
    }
    .b1{background:linear-gradient(135deg,#F59E0B,#EF4444);box-shadow:0 2px 8px rgba(245,158,11,0.35)}
    .b2{background:linear-gradient(135deg,#94A3B8,#64748B)}
    .b3{background:linear-gradient(135deg,#A16207,#854D0E)}
    .b4,.b5{background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.3)}

    /* Emoji */
    .rk-icon{
      flex-shrink:0;font-size:24px;width:38px;height:38px;
      display:flex;align-items:center;justify-content:center;
      border-radius:12px;
    }

    /* Text */
    .rk-txt{flex:1;min-width:0}
    .rk-label{font-size:13px;font-weight:700;color:#FFF;line-height:1.2}
    .rk-desc{font-size:10px;font-weight:500;color:rgba(255,255,255,0.25);margin-top:1px}

    /* Grip */
    .grip{flex-shrink:0;display:grid;grid-template-columns:4px 4px;gap:3px;padding:8px 4px;opacity:0.15;transition:opacity 0.2s}
    .grip span{width:4px;height:4px;background:#FFF;border-radius:50%}
    .rk:hover .grip{opacity:0.35}
    .rk.dragging .grip{opacity:0.7}

    /* ===== CTA ===== */
    .cta-area{padding:6px 16px 6px}
    .btn-go{
      width:100%;padding:15px;border:none;border-radius:16px;
      font-family:inherit;font-size:15px;font-weight:800;
      cursor:pointer;color:#FFF;letter-spacing:0.3px;
      background:linear-gradient(135deg,#7C3AED,#EC4899);
      box-shadow:0 4px 24px rgba(124,58,237,0.35);
      transition:all 0.2s;
    }
    .btn-go:active{transform:scale(0.97);box-shadow:0 2px 12px rgba(124,58,237,0.2)}

    .status{text-align:center;padding:6px;font-size:10px;font-weight:600;color:rgba(255,255,255,0.12);min-height:24px}

    /* ===== RESULT ===== */
    .result{display:none;padding:24px 20px 12px;text-align:center}
    .result.on{display:block;animation:riseIn 0.5s ease both}
    @keyframes riseIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

    .res-pop{font-size:52px;display:block;animation:popBounce 0.6s cubic-bezier(0.34,1.56,0.64,1) 0.15s both}
    @keyframes popBounce{from{transform:scale(0) rotate(-15deg);opacity:0}to{transform:scale(1) rotate(0);opacity:1}}

    .res-title{font-size:16px;font-weight:800;color:rgba(255,255,255,0.9);margin:6px 0 2px}
    .res-sub{font-size:11px;color:rgba(255,255,255,0.3);margin-bottom:16px}

    .plan-card{
      background:#160A2E;border:1px solid rgba(124,58,237,0.12);
      border-radius:20px;padding:22px 18px;margin-bottom:16px;
      position:relative;overflow:hidden;
    }
    .plan-card::before{
      content:'';position:absolute;top:-40px;right:-40px;
      width:140px;height:140px;border-radius:50%;
      background:var(--glow,rgba(124,58,237,0.1));
      opacity:0.08;pointer-events:none;
    }
    .plan-name{font-size:13px;font-weight:700;color:rgba(255,255,255,0.4);letter-spacing:0.5px;text-transform:uppercase;margin-bottom:2px}
    .plan-title{
      font-size:26px;font-weight:900;line-height:1.15;
      background:linear-gradient(135deg,#A78BFA,#EC4899,#06B6D4);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      margin-bottom:4px;
    }
    .plan-price{font-size:32px;font-weight:900;color:#FFF;margin-bottom:6px}
    .plan-price small{font-size:14px;font-weight:600;color:rgba(255,255,255,0.4)}
    .plan-line{
      display:inline-block;font-size:11px;font-weight:600;
      color:rgba(255,255,255,0.45);padding:5px 12px;
      background:rgba(255,255,255,0.03);border-radius:10px;
    }

    /* Ranking recap */
    .recap{margin-bottom:16px}
    .recap-title{font-size:10px;font-weight:700;color:rgba(255,255,255,0.15);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px}
    .recap-row{
      display:flex;align-items:center;gap:8px;
      padding:5px 10px;border-radius:10px;
      font-size:11px;font-weight:600;color:rgba(255,255,255,0.3);
      animation:slideRow 0.4s ease both;
    }
    .recap-row:first-child{color:rgba(255,255,255,0.8);background:rgba(255,255,255,0.04)}
    .recap-num{
      width:20px;height:20px;border-radius:6px;flex-shrink:0;
      display:flex;align-items:center;justify-content:center;
      font-size:10px;font-weight:800;
      background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.25);
    }
    .recap-row:first-child .recap-num{background:linear-gradient(135deg,#F59E0B,#EF4444);color:#FFF}
    @keyframes slideRow{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}

    .btn-plan{
      width:100%;padding:14px;border:none;border-radius:16px;
      font-family:inherit;font-size:14px;font-weight:800;
      cursor:pointer;color:#FFF;
      background:linear-gradient(135deg,#7C3AED,#EC4899);
      box-shadow:0 4px 16px rgba(124,58,237,0.3);
      margin-bottom:6px;transition:all 0.2s;
    }
    .btn-plan:active{transform:scale(0.97)}
    .btn-again{
      width:100%;padding:10px;border:1px solid rgba(255,255,255,0.05);
      border-radius:12px;background:transparent;
      font-family:inherit;font-size:11px;font-weight:600;
      color:rgba(255,255,255,0.25);cursor:pointer;
    }
    .btn-again:active{background:rgba(255,255,255,0.02)}

    /* Test */
    .test{background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.12);border-radius:12px;margin:10px 16px;padding:10px}
    .test-head{font-size:9px;font-weight:700;color:#F5A623;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
    .test-row{display:flex;flex-wrap:wrap;gap:4px}
    .tbtn{padding:4px 10px;border-radius:8px;border:1px solid rgba(245,158,11,0.15);background:rgba(245,158,11,0.04);font-family:inherit;font-size:10px;font-weight:600;color:#F5A623;cursor:pointer}
    .tbtn:hover{background:rgba(245,158,11,0.12)}

    .foot{text-align:center;font-size:9px;color:rgba(255,255,255,0.08);padding:8px 20px 16px;line-height:1.5}
  </style>
</head>

<body>
  <div class="modal" id="modal">
    <button class="dismiss" onclick="dismiss()">‚úï</button>

    <!-- ===== RANKER VIEW ===== -->
    <div id="rankerView">
      <div class="head">
        <div class="yes-pill"><span class="yes-5g">5G</span> Yes by YTL</div>
        <span class="head-emoji">ü§î</span>
        <div class="head-title">What matters most<br><span class="grad">to YOU?</span></div>
        <div class="head-sub">Drag to rank ¬∑ We'll match<br>your perfect Yes plan</div>
      </div>

      <div class="instr" id="instr">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 2v10M7 2L4 5M7 2l3 3M7 12L4 9M7 12l3-3" stroke="rgba(167,139,250,0.5)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Hold &amp; drag to reorder
      </div>

      <div class="rank-zone" id="rankZone"></div>

      <div class="cta-area" id="ctaArea">
        <button class="btn-go" onclick="submitRanking()">Show My Perfect Plan ‚Üí</button>
      </div>
      <div class="status" id="status">Reorder to discover your match</div>
    </div>

    <!-- ===== RESULT VIEW ===== -->
    <div class="result" id="resultView">
      <span class="res-pop" id="resPop">üöÄ</span>
      <div class="res-title">Your Perfect Yes Plan</div>
      <div class="res-sub" id="resSub">Based on your #1 priority</div>

      <div class="plan-card" id="planCard">
        <div class="plan-name">We recommend</div>
        <div class="plan-title" id="planTitle">Infinite Ultra</div>
        <div class="plan-price" id="planPrice">RM178<small>/mth</small></div>
        <div class="plan-line" id="planLine">Uncapped 5G at 1Gbps</div>
      </div>

      <div class="recap" id="recap">
        <div class="recap-title">Your priorities</div>
      </div>

      <button class="btn-plan" onclick="ctaTap('get_plan')">Get This Plan on yes.my</button>
      <button class="btn-again" onclick="reset()">‚Üª Rank Again</button>
    </div>

    <!-- Test -->
    <div class="test" id="testPanel" style="display:none">
      <div class="test-head">√¢≈°‚Ñ¢ Test Controls</div>
      <div class="test-row">
        <button class="tbtn" onclick="tPreset('speed')">√¢≈°¬° Speed #1</button>
        <button class="tbtn" onclick="tPreset('price')">üí∏ Price #1</button>
        <button class="tbtn" onclick="tPreset('result')">üìä Show Result</button>
        <button class="tbtn" onclick="reset()">üîÑ Reset</button>
        <button class="tbtn" onclick="logState()">üìã Log</button>
      </div>
    </div>

    <div class="foot">Yes 5G by YTL Communications ¬∑ yes.my<br>Uncap Yourself ¬∑ No Data Cap ¬∑ No Speed Cap</div>
  </div>

  <script>
    // ============================================
    // STATE
    // ============================================
    const CARD_H = 72; // card height + gap
    let order = CONFIG.items.map(i => i.id);
    let moveCount = 0, interacted = false;
    let drag = null;
    const zone = document.getElementById('rankZone');
    const loadTime = Date.now();

    // ============================================
    // INIT
    // ============================================
    function init() {
      if (!CONFIG.includeDismissButton) document.querySelector('.dismiss').style.display = 'none';
      if (CONFIG.testMode) document.getElementById('testPanel').style.display = 'block';
      zone.style.height = (CONFIG.items.length * CARD_H) + 'px';
      buildCards();
      pushEvent('Ranker_Viewed', { item_count: CONFIG.items.length, items: order.join(',') });
    }

    // ============================================
    // BUILD CARDS
    // ============================================
    function buildCards() {
      zone.innerHTML = '';
      order.forEach((id, i) => {
        const it = CONFIG.items.find(x => x.id === id);
        const el = document.createElement('div');
        el.className = 'rk' + (i === 0 && !interacted ? ' hint' : '');
        el.id = 'rk-' + id;
        el.dataset.id = id;
        el.style.top = (i * CARD_H) + 'px';

        el.innerHTML = `
          <div class="badge b${i + 1}">${i + 1}</div>
          <div class="rk-icon" style="background:${it.bg}">${it.emoji}</div>
          <div class="rk-txt">
            <div class="rk-label">${it.label}</div>
            <div class="rk-desc">${it.desc}</div>
          </div>
          <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>`;

        el.addEventListener('mousedown', onDown);
        el.addEventListener('touchstart', onDown, { passive: false });
        zone.appendChild(el);
      });
    }

    // ============================================
    // DRAG SYSTEM
    // Cards use position:absolute with `top`.
    // Dragged card follows finger directly.
    // Others animate via CSS transition on `top`.
    // ============================================
    function onDown(e) {
      e.preventDefault();
      const el = e.currentTarget;
      const id = el.dataset.id;
      const idx = order.indexOf(id);
      const zoneRect = zone.getBoundingClientRect();
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const offsetY = clientY - el.getBoundingClientRect().top;

      el.classList.add('dragging');
      el.classList.remove('hint');

      if (!interacted) {
        interacted = true;
        document.getElementById('instr').style.opacity = '0.15';
        pushEvent('Ranker_Started', { first_item: id });
      }

      drag = { el, id, idx, curIdx: idx, zoneTop: zoneRect.top, offsetY };

      document.addEventListener('mousemove', onMove);
      document.addEventListener('touchmove', onMove, { passive: false });
      document.addEventListener('mouseup', onUp);
      document.addEventListener('touchend', onUp);
    }

    function onMove(e) {
      if (!drag) return;
      e.preventDefault();
      const cy = e.touches ? e.touches[0].clientY : e.clientY;
      const relY = cy - drag.zoneTop - drag.offsetY;

      // Clamp within zone
      const maxY = (order.length - 1) * CARD_H;
      const clampedY = Math.max(0, Math.min(maxY, relY));
      drag.el.style.top = clampedY + 'px';
      drag.el.style.transition = 'none';

      // Determine target index
      const targetIdx = Math.max(0, Math.min(order.length - 1,
        Math.round(clampedY / CARD_H)));

      if (targetIdx !== drag.curIdx) {
        order.splice(drag.curIdx, 1);
        order.splice(targetIdx, 0, drag.id);
        drag.curIdx = targetIdx;

        // Animate other cards
        order.forEach((oid, i) => {
          if (oid === drag.id) return;
          const card = document.getElementById('rk-' + oid);
          card.style.transition = 'top 0.25s cubic-bezier(0.25,0.46,0.45,0.94)';
          card.style.top = (i * CARD_H) + 'px';
        });

        updateBadges();
        try { navigator.vibrate && navigator.vibrate(8); } catch (ex) {}
      }
    }

    function onUp() {
      if (!drag) return;
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('touchmove', onMove);
      document.removeEventListener('mouseup', onUp);
      document.removeEventListener('touchend', onUp);

      const fromIdx = drag.idx;
      const toIdx = drag.curIdx;

      // Snap to final position with transition
      drag.el.style.transition = 'top 0.25s cubic-bezier(0.25,0.46,0.45,0.94),box-shadow 0.3s,border-color 0.3s,transform 0.2s';
      drag.el.style.top = (toIdx * CARD_H) + 'px';
      drag.el.classList.remove('dragging');

      if (fromIdx !== toIdx) {
        moveCount++;
        const topItem = CONFIG.items.find(x => x.id === order[0]);
        document.getElementById('status').textContent =
          `${moveCount} move${moveCount !== 1 ? 's' : ''} ¬∑ #1: ${topItem.emoji} ${topItem.label}`;
        pushEvent('Ranker_Item_Moved', {
          item_id: drag.id,
          from_rank: fromIdx + 1,
          to_rank: toIdx + 1,
          move_count: moveCount,
          current_top: order[0],
        });
      }

      drag = null;
    }

    function updateBadges() {
      order.forEach((id, i) => {
        const card = document.getElementById('rk-' + id);
        const badge = card.querySelector('.badge');
        badge.textContent = i + 1;
        badge.className = 'badge b' + (i + 1);
      });
    }

    // ============================================
    // SUBMIT
    // ============================================
    function submitRanking() {
      document.getElementById('rankerView').style.display = 'none';

      const topId = order[0];
      const rec = CONFIG.recommendations[topId];
      const topItem = CONFIG.items.find(x => x.id === topId);

      document.getElementById('resPop').textContent = rec.emoji;
      document.getElementById('resSub').textContent =
        `Because ${topItem.emoji} ${topItem.label} is your #1`;

      const priceMatch = rec.price.match(/^(RM\d+)(.*)/);
      document.getElementById('planTitle').textContent = rec.plan;
      document.getElementById('planPrice').innerHTML =
        priceMatch ? `${priceMatch[1]}<small>${priceMatch[2]}</small>` : rec.price;
      document.getElementById('planLine').textContent = rec.line;
      document.getElementById('planCard').style.borderColor = rec.color + '20';
      document.getElementById('planCard').style.setProperty('--glow', rec.color);

      // Build recap
      const recap = document.getElementById('recap');
      recap.querySelectorAll('.recap-row').forEach(r => r.remove());
      order.forEach((id, i) => {
        const it = CONFIG.items.find(x => x.id === id);
        const row = document.createElement('div');
        row.className = 'recap-row';
        row.style.animationDelay = (0.25 + i * 0.07) + 's';
        row.innerHTML = `<span class="recap-num">${i + 1}</span>${it.emoji} ${it.label}`;
        recap.appendChild(row);
      });

      document.getElementById('resultView').classList.add('on');

      pushEvent('Ranker_Submitted', {
        ranking: order.join(','),
        top_priority: topId,
        recommended_plan: rec.plan,
        recommended_price: rec.price,
        move_count: moveCount,
        time_to_submit: Math.round((Date.now() - loadTime) / 1000),
      });
    }

    // ============================================
    // RESET
    // ============================================
    function reset() {
      order = CONFIG.items.map(i => i.id);
      moveCount = 0;
      interacted = false;

      document.getElementById('resultView').classList.remove('on');
      document.getElementById('resultView').style.display = '';
      document.getElementById('rankerView').style.display = '';
      document.getElementById('status').textContent = 'Reorder to discover your match';
      document.getElementById('instr').style.opacity = '';
      buildCards();
    }

    // ============================================
    // CLEVERTAP
    // ============================================
    function pushEvent(name, props) {
      const p = props || {};
      p.Timestamp = new Date().toISOString();
      p.Brand = 'Yes';
      p.Template = 'Drag_To_Rank_Sorter';
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(p));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, p);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(
            JSON.stringify({ type: 'event', name, props: p }));
      } catch (e) { console.log('[CT]', name, p); }
      if (CONFIG.testMode) console.log('%c[CT] ' + name, 'color:#A78BFA;font-weight:bold', p);
    }

    function ctaTap(type) {
      pushEvent('Ranker_CTA_Tapped', {
        cta_type: type, ranking: order.join(','),
        top_priority: order[0], move_count: moveCount,
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.openUrl)
          CleverTap.openUrl('https://www.yes.my/plans');
      } catch (e) {}
    }

    function dismiss() {
      pushEvent('Ranker_Dismissed', {
        ranking: order.join(','), interacted,
        move_count: moveCount,
        time_on_modal: Math.round((Date.now() - loadTime) / 1000),
      });
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.closeInApp)
          CleverTap.closeInApp();
      } catch (e) {}
    }

    // ============================================
    // TEST
    // ============================================
    function tPreset(p) {
      if (p === 'result') { order = ['data','speed','price','hotspot','device']; moveCount = 4; interacted = true; submitRanking(); return; }
      const map = { speed: ['speed','data','hotspot','device','price'], price: ['price','data','speed','hotspot','device'] };
      if (map[p]) { order = map[p]; moveCount = 3; interacted = true; buildCards(); }
    }
    function logState() {
      console.table({ order: order.join(' > '), moveCount, interacted, topPriority: order[0], timeOnModal: Math.round((Date.now() - loadTime) / 1000) + 's' });
    }

    init();
  </script>
</body>
</html>
