<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const CONFIG = {
      includeDismissButton: true,

      brand: {
        name: "SocialGood",
        // Dark crypto-fintech palette
        bg: "#0B0F1A",
        surface: "#131929",
        surfaceRaised: "#1A2236",
        border: "rgba(255,255,255,0.06)",
        green: "#00E676",
        greenDark: "#00C853",
        greenGlow: "rgba(0,230,118,0.3)",
        greenSubtle: "rgba(0,230,118,0.08)",
        gold: "#FFD740",
        goldDark: "#FFC400",
        goldGlow: "rgba(255,215,64,0.25)",
        white: "#F0F4F8",
        grey: "#6B7A94",
        greyLight: "#8B95A8",
      },

      // üé∞ Wheel segments ‚Äî 8 slices
      //   probability must sum to 1.0
      //   colour alternates for visual contrast
      segments: [
        { label: "50 SG",         value: "SG50",      probability: 0.25, color: "#1A2236", textColor: "#F0F4F8", icon: "ü™ô" },
        { label: "2x Cashback",   value: "2XCASH",    probability: 0.20, color: "#00C853", textColor: "#0B0F1A", icon: "üíé" },
        { label: "100 SG",        value: "SG100",     probability: 0.18, color: "#1A2236", textColor: "#F0F4F8", icon: "ü™ô" },
        { label: "Free Shipping", value: "FREESHIP",  probability: 0.15, color: "#FFD740", textColor: "#0B0F1A", icon: "üöö" },
        { label: "200 SG",        value: "SG200",     probability: 0.10, color: "#1A2236", textColor: "#F0F4F8", icon: "ü™ô" },
        { label: "5x Cashback",   value: "5XCASH",    probability: 0.06, color: "#00E676", textColor: "#0B0F1A", icon: "üî•" },
        { label: "500 SG",        value: "SG500",     probability: 0.04, color: "#1A2236", textColor: "#F0F4F8", icon: "üí∞" },
        { label: "1000 SG üéâ",   value: "SG1000",    probability: 0.02, color: "#FFD740", textColor: "#0B0F1A", icon: "üèÜ" },
      ],

      // ‚öôÔ∏è Spin behaviour
      spin: {
        minTurns: 4,
        maxTurns: 7,
        durationMs: 4500,
        easing: "cubic-bezier(0.15, 0.85, 0.25, 1)",
      },

      // üéâ Post-spin
      enableConfetti: true,
      revealDelayMs: 800,

      // üìù Copy
      headline: "Spin & Earn SG",
      subheadline: "Your daily reward is waiting. Tap to spin!",

      // üîó CTA after win
      cta: {
        text: "Shop & Use Reward",
        url: "socialgood://store",
        secondaryText: "Maybe Later",
      },

      // üìä CleverTap Events
      events: {
        wheelViewed: "SpinWheel_Viewed",
        wheelSpun: "SpinWheel_Spun",
        wheelResult: "SpinWheel_Result",
        wheelCta: "SpinWheel_CTA_Clicked",
        wheelDismissed: "SpinWheel_Dismissed",
        codeCopied: "SpinWheel_Code_Copied",
      },
    };
  </script>

  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>SocialGood ‚Äî Spin & Earn</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@600;700;800&display=swap');

    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

    html,body{
      width:100%;height:100%;
      font-family:'Outfit',sans-serif;
      background:#0B0F1A;
      -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }

    /* =============================================
       MODAL
       ============================================= */
    .modal{
      width:100%;height:100%;
      display:flex;flex-direction:column;
      align-items:center;
      padding:16px 20px 24px;
      position:relative;
      overflow-y:auto;overflow-x:hidden;
      -webkit-overflow-scrolling:touch;
      background:linear-gradient(175deg,#0B0F1A 0%,#131929 40%,#0B0F1A 100%);
    }

    /* Ambient glow */
    .modal::before{
      content:'';position:fixed;inset:0;
      background:
        radial-gradient(ellipse 50% 35% at 50% 45%,rgba(0,230,118,0.06) 0%,transparent 70%),
        radial-gradient(ellipse 40% 30% at 50% 10%,rgba(255,215,64,0.04) 0%,transparent 70%);
      pointer-events:none;z-index:0;
    }

    /* =============================================
       DISMISS
       ============================================= */
    .dismiss{
      position:fixed;top:12px;right:12px;
      width:32px;height:32px;border-radius:50%;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.06);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;z-index:100;
      -webkit-tap-highlight-color:transparent;
    }
    .dismiss:active{background:rgba(255,255,255,0.08)}
    .dismiss svg{width:13px;height:13px;stroke:rgba(255,255,255,0.35);stroke-width:2}

    /* =============================================
       CONTENT
       ============================================= */
    .content{
      position:relative;z-index:1;
      width:100%;max-width:360px;
      display:flex;flex-direction:column;
      align-items:center;text-align:center;
    }

    /* =============================================
       HEADER
       ============================================= */
    .header{
      margin-bottom:16px;
      opacity:0;animation:fadeUp .4s ease .15s forwards;
    }
    @keyframes fadeUp{
      from{opacity:0;transform:translateY(8px)}
      to{opacity:1;transform:translateY(0)}
    }

    .badge{
      display:inline-flex;align-items:center;gap:5px;
      padding:4px 12px;border-radius:100px;
      background:rgba(0,230,118,0.08);
      border:1px solid rgba(0,230,118,0.12);
      font-size:10px;font-weight:700;
      color:#00E676;text-transform:uppercase;
      letter-spacing:0.8px;margin-bottom:10px;
    }

    .headline{
      font-size:24px;font-weight:800;
      color:#F0F4F8;line-height:1.2;
      margin-bottom:4px;
    }
    .headline .accent{color:#00E676}

    .sub{
      font-size:13px;color:#6B7A94;
      font-weight:500;line-height:1.4;
    }

    /* =============================================
       WHEEL ASSEMBLY
       ============================================= */
    .wheel-assembly{
      position:relative;
      width:280px;height:280px;
      margin:8px 0 16px;
      opacity:0;animation:fadeScale .5s cubic-bezier(.16,1,.3,1) .25s forwards;
    }
    @keyframes fadeScale{
      from{opacity:0;transform:scale(.85)}
      to{opacity:1;transform:scale(1)}
    }

    /* Outer ring of indicator lights */
    .indicator-ring{
      position:absolute;inset:-10px;
      border-radius:50%;
      pointer-events:none;
    }
    .indicator-dot{
      position:absolute;
      width:6px;height:6px;
      border-radius:50%;
      background:rgba(255,255,255,0.1);
      transform:translate(-50%,-50%);
      transition:background .15s ease,box-shadow .15s ease;
    }
    .indicator-dot.lit{
      background:#FFD740;
      box-shadow:0 0 6px rgba(255,215,64,0.5);
    }

    /* Pointer / arrow at top */
    .pointer{
      position:absolute;
      top:-6px;left:50%;
      transform:translateX(-50%);
      z-index:5;
      width:0;height:0;
      border-left:12px solid transparent;
      border-right:12px solid transparent;
      border-top:20px solid #FFD740;
      filter:drop-shadow(0 2px 6px rgba(255,215,64,0.3));
      transition:transform .1s ease;
    }
    .pointer.bounce{
      animation:pointerBounce .3s ease;
    }
    @keyframes pointerBounce{
      0%,100%{transform:translateX(-50%) translateY(0)}
      50%{transform:translateX(-50%) translateY(3px)}
    }

    /* SVG Wheel */
    .wheel-svg{
      width:100%;height:100%;
      border-radius:50%;
      box-shadow:
        0 0 0 6px rgba(255,255,255,0.04),
        0 0 0 8px rgba(0,230,118,0.08),
        0 4px 24px rgba(0,0,0,0.4);
      transition-property:transform;
      transition-timing-function:cubic-bezier(0.15,0.85,0.25,1);
    }

    .wheel-svg.spinning{
      transition-duration:4500ms;
    }

    /* Center hub */
    .center-hub{
      position:absolute;
      top:50%;left:50%;
      transform:translate(-50%,-50%);
      width:48px;height:48px;
      border-radius:50%;
      background:linear-gradient(135deg,#1A2236,#131929);
      border:3px solid rgba(0,230,118,0.2);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;font-weight:900;
      color:#00E676;
      z-index:3;
      box-shadow:0 0 20px rgba(0,230,118,0.15);
    }
    .center-hub span{
      font-family:'JetBrains Mono',monospace;
      font-size:11px;letter-spacing:0.5px;
    }

    /* =============================================
       SPIN BUTTON
       ============================================= */
    .spin-btn{
      width:100%;max-width:280px;
      padding:16px;border-radius:16px;
      border:none;
      background:#00E676;
      color:#0B0F1A;
      font-family:'Outfit',sans-serif;
      font-size:16px;font-weight:800;
      letter-spacing:0.3px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      box-shadow:0 4px 24px rgba(0,230,118,0.25),0 0 0 1px rgba(0,230,118,0.3);
      transition:all .2s ease;
      opacity:0;animation:fadeUp .4s ease .4s forwards;
    }
    .spin-btn:active{transform:scale(.97);background:#00C853}
    .spin-btn:disabled{opacity:.5;cursor:default;transform:none}

    /* =============================================
       REWARD OVERLAY ‚Äî slides up over wheel
       ============================================= */
    .reward-overlay{
      position:absolute;
      inset:0;
      display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      z-index:10;
      pointer-events:none;
      opacity:0;
      transition:opacity .4s ease;
    }
    .reward-overlay.show{
      opacity:1;pointer-events:auto;
    }

    .reward-card{
      width:90%;max-width:320px;
      background:#131929;
      border:1px solid rgba(0,230,118,0.12);
      border-radius:20px;
      padding:28px 24px 24px;
      text-align:center;
      transform:scale(.8) translateY(20px);
      transition:transform .5s cubic-bezier(.34,1.56,.64,1),opacity .3s ease;
      opacity:0;
    }
    .reward-overlay.show .reward-card{
      transform:scale(1) translateY(0);
      opacity:1;
    }

    .rw-icon{font-size:40px;margin-bottom:8px}

    .rw-title{
      font-size:14px;font-weight:700;
      color:#00E676;text-transform:uppercase;
      letter-spacing:1px;margin-bottom:4px;
    }

    .rw-prize{
      font-size:28px;font-weight:900;
      color:#F0F4F8;line-height:1.2;
      margin-bottom:12px;
    }

    /* Coupon ticket */
    .coupon-ticket{
      display:flex;align-items:center;justify-content:center;gap:10px;
      padding:14px 20px;
      border-radius:12px;
      border:2px dashed rgba(0,230,118,0.25);
      background:rgba(0,230,118,0.04);
      margin-bottom:6px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      transition:all .2s ease;
    }
    .coupon-ticket:active{
      background:rgba(0,230,118,0.08);
      border-color:rgba(0,230,118,0.4);
    }

    .coupon-code{
      font-family:'JetBrains Mono',monospace;
      font-size:20px;font-weight:800;
      color:#00E676;letter-spacing:1px;
    }

    .copy-icon{
      width:20px;height:20px;
      stroke:#6B7A94;stroke-width:2;
      transition:stroke .2s ease;
      flex-shrink:0;
    }
    .coupon-ticket.copied .copy-icon{stroke:#00E676}

    .copy-hint{
      font-size:11px;color:#6B7A94;
      font-weight:500;margin-bottom:16px;
      transition:color .2s ease;
    }
    .copy-hint.copied{color:#00E676}

    /* Reward CTAs */
    .rw-cta{
      width:100%;padding:14px;
      border-radius:14px;border:none;
      background:#00E676;color:#0B0F1A;
      font-family:'Outfit',sans-serif;
      font-size:14px;font-weight:700;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      box-shadow:0 4px 20px rgba(0,230,118,0.2);
      transition:all .2s ease;
    }
    .rw-cta:active{transform:scale(.97);background:#00C853}

    .rw-secondary{
      margin-top:8px;
      background:transparent;border:none;
      color:#6B7A94;font-size:12px;font-weight:600;
      font-family:'Outfit',sans-serif;
      cursor:pointer;padding:8px;
      -webkit-tap-highlight-color:transparent;
    }

    /* =============================================
       CONFETTI
       ============================================= */
    .confetti-container{
      position:fixed;inset:0;
      pointer-events:none;z-index:99999;
    }
    .confetti-piece{
      position:absolute;
      border-radius:2px;
      animation:confettiFall linear forwards;
    }
    @keyframes confettiFall{
      0%{transform:translateY(-30px) rotate(0) scale(1);opacity:1}
      80%{opacity:1}
      100%{transform:translateY(105vh) rotate(720deg) scale(.3);opacity:0}
    }
  </style>
</head>

<body>
  <div class="modal">
    <!-- Dismiss -->
    <button class="dismiss" id="dismissBtn" onclick="dismiss()" aria-label="Close">
      <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>

    <div class="content">
      <!-- Header -->
      <div class="header">
        <div class="badge">‚ö° Daily Reward</div>
        <div class="headline"><span class="accent">Spin</span> & Earn SG</div>
        <div class="sub" id="subText"></div>
      </div>

      <!-- Wheel Assembly -->
      <div class="wheel-assembly" id="wheelAssembly">
        <!-- Indicator lights ring -->
        <div class="indicator-ring" id="indicatorRing"></div>

        <!-- Pointer -->
        <div class="pointer" id="pointer"></div>

        <!-- SVG Wheel -->
        <svg class="wheel-svg" id="wheelSvg" viewBox="0 0 300 300"></svg>

        <!-- Center hub -->
        <div class="center-hub"><span>SG</span></div>

        <!-- Reward overlay (appears over wheel after spin) -->
        <div class="reward-overlay" id="rewardOverlay">
          <div class="reward-card" id="rewardCard">
            <div class="rw-icon" id="rwIcon"></div>
            <div class="rw-title">You Won!</div>
            <div class="rw-prize" id="rwPrize"></div>
            <div class="coupon-ticket" id="couponTicket" onclick="copyCode()">
              <span class="coupon-code" id="couponCode"></span>
              <svg class="copy-icon" viewBox="0 0 24 24" fill="none">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
              </svg>
            </div>
            <div class="copy-hint" id="copyHint">Tap to copy code</div>
            <button class="rw-cta" id="rwCta" onclick="ctaClick()"></button>
            <button class="rw-secondary" onclick="dismiss()"></button>
          </div>
        </div>
      </div>

      <!-- Spin button -->
      <button class="spin-btn" id="spinBtn" onclick="spinWheel()">Spin Now</button>
    </div>
  </div>

  <script>
    const SEG = CONFIG.segments;
    const NUM = SEG.length;
    const ARC = 360 / NUM;
    let isSpinning = false;
    let currentAngle = 0;
    let wonReward = null;
    let indicatorInterval = null;

    // =============================================
    // BUILD SVG WHEEL
    // =============================================
    function buildWheel() {
      const svg = document.getElementById('wheelSvg');
      const cx = 150, cy = 150, r = 148;

      // Draw segments
      SEG.forEach((seg, i) => {
        const startAngle = (i * ARC - 90) * Math.PI / 180;
        const endAngle = ((i + 1) * ARC - 90) * Math.PI / 180;

        const x1 = cx + r * Math.cos(startAngle);
        const y1 = cy + r * Math.sin(startAngle);
        const x2 = cx + r * Math.cos(endAngle);
        const y2 = cy + r * Math.sin(endAngle);

        const largeArc = ARC > 180 ? 1 : 0;

        // Segment path
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${largeArc},1 ${x2},${y2} Z`);
        path.setAttribute('fill', seg.color);
        path.setAttribute('stroke', 'rgba(255,255,255,0.06)');
        path.setAttribute('stroke-width', '0.5');
        svg.appendChild(path);

        // Segment border line
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', cx); line.setAttribute('y1', cy);
        line.setAttribute('x2', x1); line.setAttribute('y2', y1);
        line.setAttribute('stroke', 'rgba(255,255,255,0.08)');
        line.setAttribute('stroke-width', '1');
        svg.appendChild(line);

        // Text label
        const midAngle = ((i + 0.5) * ARC - 90) * Math.PI / 180;
        const textR = r * 0.65;
        const tx = cx + textR * Math.cos(midAngle);
        const ty = cy + textR * Math.sin(midAngle);
        const rotDeg = (i + 0.5) * ARC;

        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', tx);
        text.setAttribute('y', ty);
        text.setAttribute('fill', seg.textColor);
        text.setAttribute('font-family', 'Outfit, sans-serif');
        text.setAttribute('font-size', '12');
        text.setAttribute('font-weight', '700');
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('dominant-baseline', 'central');
        text.setAttribute('transform', `rotate(${rotDeg},${tx},${ty})`);
        text.textContent = seg.label;
        svg.appendChild(text);
      });
    }

    // =============================================
    // BUILD INDICATOR LIGHTS
    // =============================================
    function buildIndicators() {
      const ring = document.getElementById('indicatorRing');
      const numDots = 24;
      const ringR = 150; // half of 300px container

      for (let i = 0; i < numDots; i++) {
        const angle = (i * (360 / numDots) - 90) * Math.PI / 180;
        const x = 50 + 50 * Math.cos(angle);
        const y = 50 + 50 * Math.sin(angle);

        const dot = document.createElement('div');
        dot.className = 'indicator-dot';
        dot.style.left = `${x}%`;
        dot.style.top = `${y}%`;
        dot.dataset.idx = i;
        ring.appendChild(dot);
      }
    }

    // Animate indicator lights during spin
    function startIndicatorAnimation() {
      let pos = 0;
      const dots = document.querySelectorAll('.indicator-dot');
      indicatorInterval = setInterval(() => {
        dots.forEach((d, i) => {
          d.classList.toggle('lit', i === pos || i === (pos + 12) % 24);
        });
        pos = (pos + 1) % 24;
      }, 80);
    }

    function stopIndicatorAnimation() {
      if (indicatorInterval) clearInterval(indicatorInterval);
      document.querySelectorAll('.indicator-dot').forEach(d => d.classList.remove('lit'));
    }

    // =============================================
    // WEIGHTED RANDOM
    // =============================================
    function chooseSegment() {
      const total = SEG.reduce((s, seg) => s + seg.probability, 0);
      let rand = Math.random() * total;
      for (let i = 0; i < NUM; i++) {
        if (rand < SEG[i].probability) return i;
        rand -= SEG[i].probability;
      }
      return NUM - 1;
    }

    // =============================================
    // SPIN
    // =============================================
    window.spinWheel = function () {
      if (isSpinning) return;
      isSpinning = true;

      const btn = document.getElementById('spinBtn');
      btn.disabled = true;
      btn.textContent = 'Spinning...';

      // Choose winner
      const winIdx = chooseSegment();
      wonReward = SEG[winIdx];

      // Calculate final angle
      // The pointer is at top (12 o'clock = 0¬∞/360¬∞)
      // Segment 0 starts at top and goes clockwise
      // To land pointer on segment winIdx, we need the mid of that segment at top
      const segMid = (winIdx + 0.5) * ARC;
      const jitter = (Math.random() - 0.5) * (ARC * 0.7); // randomise within segment
      const targetAngle = 360 - segMid + jitter;

      const spins = CONFIG.spin.minTurns + Math.floor(Math.random() * (CONFIG.spin.maxTurns - CONFIG.spin.minTurns + 1));
      const totalRotation = currentAngle + (spins * 360) + targetAngle;

      // Start indicator animation
      startIndicatorAnimation();

      // Apply rotation
      const wheel = document.getElementById('wheelSvg');
      wheel.style.transitionDuration = CONFIG.spin.durationMs + 'ms';
      wheel.style.transitionTimingFunction = CONFIG.spin.easing;
      wheel.classList.add('spinning');
      wheel.style.transform = `rotate(${totalRotation}deg)`;

      currentAngle = totalRotation;

      // Track spin event
      pushEvent(CONFIG.events.wheelSpun, {
        Segment_Index: winIdx,
        Segment_Label: wonReward.label,
        Reward_Code: wonReward.value,
      });

      // On transition end ‚Üí reveal
      const onEnd = () => {
        wheel.removeEventListener('transitionend', onEnd);
        stopIndicatorAnimation();

        // Pointer bounce
        document.getElementById('pointer').classList.add('bounce');

        setTimeout(() => showReward(), CONFIG.revealDelayMs);
      };
      wheel.addEventListener('transitionend', onEnd);
    };

    // =============================================
    // REWARD REVEAL
    // =============================================
    function showReward() {
      // Dim the wheel
      const assembly = document.getElementById('wheelAssembly');
      document.getElementById('wheelSvg').style.opacity = '0.15';
      document.getElementById('wheelSvg').style.transition = 'opacity 0.4s ease';
      document.querySelector('.center-hub').style.opacity = '0';
      document.querySelector('.indicator-ring').style.opacity = '0';
      document.getElementById('pointer').style.opacity = '0';

      // Populate reward card
      document.getElementById('rwIcon').textContent = wonReward.icon;
      document.getElementById('rwPrize').textContent = wonReward.label;
      document.getElementById('couponCode').textContent = wonReward.value;
      document.getElementById('rwCta').textContent = CONFIG.cta.text;
      document.querySelector('.rw-secondary').textContent = CONFIG.cta.secondaryText;

      // Show overlay
      document.getElementById('rewardOverlay').classList.add('show');

      // Hide spin button
      document.getElementById('spinBtn').style.display = 'none';

      // Confetti
      if (CONFIG.enableConfetti) spawnConfetti();

      // Track result
      pushEvent(CONFIG.events.wheelResult, {
        Segment_Label: wonReward.label,
        Reward_Code: wonReward.value,
      });
    }

    // =============================================
    // COPY CODE
    // =============================================
    window.copyCode = function () {
      const code = wonReward?.value;
      if (!code) return;

      const ticket = document.getElementById('couponTicket');
      const hint = document.getElementById('copyHint');

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(code).then(onCopied).catch(() => fallbackCopy(code));
      } else {
        fallbackCopy(code);
      }

      function onCopied() {
        ticket.classList.add('copied');
        hint.textContent = '‚úì Code copied!';
        hint.classList.add('copied');
        pushEvent(CONFIG.events.codeCopied, { Code: code });
      }

      function fallbackCopy(t) {
        const inp = document.createElement('input');
        inp.value = t;
        inp.style.position = 'absolute';
        inp.style.left = '-9999px';
        document.body.appendChild(inp);
        inp.select();
        document.execCommand('copy');
        document.body.removeChild(inp);
        onCopied();
      }
    };

    // =============================================
    // CONFETTI
    // =============================================
    function spawnConfetti() {
      const c = document.createElement('div');
      c.className = 'confetti-container';
      document.body.appendChild(c);
      const colors = ['#00E676', '#FFD740', '#00C853', '#69F0AE', '#FFC400', '#80CBC4', '#B2FF59'];
      for (let i = 0; i < 60; i++) {
        const p = document.createElement('div');
        p.className = 'confetti-piece';
        p.style.left = `${20 + Math.random() * 60}%`;
        p.style.top = `${-5 - Math.random() * 10}px`;
        p.style.background = colors[Math.floor(Math.random() * colors.length)];
        p.style.width = `${3 + Math.random() * 5}px`;
        p.style.height = `${6 + Math.random() * 10}px`;
        p.style.animationDuration = `${1.5 + Math.random() * 2.5}s`;
        p.style.animationDelay = `${Math.random() * 0.5}s`;
        c.appendChild(p);
      }
      setTimeout(() => c.remove(), 5000);
    }

    // =============================================
    // ACTIONS
    // =============================================
    window.ctaClick = function () {
      pushEvent(CONFIG.events.wheelCta, {
        Reward_Code: wonReward?.value,
        Segment_Label: wonReward?.label,
      });
      if (CONFIG.cta.url) window.location.href = CONFIG.cta.url;
    };

    window.dismiss = function () {
      if (!wonReward) {
        pushEvent(CONFIG.events.wheelDismissed, { Had_Result: false });
      }
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.dismissInAppNotification) {
          CleverTap.dismissInAppNotification(); return;
        }
      } catch (e) {}
      window.location.href = 'wzrk://exit';
    };

    // =============================================
    // CLEVERTAP EVENT BRIDGE
    // =============================================
    function pushEvent(name, props) {
      const p = props || {};
      p.Timestamp = new Date().toISOString();
      try {
        if (typeof CleverTap !== 'undefined' && CleverTap.pushEvent)
          CleverTap.pushEvent(name, JSON.stringify(p));
        if (typeof clevertap !== 'undefined' && clevertap.event)
          clevertap.event.push(name, p);
        if (window.webkit?.messageHandlers?.clevertap)
          window.webkit.messageHandlers.clevertap.postMessage(
            JSON.stringify({ type: 'event', name, props: p })
          );
      } catch (e) { console.log('[CT]', name, p); }
    }

    // =============================================
    // INIT
    // =============================================
    document.getElementById('subText').textContent = CONFIG.subheadline;
    if (!CONFIG.includeDismissButton) document.getElementById('dismissBtn').style.display = 'none';

    buildWheel();
    buildIndicators();

    pushEvent(CONFIG.events.wheelViewed, {
      Segments: NUM,
      Segment_Labels: SEG.map(s => s.label).join(','),
    });
  </script>
</body>
</html>
